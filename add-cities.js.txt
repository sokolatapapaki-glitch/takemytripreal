// Αρχικοποίηση
let allCitiesData = []; // Εδώ θα φορτώνονται ΟΛΕΣ οι πόλεις

// Λίστα με τα ονόματα των JSON αρχείων που θέλουμε να φορτώσουμε
const cityFiles = ['paris.json', 'prague.json', 'istanbul.json', 'london.json'];

// Συνάρτηση για φόρτωση μιας πόλης από JSON
async function loadCityData(cityFileName) {
    try {
        const response = await fetch(cityFileName);
        if (!response.ok) {
            throw new Error(`Δεν βρέθηκε το αρχείο: ${cityFileName}`);
        }
        const cityData = await response.json();
        return cityData; // Επιστρέφει τα δεδομένα της πόλης
    } catch (error) {
        console.error('Σφάλμα φόρτωσης:', error);
        return null; // Αν αποτύχει, επιστρέφει null
    }
}

// Συνάρτηση για φόρτωση ΟΛΩΝ των πόλεων
async function loadAllCities() {
    console.log("Φόρτωση δεδομένων πόλεων...");
    const loadingPromises = cityFiles.map(fileName => loadCityData(fileName));
    
    // Περιμένει να φορτώσουν όλα τα αρχεία
    const loadedCities = await Promise.all(loadingPromises);
    
    // Κρατάει μόνο τα επιτυχημένα αποτελέσματα (όχι τα null)
    allCitiesData = loadedCities.filter(city => city !== null);
    console.log("Φορτώθηκαν επιτυχώς:", allCitiesData.length, "πόλεις.");
    
    // Μόλις φορτώσουν όλα, καλεί τη συνάρτηση που δημιουργεί την επιλογή πόλης
    if (typeof populateCityDropdown === 'function') {
        populateCityDropdown(allCitiesData);
    } else {
        console.error("Η συνάρτηση 'populateCityDropdown' δεν βρέθηκε.");
    }
    
    // Επιστρέφει τα δεδομένα (χρήσιμο για debugging)
    return allCitiesData;
}

// ΑΥΤΟΜΑΤΗ ΕΚΚΙΝΗΣΗ: Όταν φορτωθεί η σελίδα, φόρτωσε όλες τις πόλεις
document.addEventListener('DOMContentLoaded', loadAllCities);
