<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>ÎŸÎ¹ÎºÎ¿Î³ÎµÎ½ÎµÎ¹Î±ÎºÏŒÏ‚ ÎŸÏÎ³Î±Î½Ï‰Ï„Î®Ï‚ Î¤Î±Î¾Î¹Î´Î¹Î¿Ï</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<link rel="manifest" href="manifest.json">

<!-- ğŸ‘‡ Î•Î™ÎšÎŸÎÎ™Î”Î™ÎŸ: Î’Î‘Î›Î™Î¤Î£Î‘ ğŸ‘‡ -->
<link rel="icon" type="image/x-icon" href="https://cdn-icons-png.flaticon.com/512/2983/2983787.png">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2983/2983787.png">
<!-- ğŸ‘† ÎœÎ•Î§Î¡Î™ Î•Î”Î© ğŸ‘† -->

<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Comic Neue', Arial, Helvetica, sans-serif; background: #f0f8ff; margin: 0; display: flex; }
.sidebar { width: 250px; background: #3eb489; color: white; padding: 20px; box-sizing: border-box; }
.sidebar h2 { font-size: 20px; margin-top: 0; }
.step { margin-bottom: 20px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 12px; cursor: pointer; transition: background 0.2s; }
.step.active { background: rgba(255,255,255,0.5); }
.main { flex: 1; padding: 20px; box-sizing: border-box; overflow-y: auto; }
.section { display: none; }
.section.active { display: block; }
h1 { text-align: center; margin-bottom: 20px; }
h2 { text-align: center; margin-bottom: 10px; }
label { display:block; margin-top:10px; }
select, input[type=checkbox] { margin-top:5px; }
#destination-cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-top:20px; }
.destination-card { border-radius:12px; padding:20px; min-height:140px; display:flex; flex-direction:column; justify-content:center; align-items:center; font-family:'Comic Neue', cursive; font-size:1em; font-weight:500; background: #dfefff; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition:0.2s; cursor:pointer; }
.destination-card:nth-child(2n) { background: #dfffe0; }
.destination-card:nth-child(3n) { background: #fff0df; }
.destination-card button { margin-top:10px; padding:8px 12px; background:#3eb489; color:white; border:none; border-radius:8px; cursor:pointer; }
.family-options { display:flex; gap:10px; flex-wrap:wrap; margin-top:5px; }

/* Î’ÎµÎ»Ï„Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î’Î®Î¼Î±Ï„Î¿Ï‚ 1 */
.destination-filters {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.filter-group {
    background: #fff;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.filter-group h3 {
    margin-top: 0;
    color: #3eb489;
    border-bottom: 1px solid #eee;
    padding-bottom: 8px;
}

.buttons-container {
    display: flex;
    gap: 10px;
    margin: 20px 0;
    justify-content: center;
    flex-wrap: wrap;
}

/* Î’Î®Î¼Î± 3 - ÎÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î± */
#step-hotel div, #step-hotel input, #step-hotel button { font-family: 'Comic Neue', Arial, Helvetica, sans-serif; }

/* ÎÎ•ÎŸ Î£Î¤Î¥Î› Î“Î™Î‘ Î¤Î— ÎÎ•Î‘ Î”ÎŸÎœÎ— Î—Î›Î™ÎšÎ™Î©Î */
.family-members-container {
    background: white;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-bottom: 30px;
    max-width: 1000px;
    margin: auto;
}

.family-member-input {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 10px;
    flex-wrap: wrap;
}

.family-member-input input {
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-family: 'Comic Neue', Arial, Helvetica, sans-serif;
    font-size: 16px;
}

.remove-member-btn {
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 14px;
}

/* Î’Î®Î¼Î± 4 - Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (Î‘ÏÏ‡Î¹ÎºÎ¬ Î£Ï„Ï…Î») */
.total-overall { max-width: 1000px; margin: auto; margin-bottom: 30px; background: #fff; padding: 20px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); text-align: center; font-size: 26px; font-weight: bold; color: #fff; background-color: #ff7f50; }

/* ================== MOBILE OPTIMIZATIONS ================== */
/* Budget Tracker Mobile Styles */
@media (max-width: 768px) {
    #budget-tracker {
        position: fixed !important;
        top: 10px !important;
        right: 10px !important;
        left: 10px !important;
        width: calc(100% - 20px) !important;
        max-width: none !important;
        min-width: auto !important;
        font-size: 14px !important;
        padding: 12px !important;
    }
   
    /* PDF Button Mobile */
    #pdf-export-btn {
        width: 90% !important;
        padding: 18px 20px !important;
        font-size: 16px !important;
        margin: 15px auto !important;
    }
   
    /* Activity Cards Mobile */
.activity-card {
    flex-direction: column !important;
    text-align: left !important;  /* Î‘ÏÎ¹ÏƒÏ„ÎµÏÎ¬, ÏŒÏ‡Î¹ ÎºÎ­Î½Ï„ÏÎ¿ */
    padding: 15px !important;
    min-height: 160px !important;  /* Î£Ï„Î±Î¸ÎµÏÏŒ ÏÏˆÎ¿Ï‚ */
    max-height: 200px !important;  /* ÎœÎ­Î³Î¹ÏƒÏ„Î¿ ÏÏˆÎ¿Ï‚ */
    overflow: hidden !important;   /* ÎšÏÏÎ²ÎµÎ¹ Ï€Î±ÏÎ±Ï€Î±Î½Î¯ÏƒÎ¹Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ */
    position: relative !important; /* Î“Î¹Î± Ï„Î¿ Î±ÏƒÏ„ÎµÏÎ¬ÎºÎ¹ */
}

.activity-card .emoji-icon {
    font-size: 28px !important;
    margin-bottom: 10px !important;
    float: left !important;        /* Emoji Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬ */
    margin-right: 15px !important;
}

/* Î¤Î¿ Î±ÏƒÏ„ÎµÏÎ¬ÎºÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ ÎŸÎ¡Î‘Î¤ÎŸ */
.activity-card .star {
    position: absolute !important;
    top: 10px !important;         /* Î Î¹Î¿ Ï‡Î±Î¼Î·Î»Î¬ */
    right: 10px !important;       /* Î Î¹Î¿ Î¼Î­ÏƒÎ± */
    font-size: 24px !important;   /* ÎœÎ­Î³ÎµÎ¸Î¿Ï‚ */
    color: gold !important;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    z-index: 10 !important;       /* Î Î¬Î½Ï‰ Î±Ï€ÏŒ ÏŒÎ»Î± */
    display: block !important;    /* Î’ÎµÎ²Î±Î¯Ï‰ÏƒÎ· ÏŒÏ„Î¹ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ */
}

/* Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… */
.activity-info h3 {
    font-size: 1.1em !important;
    margin: 0 0 8px 35px !important; /* ÎšÎµÎ½ÏŒ Î³Î¹Î± Ï„Î¿ emoji */
    line-height: 1.2 !important;
    max-height: 2.4em !important;    /* ÎœÎ­Î³Î¹ÏƒÏ„Î¿ 2 Î³ÏÎ±Î¼Î¼Î­Ï‚ */
    overflow: hidden !important;
}

.activity-info p {
    font-size: 0.9em !important;
    line-height: 1.4 !important;
    margin: 5px 0 !important;
    max-height: 4.2em !important;    /* ÎœÎ­Î³Î¹ÏƒÏ„Î¿ 3 Î³ÏÎ±Î¼Î¼Î­Ï‚ */
    overflow: hidden !important;
    display: -webkit-box !important;
    -webkit-line-clamp: 3 !important; /* ÎšÏŒÎ²ÎµÎ¹ ÏƒÏ„Î¹Ï‚ 3 Î³ÏÎ±Î¼Î¼Î­Ï‚ */
    -webkit-box-orient: vertical !important;
}

/* Î Î¯Î½Î±ÎºÎ±Ï‚ Ï„Î¹Î¼ÏÎ½ Ï€Î¹Î¿ ÏƒÏ…Î¼Ï€Î±Î³Î®Ï‚ */
table.activity-table {
    font-size: 0.8em !important;
    margin-top: 8px !important;
    width: 100% !important;
}

table.activity-table th,
table.activity-table td {
    padding: 3px 2px !important;
}
   
    /* Destination Cards Mobile */
    .destination-card {
        padding: 15px !important;
        min-height: 120px !important;
    }
   
    /* Family Members Mobile */
    .family-member-input {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
   
    .family-member-input input {
        width: 100%;
    }

   /* Î’ÎµÎ»Ï„Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î’Î®Î¼Î±Ï„Î¿Ï‚ 1 Î³Î¹Î± ÎºÎ¹Î½Î·Ï„Î¬ */
@media (max-width: 768px) {
    .destination-filters {
        grid-template-columns: 1fr;
        gap: 8px;
        background: white;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin: 10px 0;
    }
   
    .filter-group {
        padding: 0;
        margin: 0;
        background: none;
        box-shadow: none;
        border: none;
    }
    
    /* ÎšÏÏÏˆÎµ Ï„Î¿Ï…Ï‚ Ï„Î¯Ï„Î»Î¿Ï…Ï‚ "Î’Î±ÏƒÎ¹ÎºÎ¬ Î¦Î¯Î»Ï„ÏÎ±", ÎºÎ»Ï€ */
    .filter-group h3 {
        display: none;
    }
    
    /* ÎšÎ±Î»ÏÏ„ÎµÏÎ¿ spacing Î³Î¹Î± Ï„Î± input/select */
    .filter-group label {
        margin-top: 8px;
        font-size: 14px;
    }
    
    .filter-group select,
    .filter-group input {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        margin-top: 4px;
    }
   
    .buttons-container {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        margin: 15px 0;
    }
   
    .buttons-container button {
        width: 100%;
        padding: 16px;
        font-size: 16px;
        margin: 0;
    }
}
   
    .buttons-container {
        flex-direction: column;
        align-items: center;
    }
   
    .buttons-container button {
        width: 100%;
        max-width: 300px;
    }
}

/* Animation Î³Î¹Î± Budget Tracker */
@keyframes slideInBudget {
    from {
        opacity: 0;
        transform: translateX(100px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

#budget-tracker {
    animation: slideInBudget 0.5s ease-out;
}

/* Loading state Î³Î¹Î± PDF */
.pdf-loading {
    opacity: 0.7;
    pointer-events: none;
}

.pdf-loading::after {
    content: ' â³';
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

button { padding: 10px 20px; font-size: 16px; border-radius: 12px; border: none; background: #ff7f50; color: white; cursor: pointer; margin-top: 10px; display: block; margin-left: auto; margin-right: auto; transition: transform 0.2s, box-shadow 0.2s; }

#activities-container-wrapper { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
#activities-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px,1fr));
    gap: 20px;
    margin-top: 20px;
}

/* ÎÎ•ÎŸ Î£Î¤Î¥Î› Î“Î™Î‘ ÎšÎ‘Î¡Î¤Î•Î£ Î”Î¡Î‘Î£Î¤Î—Î¡Î™ÎŸÎ¤Î—Î¤Î©Î Î§Î©Î¡Î™Î£ Î¦Î©Î¤ÎŸ */
.activity-card {
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 20px;
    min-height: 200px;
    cursor: pointer;
    border: 2px solid transparent;
    position: relative;
    transition: all 0.2s ease;
    display: block;
}

.activity-card:hover {
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    border-color: #ff7f50;
    transform: translateY(-2px);
}

.activity-card.selected {
    border: 3px solid #ff7f50;
    background-color: #fff8f0;
    box-shadow: 0 6px 18px rgba(0,0,0,0.2);
}

.activity-info h3 {
    margin-top: 0;
    font-size: 1.3em;
    color: #2c3e50;
    margin-bottom: 10px;
}

.activity-info p {
    margin: 8px 0;
    font-size: 1em;
    color: #555;
    line-height: 1.5;
}

.activity-card .emoji-icon {
    font-size: 40px;
    text-align: center;
    margin-bottom: 15px;
    display: block;
}

.activity-card .star {
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 28px;
    color: gold;
    opacity: 0.3;  /* Î‘ÎŸÎ¡Î‘Î¤ÎŸ ÎŸÎ¤Î‘Î Î”Î•Î Î•Î™ÎÎ‘Î™ SELECTED */
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: opacity 0.3s;
}

.activity-card.selected .star {
    opacity: 1;  /* ÎŸÎ¡Î‘Î¤ÎŸ ÎŸÎ¤Î‘Î Î•Î™ÎÎ‘Î™ SELECTED */
    animation: pulse 1s infinite alternate;
}

@keyframes pulse {
    from { transform: scale(1); }
    to { transform: scale(1.2); }
}

table.activity-table { width: 100%; text-align: center; margin-top: 8px; border-collapse: collapse; font-size: 0.85em; }
table.activity-table th, table.activity-table td { padding: 4px; }
.total { font-weight: bold; font-size: 14px; margin-top: 6px; }

/* ÎÎ•ÎŸ Î£Î¤Î¥Î› Î“Î™Î‘ Î¤ÎŸ Î’Î—ÎœÎ‘ 5 ÎšÎŸÎ¥ÎœÎ Î™ */
.step-5-btn-container { text-align: center; margin-top: 30px; }
.step-5-btn { padding: 18px 40px; font-size: 20px; border-radius: 16px; background: #3eb489; color: white; border: none; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }

/* Î£Î¤Î¥Î› Î“Î™Î‘ Î¤ÎŸ LINK Î£Î¤ÎŸ Î’Î—ÎœÎ‘ 5 */
.summary-content {
    text-align: center;
    font-size: 1.2em;
    padding: 40px;
    border: 2px dashed #3eb489;
    border-radius: 15px;
    background: #e0fff0;
}
.summary-content a {
    font-size: 1.5em;
    font-weight: bold;
    color: #ff7f50;
    text-decoration: none;
    display: block;
    margin-top: 15px;
}

/* ğŸ”¥ OPTIMIZED BACKGROUND */
body {
    background-color: #f0f8ff; /* ÎœÏŒÎ½Î¿ Ï‡ÏÏÎ¼Î±, ÏŒÏ‡Î¹ ÎµÎ¹ÎºÏŒÎ½Î± */
    background-image: linear-gradient(rgba(255,255,255,0.25), rgba(255,255,255,0.4)), 
                      url('https://images.unsplash.com/photo-1483728642387-6c3bdd6c93e5?w=1200');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    background-repeat: no-repeat;
    image-rendering: -webkit-optimize-contrast;
    min-height: 100vh;
}
/* ğŸ”¥ ÎÎ•Î‘ Î’Î•Î›Î¤Î™Î©Î£Î— Î“Î™Î‘ ÎšÎ™ÎÎ—Î¤Î‘ */
@media (max-width: 640px) {
    .sidebar {
        width: 100%;
        height: auto;
        padding: 10px;
    }
    .main {
        padding: 10px;
    }
    .destination-card {
        min-height: 120px;
        padding: 15px;
    }
    .activity-card {
        min-height: 180px;
        padding: 12px;
    }
    table.activity-table {
        font-size: 0.75em;
    }
    table.activity-table th,
    table.activity-table td {
        padding: 2px;
    }
    #map-container {
        height: 400px;
    }
}

/* Mobile Navigation */
.mobile-nav {
    display: none !important;
    text-align: center;
    padding: 10px;
    background: #3eb489;
    position: sticky;
    top: 0;
    z-index: 1000;
}

.mobile-nav select {
    width: 90%;
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-family: 'Comic Neue', Arial, Helvetica, sans-serif;
    font-size: 16px;
}


/* Î£Ï„Ï…Î» Î³Î¹Î± Ï„Î¿Î½ Ï‡Î¬ÏÏ„Î· */
.leaflet-container {
    font-family: 'Comic Neue', Arial, Helvetica, sans-serif;
}
/* =========== MOBILE OPTIMIZATION =========== */
@media (max-width: 768px) {
    /* 1. Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· Î´Î¹Î¬Ï„Î±Î¾Î·Ï‚ */
    body {
        flex-direction: column;
        display: block;
    }
    
    /* 2. Î£Î¯Î³Î¿Ï…ÏÎ· Î±Ï€ÏŒÎºÏÏ…ÏˆÎ· sidebar */
    .sidebar {
        display: none !important;
        width: 0 !important;
        height: 0 !important;
        padding: 0 !important;
        margin: 0 !important;
        overflow: hidden !important;
        position: absolute !important;
        visibility: hidden !important;
    }
    
    /* 3. Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· mobile nav */
    .mobile-nav {
        display: block !important;
        width: 100%;
        position: sticky;
        top: 0;
        z-index: 1000;
        background: #3eb489;
        padding: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .mobile-nav select {
        width: 100%;
        max-width: 500px;
        margin: 0 auto;
        display: block;
        padding: 12px 15px;
        font-size: 16px;
        border-radius: 8px;
        border: 2px solid white;
        background: white;
    }
    
    /* 4. ÎšÏÏÎ¹Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ full width */
    .main {
        width: 100% !important;
        padding: 10px 15px !important;
        margin-left: 0 !important;
        max-width: 100% !important;
    }
    
    /* 5. Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· destination cards */
    #destination-cards {
        grid-template-columns: 1fr !important;
        gap: 10px;
    }
    
    .destination-card {
        padding: 15px !important;
        margin: 5px 0 !important;
    }
    
    /* 6. Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· filters */
    .destination-filters {
        grid-template-columns: 1fr !important;
        gap: 10px;
        padding: 10px !important;
        margin: 10px 0 !important;
    }
    
    .filter-group {
        padding: 15px !important;
        margin-bottom: 10px !important;
    }
}
</style>
</head>
<body>
<div class="sidebar">
    <h2>Î’Î®Î¼Î±Ï„Î± Î¤Î±Î¾Î¹Î´Î¹Î¿Ï</h2>
  <div class="step active" data-target="step-destination">1. Î•Ï€Î¹Î»Î¿Î³Î® Î ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼Î¿Ï</div>
  <div class="step" data-target="step-flight">2. Î•Ï€Î¹Î»Î¿Î³Î® Î Ï„Î®ÏƒÎ·Ï‚</div>
  <div class="step" data-target="step-hotel">3. Î•Ï€Î¹Î»Î¿Î³Î® ÎÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î¿Ï…</div>
  <div class="step" data-target="step-activities">4. Î•Ï€Î¹Î»Î¿Î³Î® Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½</div>
  <div class="step" data-target="step-summary">5. Î—Î¼ÎµÏÎ®ÏƒÎ¹Î¿ Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ÎºÎ±Î¹ Î”Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ¿Ï‚ Ï‡Î±ÏÏ„Î·Ï‚ Î¼Îµ ÎµÏƒÏ„Î¹Î±Ï„Î¿ÏÎ¹Î±</div>
  <div class="step" data-target="step-map">6. Î”Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÏŒÏ‚ Î§Î¬ÏÏ„Î·Ï‚ & Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î±</div>
</div>

<div class="mobile-nav">
    <select onchange="activateStep(this.value)">
        <option value="step-destination">1. Î ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚</option>
        <option value="step-flight">2. Î Ï„Î®ÏƒÎµÎ¹Ï‚</option>
        <option value="step-hotel">3. ÎÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î±</option>
        <option value="step-activities">4. Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚</option>
        <option value="step-summary">5. Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î±</option>
        <option value="step-map">6. Î§Î¬ÏÏ„Î·Ï‚</option>
    </select>
</div>

<div class="main">
    <div id="step-destination" class="section active">
    <h1>Î•Ï€Î¹Î»Î¿Î³Î® Î ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼Î¿Ï</h1>
   
    <!-- Î’ÎµÎ»Ï„Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î´Î¹Î¬Ï„Î±Î¾Î· Ï†Î¯Î»Ï„ÏÏ‰Î½ -->
    <div class="destination-filters">
        <div class="filter-group">
            <h3>Î’Î±ÏƒÎ¹ÎºÎ¬ Î¦Î¯Î»Ï„ÏÎ±</h3>
            <label>Î¤ÏÏ€Î¿Ï‚ Ï„Î±Î¾Î¹Î´Î¹ÏÏ„Î·:</label>
            <select id="travel-type" onchange="toggleFamily()">
                <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ...</option>
                <option value="ÎœÏŒÎ½Î¿Ï‚">ÎœÏŒÎ½Î¿Ï‚</option>
                <option value="Î–ÎµÏ…Î³Î¬ÏÎ¹">Î–ÎµÏ…Î³Î¬ÏÎ¹</option>
                <option value="ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±">ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±</option>
                <option value="Î Î±ÏÎ­Î± Ï†Î¯Î»Ï‰Î½">Î Î±ÏÎ­Î± Ï†Î¯Î»Ï‰Î½</option>
            </select>
           
            <div class="family-options" id="family-options" style="display:none;">
                <label><input type="checkbox" value="ÎšÎ±ÏÏŒÏ„ÏƒÎ¹"> ÎšÎ±ÏÏŒÏ„ÏƒÎ¹</label>
                <label><input type="checkbox" value="ÎœÎ¹ÎºÏÎ¬"> ÎœÎ¹ÎºÏÎ¬</label>
                <label><input type="checkbox" value="ÎœÎµÎ³Î¬Î»Î±"> ÎœÎµÎ³Î¬Î»Î±</label>
                <label><input type="checkbox" value="ÎˆÏ†Î·Î²Î¿Î¹"> ÎˆÏ†Î·Î²Î¿Î¹</label>
                <label><input type="checkbox" value="Î†Î½Ï‰ Ï„Ï‰Î½ 18"> Î†Î½Ï‰ Ï„Ï‰Î½ 18</label>
            </div>
           
            <label>Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ· ÏƒÎµ ÏÏÎµÏ‚:</label>
            <select id="distance">
                <option value="">ÎŒÎ»Î±</option>
                <option value="1">ÎˆÏ‰Ï‚ 1</option>
                <option value="2">ÎˆÏ‰Ï‚ 2</option>
                <option value="3">ÎˆÏ‰Ï‚ 3</option>
                <option value="4">ÎˆÏ‰Ï‚ 4</option>
                <option value="5">Î Î¬Î½Ï‰ Î±Ï€ÏŒ 4</option>
            </select>
           
            <label>Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±/Î§ÎµÎ¹Î¼ÏÎ½Î±Ï‚:</label>
            <select id="weather">
                <option value="">ÎŒÎ»Î±</option>
                <option value="Î Î¹Î¿ Î¶ÎµÏƒÏ„ÏŒ">Î Î¹Î¿ Î¶ÎµÏƒÏ„ÏŒ Î±Ï€ÏŒ Î•Î»Î»Î¬Î´Î±</option>
                <option value="ÎŠÎ´Î¹Î±">ÎŠÎ´Î¹Î± Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±</option>
                <option value="Î Î¹Î¿ ÎºÏÏÎ¿">Î Î¹Î¿ ÎºÏÏÎ¿</option>
                <option value="Î§Î¹ÏŒÎ½Î¹Î±">Î Î¹Î¸Î±Î½Î¬ Ï‡Î¹ÏŒÎ½Î¹Î±</option>
            </select>
        </div>
       
        <div class="filter-group">
            <h3>Î ÏÏŒÏƒÎ¸ÎµÏ„Î± Î¦Î¯Î»Ï„ÏÎ±</h3>
            <label>Î˜ÎµÎ¼Î±Ï„Î¹ÎºÎ¬ Ï€Î¬ÏÎºÎ±:</label>
            <select id="themeparks">
                <option value="">Î‘Î´Î¹Î±Ï†Î¿ÏÎ¿</option>
                <option value="ÎÎ±Î¹">ÎÎ±Î¹</option>
            </select>
           
            <label>Î§ÏÎ¹ÏƒÏ„Î¿Ï…Î³ÎµÎ½Î½Î¹Î¬Ï„Î¹ÎºÎµÏ‚ Î±Î³Î¿ÏÎ­Ï‚:</label>
            <select id="christmas">
                <option value="">Î‘Î´Î¹Î±Ï†Î¿ÏÎ¿</option>
                <option value="ÎÎ±Î¹">ÎÎ±Î¹</option>
            </select>
           
            <label>Î ÏŒÏƒÎµÏ‚ Î¼Î­ÏÎµÏ‚ Î¸Î± Î¼ÎµÎ¯Î½ÎµÏ„Îµ;</label>
<div style="display: flex; gap: 10px; align-items: center;">
    <select id="days-stay" style="flex: 1;">
        <option value="">-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ --</option>
        <option value="3">3 Î¼Î­ÏÎµÏ‚</option>
        <option value="4">4 Î¼Î­ÏÎµÏ‚</option>
        <option value="5">5 Î¼Î­ÏÎµÏ‚</option>
        <option value="6">6 Î¼Î­ÏÎµÏ‚</option>
        <option value="7">7 Î¼Î­ÏÎµÏ‚</option>
    </select>
    <button onclick="updateDaysStay()" style="padding: 8px 12px; background: #3eb489; color: white; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap;">
        ğŸ”„ Update
    </button>
</div>
           
            <label>Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¤Î±Î¾Î¹Î´Î¹Î¿Ï (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ):</label>
            <input type="number" id="travel-budget" placeholder="Ï€.Ï‡. 500" style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 10px;">
            <small style="color: #666;">Î’Î¬Î»Ï„Îµ Ï„Î¿ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ Ï€Î¿ÏƒÏŒ Ï€Î¿Ï… Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î¾Î¿Î´Î­ÏˆÎµÏ„Îµ</small>
        </div>
       
        <div class="filter-group">
            <h3>Î•Ï€Î¹Î»Î¿Î³Î­Ï‚ Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½</h3>
            <label>Î¤ÏÏ€Î¿Ï‚ Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½:</label>
            <select id="vacation-type">
                <option value="">ÎŒÎ»Î±</option>
                <option value="Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚">Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚ & ÎœÎ¿Ï…ÏƒÎµÎ¯Î±</option>
                <option value="Î¦Ï…ÏƒÎ¹ÎºÎ® ÎŸÎ¼Î¿ÏÏ†Î¹Î¬">Î¦Ï…ÏƒÎ¹ÎºÎ® ÎŸÎ¼Î¿ÏÏ†Î¹Î¬ & Î¤Î¿Ï€Î¯Î±</option>
                <option value="Î˜Î¬Î»Î±ÏƒÏƒÎ±">Î˜Î±Î»Î¬ÏƒÏƒÎ¹Î± & Î Î±ÏÎ±Î»Î¯ÎµÏ‚</option>
                <option value="Î ÏŒÎ»Î·">Î‘ÏƒÏ„Î¹ÎºÎ­Ï‚ Î”Î¹Î±ÎºÎ¿Ï€Î­Ï‚</option>
                <option value="Î’Î¿Ï…Î½ÏŒ">Î’Î¿Ï…Î½ÏŒ & Î§Î¹Î¿Î½Î¿Î´ÏÎ¿Î¼Î¹ÎºÎ¬</option>
            </select>

            <label>ÎšÏŒÏƒÏ„Î¿Ï‚ Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½:</label>
            <select id="cost-level">
                <option value="">ÎŒÎ»Î±</option>
                <option value="ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ">ğŸ’° ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ</option>
                <option value="ÎœÎ­Ï„ÏÎ¹Î¿">ğŸ’°ğŸ’° ÎœÎ­Ï„ÏÎ¹Î¿</option>
                <option value="Î‘ÎºÏÎ¹Î²ÏŒ">ğŸ’°ğŸ’°ğŸ’° Î‘ÎºÏÎ¹Î²ÏŒ</option>
            </select>

            <label>ÎšÎ±Ï„Î¬Î»Î»Î·Î»Î¿ Î³Î¹Î±:</label>
            <div class="family-options" id="suitability-options" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:5px;">
                <label><input type="checkbox" value="ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±"> ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î± (0-2)</label>
                <label><input type="checkbox" value="Î‘ÎœÎ•Î‘"> Î†Ï„Î¿Î¼Î± Î¼Îµ Î‘ÎœÎ•Î‘</label>
                <label><input type="checkbox" value="Î—Î»Î¹ÎºÎ¹Ï‰Î¼Î­Î½Î¿Î¹"> Î—Î»Î¹ÎºÎ¹Ï‰Î¼Î­Î½Î¿Î¹</label>
            </div>
        </div>
    </div>
   
    <!-- ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ ÎµÎ½ÎµÏÎ³ÎµÎ¹ÏÎ½ -->
    <div class="buttons-container" style="display: flex; flex-direction: column; gap: 12px; align-items: stretch;">
    <button onclick="filterDestinations()">Î”ÎµÏ‚ Î ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚</button>
    <button onclick="resetFilters()" style="background: #6c757d;">ğŸ”„ Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Î¦Î¯Î»Ï„ÏÏ‰Î½</button>
    <button onclick="toggleQuickSelection()" style="background: #3eb489;">ğŸ”½ ÎˆÏ‡Ï‰ Î®Î´Î· Î²ÏÎµÎ¹ Ï€ÏŒÎ»Î·</button>
    <button onclick="clearAllData()" style="background: #dc3545;">ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î® ÎŒÎ»Ï‰Î½</button>
</div>
   
    <!-- Î“ÏÎ®Î³Î¿ÏÎ· ÎµÏ€Î¹Î»Î¿Î³Î® Ï€ÏŒÎ»Î·Ï‚ -->
    <div id="quick-city-select" style="display: none; max-width: 400px; margin: 0 auto 20px auto; background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <h3 style="margin-top: 0; text-align: center;">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏŒÎ»Î·</h3>
        <select id="quick-city" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-family: 'Comic Neue', Arial, Helvetica, sans-serif;">
            <option value="">-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏŒÎ»Î· --</option>
        </select>
        <button onclick="selectQuickCity()" style="width: 100%; padding: 10px; margin-top: 10px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer;">
            Î•Ï€Î¹Î»Î¿Î³Î®
        </button>
    </div>
   
    <!-- Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏÎ½ -->
    <div id="destination-cards"></div>
  </div>

    <div id="step-flight" class="section">
    <h1>âœˆï¸ Î•Ï€Î¹Î»Î¿Î³Î® Î Ï„Î®ÏƒÎ·Ï‚</h1>
    <div style="display:flex; justify-content:center; gap:30px; flex-wrap:wrap; margin-bottom:40px;">
      <a href="https://www.google.com/flights" target="_blank"><button style="padding:20px 45px; font-size:20px; border-radius:18px; background:#b2f0e8; color:#004d40; border:none; cursor:pointer;">ğŸŒ Google Flights</button></a>
      <a href="https://www.skyscanner.net" target="_blank"><button style="padding:20px 45px; font-size:20px; border-radius:18px; background:#cce3ff; color:#002b5b; border:none; cursor:pointer;">âœˆï¸ Skyscanner</button></a>
    </div>
    <div style="text-align:center;"><button onclick="goToStep3()" style="padding:14px 30px; font-size:18px; border-radius:14px; background:#d4edda; color:#155724; border:none; cursor:pointer;">â¡ï¸ Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± ÏƒÏ„Î¿ Î’Î®Î¼Î± 3</button></div>
  </div>

    <div id="step-hotel" class="section">
    <h1>Î•Ï€Î¹Î»Î¿Î³Î® ÎÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î¿Ï… ğŸ¨</h1>
    <div style="max-width:600px; margin:auto; background:#dfefff; padding:20px; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1);">
      <h2>Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÎÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î¿Ï…</h2>
      <label>Î ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚:</label>
      <input type="text" id="hotel-destination" placeholder="Ï€.Ï‡. Î’Î¹Î­Î½Î½Î·" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ccc; margin-bottom:10px;">
      <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î†Ï†Î¹Î¾Î·Ï‚:</label>
      <input type="date" id="hotel-checkin" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ccc; margin-bottom:10px;">
      <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î‘Î½Î±Ï‡ÏÏÎ·ÏƒÎ·Ï‚:</label>
      <input type="date" id="hotel-checkout" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ccc; margin-bottom:15px;">
      <button onclick="searchHotels()">Î’ÏÎµÏ‚ ÎÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î±</button>
      <p style="margin-top:12px; font-size:0.9em; color:#555;">
        Î¤Î¿ link Î±Î½Î¿Î¯Î³ÎµÎ¹ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Expedia Î³Î¹Î± Î•Ï…ÏÏÏ€Î·. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ Î³Î»ÏÏƒÏƒÎ±/Î½ÏŒÎ¼Î¹ÏƒÎ¼Î± ÏƒÏ„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±.
      </p>
<div style="text-align:center; margin-top:30px;">
  <button onclick="goToStep4()" style="padding:14px 30px; font-size:18px; border-radius:14px; background:#ff7f50; color:white; border:none; cursor:pointer;">
    â¡ï¸ Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± ÏƒÏ„Î¿ Î’Î®Î¼Î± 4
  </button>
</div>

    </div>
  </div>

    <div id="step-activities" class="section">
    <h1>ÎŸÎ¹ÎºÎ¿Î³ÎµÎ½ÎµÎ¹Î±ÎºÎ­Ï‚ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚</h1>
    <div class="total-overall" id="overall-total">Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½Ï‰Î½ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½: 0 â‚¬</div>
   
    <!-- ÎÎ•Î‘ Î”ÎŸÎœÎ— Î—Î›Î™ÎšÎ™Î©Î (Î±Î½Ï„Î¹ÎºÎ±Î¸Î¹ÏƒÏ„Î¬ Ï„Î¿ Ï€Î±Î»Î¹ÏŒ age-inputs) -->
   
        <div class="family-members-container">
    <h2>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Î¤Î± ÎœÎ­Î»Î· Î¤Î·Ï‚ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚ (Î¼Îµ Î±ÎºÏÎ¹Î²ÎµÎ¯Ï‚ Î·Î»Î¹ÎºÎ¯ÎµÏ‚)</h2>
    <div id="family-members-list">
        <div class="family-member-input">
            <span>ğŸ‘¨</span>
            <input type="text" placeholder="ÎŒÎ½Î¿Î¼Î±" value="1Î¿Ï‚ Î•Î½Î®Î»Î¹ÎºÎ±Ï‚" class="member-name">
            <input type="number" placeholder="Î—Î»Î¹ÎºÎ¯Î±" value="" class="member-age" min="18" max="120">
            <span>ÎµÏ„ÏÎ½</span>
        </div>
        <div class="family-member-input">
            <span>ğŸ‘©</span>
            <input type="text" placeholder="ÎŒÎ½Î¿Î¼Î±" value="2Î¿Ï‚ Î•Î½Î®Î»Î¹ÎºÎ±Ï‚" class="member-name">
            <input type="number" placeholder="Î—Î»Î¹ÎºÎ¯Î±" value="" class="member-age" min="18" max="120">
            <span>ÎµÏ„ÏÎ½</span>
        </div>
    </div>
            <!-- ÎšÎŸÎ¥ÎœÎ Î™Î‘ Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—Î£ -->
    <div style="margin: 20px 0; text-align: center;">
        <h3 style="color: #3eb489;">â• Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎœÎµÎ»ÏÎ½</h3>
        <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin: 15px 0;">
            <button onclick="addAdultMember()" style="background: #3eb489; color: white; padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold;">
                ğŸ‘¨ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î•Î½Î®Î»Î¹ÎºÎ±
            </button>
            <button onclick="addChildMember()" style="background: #4c7af0; color: white; padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold;">
                ğŸ§’ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î Î±Î¹Î´Î¹Î¿Ï (6-17)
            </button>
            <button onclick="addBabyMember()" style="background: #ff7f50; color: white; padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold;">
                ğŸ‘¶ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎœÏ‰ÏÎ¿Ï (0-5)
            </button>
        </div>
        <button onclick="updateFamilyMembers()" style="background: #ff7f50; color: white; padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px;">
            ğŸ”„ Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚
        </button>
        <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
            ğŸ’¡ <strong>Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:</strong> Î“Î¹Î± Î·Î»Î¹ÎºÎ¯ÎµÏ‚ 60+ ÏƒÏ…Î¼Î²Î¿Ï…Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î± ÎµÏ€Î¯ÏƒÎ·Î¼Î± sites Î³Î¹Î± ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ ÎµÎºÏ€Ï„ÏÏƒÎµÎ¹Ï‚
        </p>
    </div>
    </div>

    <!-- Î•ÎÎ¥Î ÎÎŸÎ£ Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ COMBO -->
<div style="text-align: center; margin: 20px 0;">
    <button onclick="calculateSmartCombos()" style="padding: 15px 30px; font-size: 18px; border-radius: 14px; background: #9c27b0; color: white; border: none; cursor: pointer; font-weight: bold;">
        ğŸ’° ÎˆÎ¾Ï…Ï€Î½Î¿Ï‚ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Combo
    </button>
    <p style="color: #666; font-size: 0.9em; margin-top: 8px;">
        Î’ÏÎ¯ÏƒÎºÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï„Î± ÎºÎ±Î»ÏÏ„ÎµÏÎ± combos Î³Î¹Î± ÎµÎ¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ· Ï‡ÏÎ·Î¼Î¬Ï„Ï‰Î½
    </p>
</div>

<div id="activities-container-wrapper">
    <div id="activities-container"></div>
</div>
<div class="step-5-btn-container">
    <button class="step-5-btn" onclick="goToStep5()">
        â¡ï¸ ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· ÏƒÏ„Î¿ Î’Î®Î¼Î± 5
    </button>
</div>
  </div>

  <div id="step-summary" class="section">
         <h1>âœ… Î¤ÎµÎ»Î¹ÎºÎ® Î£ÏÎ½Î¿ÏˆÎ·</h1>
    <div id="summary-content" class="summary-content">
    </div>
   
    <div style="text-align: center; margin-top: 30px;">
        <button onclick="goToStep6()" style="padding: 14px 30px; font-size: 18px; border-radius: 14px; background: #3eb489; color: white; border: none; cursor: pointer;">
            ğŸ—ºï¸ Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± ÏƒÏ„Î¿ Î§Î¬ÏÏ„Î· (Î’Î®Î¼Î± 6)
        </button>
    </div>
</div>
 
<div id="step-map" class="section">
    <h1>ğŸ—ºï¸ Î”Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÏŒÏ‚ Î§Î¬ÏÏ„Î·Ï‚ & Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î±</h1>
    <div id="map-container" style="height: 600px; margin: 20px 0; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"></div>
    <div style="text-align: center;">
        <button onclick="initializeSmartMap()" style="padding: 12px 24px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
            ğŸ—ºï¸ Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÎˆÎ¾Ï…Ï€Î½Î¿Ï… Î§Î¬ÏÏ„Î·
        </button>
    </div>
    <!-- ÎšÎŸÎ¥ÎœÎ Î™Î‘ Î”Î™Î‘Î§Î•Î™Î¡Î™Î£Î—Î£ Î§Î‘Î¡Î¤Î— -->
<div style="text-align: center; margin: 15px 0;">
    <button onclick="addCustomPointSmart()" style="padding: 12px 24px; background: #9c27b0; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 5px;">
    ğŸ† ÎˆÎ¾Ï…Ï€Î½Î· Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î£Î·Î¼ÎµÎ¯Î¿Ï…
</button>
    <button onclick="viewCustomPoints()" style="padding: 12px 24px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 5px;">
        ğŸ‘ï¸ Î ÏÎ¿Î²Î¿Î»Î® Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏÎ½ Î£Î·Î¼ÎµÎ¯Ï‰Î½
    </button>
</div>
   <!-- CONTAINER Î“Î™Î‘ Î¤Î‘ CUSTOM POINTS -->
<div id="custom-points-list" style="max-width: 800px; margin: 20px auto; display: none;">
    <h3>ğŸŸ£ Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¬ Î£Î·Î¼ÎµÎ¯Î±</h3>
    <div id="custom-points-container"></div>
</div> 
</div>
</div>

<script>
// ==================== ÎÎ•ÎŸÎ£ Î¤Î¡ÎŸÎ ÎŸÎ£ Î”Î™Î‘Î§Î•Î™Î¡Î™Î£Î—Î£ Î—Î›Î™ÎšÎ™Î©Î ====================
let familyMembers = [
    { name: "Î Î±Ï„Î­ÏÎ±Ï‚", age: 42 },
    { name: "ÎœÎ·Ï„Î­ÏÎ±", age: 40 }
];

// ==================== ÎÎ•Î•Î£ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—Î£ ÎœÎ•Î›Î©Î ====================
function addAdultMember() {
    const container = document.getElementById('family-members-list');
    const adultCount = Array.from(container.querySelectorAll('.family-member-input'))
        .filter(m => m.querySelector('.member-name').value.includes('Î•Î½Î®Î»Î¹ÎºÎ±Ï‚')).length + 1;
   
    const memberDiv = document.createElement('div');
    memberDiv.className = 'family-member-input';
    memberDiv.innerHTML = `
        <span>ğŸ‘¨</span>
        <input type="text" placeholder="ÎŒÎ½Î¿Î¼Î±" value="${adultCount}Î¿Ï‚ Î•Î½Î®Î»Î¹ÎºÎ±Ï‚" class="member-name">
        <input type="number" placeholder="Î—Î»Î¹ÎºÎ¯Î±" value="" class="member-age" min="18" max="120">
        <span>ÎµÏ„ÏÎ½</span>
        <button onclick="removeFamilyMember(this)" class="remove-member-btn">Ã—</button>
    `;
   
    container.appendChild(memberDiv);
}

function addChildMember() {
    const container = document.getElementById('family-members-list');
    const childCount = Array.from(container.querySelectorAll('.family-member-input'))
        .filter(m => m.querySelector('.member-name').value.includes('Î Î±Î¹Î´Î¯')).length + 1;
   
    const memberDiv = document.createElement('div');
    memberDiv.className = 'family-member-input';
    memberDiv.innerHTML = `
        <span>ğŸ§’</span>
        <input type="text" placeholder="ÎŒÎ½Î¿Î¼Î±" value="Î Î±Î¹Î´Î¯ ${childCount}" class="member-name">
        <input type="number" placeholder="Î—Î»Î¹ÎºÎ¯Î±" value="" class="member-age" min="6" max="17">
        <span>ÎµÏ„ÏÎ½</span>
        <button onclick="removeFamilyMember(this)" class="remove-member-btn">Ã—</button>
    `;
   
    container.appendChild(memberDiv);
}

function addBabyMember() {
    const container = document.getElementById('family-members-list');
    const babyCount = Array.from(container.querySelectorAll('.family-member-input'))
        .filter(m => m.querySelector('.member-name').value.includes('ÎœÏ‰ÏÏŒ')).length + 1;
   
    const memberDiv = document.createElement('div');
    memberDiv.className = 'family-member-input';
    memberDiv.innerHTML = `
        <span>ğŸ‘¶</span>
        <input type="text" placeholder="ÎŒÎ½Î¿Î¼Î±" value="ÎœÏ‰ÏÏŒ ${babyCount}" class="member-name">
        <input type="number" placeholder="Î—Î»Î¹ÎºÎ¯Î±" value="" class="member-age" min="0" max="5">
        <span>ÎµÏ„ÏÎ½</span>
        <button onclick="removeFamilyMember(this)" class="remove-member-btn">Ã—</button>
    `;
   
    container.appendChild(memberDiv);
}

function removeFamilyMember(button) {
    button.parentElement.remove();
}

function removeFamilyMember(button) {
    button.parentElement.remove();
}
function updateFamilyMembers() {
    familyMembers = [];
    
    document.querySelectorAll('.family-member-input').forEach(memberDiv => {
        const nameInput = memberDiv.querySelector('.member-name');
        const ageInput = memberDiv.querySelector('.member-age');
        
        const name = nameInput.value;
        let age = parseInt(ageInput.value);
                      
        if (name && age >= 0) {
            familyMembers.push({ name, age });
        }
    });
    
    console.log('âœ… ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ:', familyMembers.length, 'Î¼Î­Î»Î·');
    
    // Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î—
    saveToLocalStorage();
    
    }
// ** 1. Î”Î•Î”ÎŸÎœÎ•ÎÎ‘ (Î¤ÎµÎ»Î¹ÎºÎ® Î»Î¯ÏƒÏ„Î± Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏÎ½)**
let selectedDestinationName = "";
let selectedDaysStay = 0;
let selectedBudget = 0;
    // Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î— Î“Î™Î‘ ÎœÎŸÎ¡Î¦ÎŸÎ ÎŸÎ™Î—Î£Î— Î¤Î™ÎœÎ©Î
function formatPrice(price) {
    if (price === undefined || price === null) return '-';
    if (typeof price === 'number') return price + 'â‚¬';
    return price;
}

const destinations = [
  {name:"Î’Î¹Î­Î½Î½Î·", dist:2, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚", "Î ÏŒÎ»Î·"], costLevel:"ÎœÎ­Ï„ÏÎ¹Î¿", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ", "Î‘ÎœÎ•Î‘", "Î—Î»Î¹ÎºÎ¹Ï‰Î¼Î­Î½Î¿Î¹"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î— Î±Ï…Ï„Î¿ÎºÏÎ±Ï„Î¿ÏÎ¹ÎºÎ® Ï€ÏŒÎ»Î· Î¼Îµ Ï„Î± Ï€Î±Î»Î¬Ï„Î¹Î±, Ï„Î¿Ï…Ï‚ ÎºÎ®Ï€Î¿Ï…Ï‚ ÎºÎ±Î¹ Ï„Î± Î½ÏŒÏƒÏ„Î¹Î¼Î± schnitzel."},
  {name:"Î Î±ÏÎ¯ÏƒÎ¹", dist:3, weather:"ÎŠÎ´Î¹Î±", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚", "Î ÏŒÎ»Î·"], costLevel:"Î‘ÎºÏÎ¹Î²ÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î— ÏÎ¿Î¼Î±Î½Ï„Î¹ÎºÎ® Ï€ÏŒÎ»Î· Ï„Î¿Ï… Ï†Ï‰Ï„ÏŒÏ‚ Î¼Îµ Ï„Î¿Î½ Î ÏÏÎ³Î¿ Ï„Î¿Ï… Î†Î¹Ï†ÎµÎ» ÎºÎ±Î¹ Ï„Î± ÏŒÎ¼Î¿ÏÏ†Î± ÎºÎ±Ï†Î­."},
  {name:"Î¡ÏÎ¼Î·", dist:2, weather:"Î Î¹Î¿ Î¶ÎµÏƒÏ„ÏŒ", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚", "Î ÏŒÎ»Î·"], costLevel:"ÎœÎ­Ï„ÏÎ¹Î¿", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î— Î±Î¹ÏÎ½Î¹Î± Ï€ÏŒÎ»Î· Î¼Îµ Ï„Î¿ ÎšÎ¿Î»Î¿ÏƒÏƒÎ±Î¯Î¿, Ï„Î·Î½ Î¡Ï‰Î¼Î±ÏŠÎºÎ® Î‘Î³Î¿ÏÎ¬ ÎºÎ±Î¹ Ï…Ï€Î­ÏÎ¿Ï‡Î· Î¹Ï„Î±Î»Î¹ÎºÎ® ÎºÎ¿Ï…Î¶Î¯Î½Î±."},
  {name:"Î›Î¿Î½Î´Î¯Î½Î¿", dist:4, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"Î‘ÎºÏÎ¹Î²ÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ", "Î‘ÎœÎ•Î‘"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹"], desc:"Î— Î¼ÎµÎ³Î±Î»Î¿ÏÏ€Î¿Î»Î· Î¼Îµ Ï„Î¿ ÎœÏ€Î¹Î³Îº ÎœÏ€ÎµÎ½, Ï„Î¿ London Eye ÎºÎ±Î¹ Ï„Î± Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ¬ Î¼Î¿Ï…ÏƒÎµÎ¯Î±."},
  {name:"Î†Î¼ÏƒÏ„ÎµÏÎ½Ï„Î±Î¼", dist:3, weather:"ÎŠÎ´Î¹Î±", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎœÎ­Ï„ÏÎ¹Î¿", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹"], desc:"Î— Ï€ÏŒÎ»Î· Ï„Ï‰Î½ ÎºÎ±Î½Î±Î»Î¹ÏÎ½, Ï„Ï‰Î½ Ï€Î¿Î´Î·Î»Î¬Ï„Ï‰Î½ ÎºÎ±Î¹ Ï„Ï‰Î½ ÏŒÎ¼Î¿ÏÏ†Ï‰Î½ Î³ÎµÏ†Ï…ÏÏÎ½."},
  {name:"Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·", dist:2, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚", "Î ÏŒÎ»Î·"], costLevel:"ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ", "Î—Î»Î¹ÎºÎ¹Ï‰Î¼Î­Î½Î¿Î¹"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î— ÏŒÎ¼Î¿ÏÏ†Î· Ï€ÏŒÎ»Î· Ï„Î¿Ï… Î”Î¿ÏÎ½Î±Î²Î· Î¼Îµ Ï„Î± Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ¬ Î»Î¿Ï…Ï„ÏÎ¬ ÎºÎ±Î¹ ÎºÎ¬ÏƒÏ„ÏÎ±."},
  {name:"Î ÏÎ¬Î³Î±", dist:3, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚", "Î ÏŒÎ»Î·"], costLevel:"ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î Î±ÏÎ±Î¼Ï…Î¸Î­Î½Î¹Î± Ï€ÏŒÎ»Î· Î¼Îµ Ï„Î· Î“Î­Ï†Ï…ÏÎ± Ï„Î¿Ï… ÎšÎ±ÏÏŒÎ»Î¿Ï… ÎºÎ±Î¹ Î±ÏƒÏ„ÏÎ¿Î½Î¿Î¼Î¹ÎºÏŒ ÏÎ¿Î»ÏŒÎ¹."},
  {name:"Î’ÎµÏÎ¿Î»Î¯Î½Î¿", dist:3, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎœÎ­Ï„ÏÎ¹Î¿", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ", "Î‘ÎœÎ•Î‘"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹"], desc:"Î ÏŒÎ»Î· Î¼Îµ Ï€Î»Î¿ÏÏƒÎ¹Î± Î¹ÏƒÏ„Î¿ÏÎ¯Î±, Î¼Î¿Ï…ÏƒÎµÎ¯Î± ÎºÎ±Î¹ Î¼Î¿Î½Ï„Î­ÏÎ½Î± Î±ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ®."},
  {name:"ÎœÏŒÎ½Î±Ï‡Î¿", dist:2, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎœÎ­Ï„ÏÎ¹Î¿", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î’Î±Ï…Î±ÏÎ¹ÎºÎ® Ï€ÏÏ‰Ï„ÎµÏÎ¿Ï…ÏƒÎ±, ÎºÎ¿Î½Ï„Î¬ ÏƒÏ„Î¹Ï‚ Î†Î»Ï€ÎµÎ¹Ï‚, Î¼Îµ Ï„Î¿ BMW World."},
  {name:"ÎšÎ¿Î»Ï‰Î½Î¯Î±", dist:3, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎœÎ­Ï„ÏÎ¹Î¿", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹"], desc:"ÎœÎµÎ³Î¬Î»Î¿Ï‚ ÎºÎ±Î¸ÎµÎ´ÏÎ¹ÎºÏŒÏ‚ Î½Î±ÏŒÏ‚, ÏƒÎ¿ÎºÎ¿Î»Î¬Ï„Î± ÎºÎ±Î¹ Î¡Î·Î½Î±Î½Î¯Î±."},
  {name:"Î’Î±ÏÎºÎµÎ»ÏÎ½Î·", dist:3, weather:"Î Î¹Î¿ Î¶ÎµÏƒÏ„ÏŒ", themeparks:"ÎÎ±Î¹", christmas:"ÎŒÏ‡Î¹", vacationType:["Î˜Î¬Î»Î±ÏƒÏƒÎ±", "Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎœÎ­Ï„ÏÎ¹Î¿", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹", "Î†Î½Î¿Î¹Î¾Î·"], desc:"Î“ÎºÎ±Î¿Ï…Î½Ï„Î¯, Ï€Î±ÏÎ±Î»Î¯ÎµÏ‚, ÎºÎ±Î¹ Î· Sagrada Familia."},
  {name:"ÎœÎ±Î´ÏÎ¯Ï„Î·", dist:4, weather:"ÎŠÎ´Î¹Î±", themeparks:"ÎÎ±Î¹", christmas:"ÎŒÏ‡Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎœÎ­Ï„ÏÎ¹Î¿", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î ÏÏ‰Ï„ÎµÏÎ¿Ï…ÏƒÎ± Î¼Îµ Ï€Î»Î¿ÏÏƒÎ¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î¶Ï‰Î® ÎºÎ±Î¹ Î Î¬ÏÎºÎ¿ Î¡ÎµÏ„Î¯ÏÎ¿."},
  {name:"Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î±", dist:4, weather:"Î Î¹Î¿ Î¶ÎµÏƒÏ„ÏŒ", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎŒÏ‡Î¹", vacationType:["Î˜Î¬Î»Î±ÏƒÏƒÎ±", "Î ÏŒÎ»Î·"], costLevel:"ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹", "Î†Î½Î¿Î¹Î¾Î·"], desc:"Î Î¿ÏÏ„Î¿Î³Î±Î»Î¹ÎºÎ® Ï€ÏÏ‰Ï„ÎµÏÎ¿Ï…ÏƒÎ± Î¼Îµ Î³ÏÎ±Ï†Î¹ÎºÎ¬ Ï„ÎµÎ»ÎµÏ†ÎµÏÎ¯Îº ÎºÎ±Î¹ ÏŒÎ¼Î¿ÏÏ†Î± Î±ÎºÏÏ‰Ï„Î®ÏÎ¹Î±."},
  {name:"Î”Î¿Ï…Î²Î»Î¯Î½Î¿", dist:5, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎŒÏ‡Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"Î‘ÎºÏÎ¹Î²ÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹", "Î†Î½Î¿Î¹Î¾Î·"], desc:"Î¦Î¹Î»ÏŒÎ¾ÎµÎ½Î· Ï€ÏŒÎ»Î· Î¼Îµ Ï€Î±Î¼Ï€, ÎºÎ¬ÏƒÏ„ÏÎ± ÎºÎ±Î¹ Ï„Î¿ Î’Î¹Î²Î»Î¯Î¿ Ï„Î¿Ï… Kells."},
  {name:"Î•Î´Î¹Î¼Î²Î¿ÏÏÎ³Î¿", dist:5, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎŒÏ‡Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"Î‘ÎºÏÎ¹Î²ÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹", "Î†Î½Î¿Î¹Î¾Î·"], desc:"Î£ÎºÏ‰Ï„ÏƒÎ­Î¶Î¹ÎºÎ· Ï€ÏÏ‰Ï„ÎµÏÎ¿Ï…ÏƒÎ± Î¼Îµ ÎºÎ¬ÏƒÏ„ÏÎ¿ ÎºÎ±Î¹ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÎºÎ­Î½Ï„ÏÎ¿."},
  {name:"Î–Ï…ÏÎ¯Ï‡Î·", dist:2, weather:"Î§Î¹ÏŒÎ½Î¹Î±", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î¦Ï…ÏƒÎ¹ÎºÎ® ÎŸÎ¼Î¿ÏÏ†Î¹Î¬", "Î ÏŒÎ»Î·"], costLevel:"Î‘ÎºÏÎ¹Î²ÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ", "Î—Î»Î¹ÎºÎ¹Ï‰Î¼Î­Î½Î¿Î¹"], bestSeason:["Î§ÎµÎ¹Î¼ÏÎ½Î±Ï‚", "ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹"], desc:"Î•Î»Î²ÎµÏ„Î¹ÎºÎ® Ï€ÏŒÎ»Î· Î¼Îµ Î»Î¯Î¼Î½Î·, ÏƒÎ¿ÎºÎ¿Î»Î±Ï„Î¿Ï€Î¿Î¹Î¯ÎµÏ‚ ÎºÎ±Î¹ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï‡Î¹Î¿Î½Î¿Î´ÏÎ¿Î¼Î¹ÎºÎ¬."},
  {name:"Î“ÎµÎ½ÎµÏÎ·", dist:2, weather:"Î§Î¹ÏŒÎ½Î¹Î±", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î¦Ï…ÏƒÎ¹ÎºÎ® ÎŸÎ¼Î¿ÏÏ†Î¹Î¬"], costLevel:"Î‘ÎºÏÎ¹Î²ÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ", "Î—Î»Î¹ÎºÎ¹Ï‰Î¼Î­Î½Î¿Î¹"], bestSeason:["Î§ÎµÎ¹Î¼ÏÎ½Î±Ï‚", "ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹"], desc:"Î”Î¹ÎµÎ¸Î½Î®Ï‚ Ï€ÏŒÎ»Î·, Î»Î¯Î¼Î½Î· Î›ÎµÎ¼Î¬Î½ ÎºÎ±Î¹ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Î²Î¿Ï…Î½Î¬."},
  {name:"ÎšÎ¿Ï€ÎµÎ³Ï‡Î¬Î³Î·", dist:4, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"Î‘ÎºÏÎ¹Î²ÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹", "Î†Î½Î¿Î¹Î¾Î·"], desc:"Î”Î±Î½Î­Î¶Î¹ÎºÎ· Ï€ÏŒÎ»Î·, Ï€Î¬ÏÎºÎ¿ Î¤Î¯Î²Î¿Î»Î¹ ÎºÎ±Î¹ Î· ÎœÎ¹ÎºÏÎ® Î“Î¿ÏÎ³ÏŒÎ½Î±."},
  {name:"Î£Ï„Î¿ÎºÏ‡ÏŒÎ»Î¼Î·", dist:5, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"Î‘ÎºÏÎ¹Î²ÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹", "Î†Î½Î¿Î¹Î¾Î·"], desc:"Î ÏÏ‰Ï„ÎµÏÎ¿Ï…ÏƒÎ± Ï„Î·Ï‚ Î£Î¿Ï…Î·Î´Î¯Î±Ï‚, Î½Î·ÏƒÎ¹Î¬ ÎºÎ±Î¹ Ï„Î¿ Î¼Î¿Ï…ÏƒÎµÎ¯Î¿ ABBA."},
  {name:"Î’Î¿Ï…ÎºÎ¿Ï…ÏÎ­ÏƒÏ„Î¹", dist:2, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î¡Î¿Ï…Î¼Î±Î½Î¹ÎºÎ® Ï€ÏÏ‰Ï„ÎµÏÎ¿Ï…ÏƒÎ±, Î¼Îµ Ï„Î¿ Î Î±Î»Î¬Ï„Î¹ Ï„Î¿Ï… ÎšÎ¿Î¹Î½Î¿Î²Î¿Ï…Î»Î¯Î¿Ï…."},
  {name:"ÎŒÏƒÎ»Î¿", dist:4, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î¦Ï…ÏƒÎ¹ÎºÎ® ÎŸÎ¼Î¿ÏÏ†Î¹Î¬", "Î ÏŒÎ»Î·"], costLevel:"Î‘ÎºÏÎ¹Î²ÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹", "Î†Î½Î¿Î¹Î¾Î·"], desc:"ÎÎ¿ÏÎ²Î·Î³Î¹ÎºÎ® Ï€ÏÏ‰Ï„ÎµÏÎ¿Ï…ÏƒÎ±, Ï†Î¹ÏŒÏÎ´ ÎºÎ±Î¹ Î¼Î¿Ï…ÏƒÎµÎ¯Î± Viking."},
  {name:"ÎœÎ¹Î»Î¬Î½Î¿", dist:2, weather:"ÎŠÎ´Î¹Î±", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎœÎ­Ï„ÏÎ¹Î¿", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î ÏÏ‰Ï„ÎµÏÎ¿Ï…ÏƒÎ± Ï„Î·Ï‚ Î¼ÏŒÎ´Î±Ï‚ Î¼Îµ Ï„Î¿Î½ ÎµÎ½Ï„Ï…Ï€Ï‰ÏƒÎ¹Î±ÎºÏŒ ÎÏ„Î¿Ï…ÏŒÎ¼Î¿."},
  {name:"Î¦Î»Ï‰ÏÎµÎ½Ï„Î¯Î±", dist:2, weather:"ÎŠÎ´Î¹Î±", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚", "Î ÏŒÎ»Î·"], costLevel:"ÎœÎ­Ï„ÏÎ¹Î¿", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î— ÎºÎ±ÏÎ´Î¹Î¬ Ï„Î·Ï‚ Î‘Î½Î±Î³Î­Î½Î½Î·ÏƒÎ·Ï‚, Ï„Î­Ï‡Î½Î· ÎºÎ±Î¹ Î±ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ®."},
  {name:"ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¹Î½Î¿ÏÏ€Î¿Î»Î·", dist:2, weather:"ÎŠÎ´Î¹Î±", themeparks:"ÎÎ±Î¹", christmas:"ÎŒÏ‡Î¹", vacationType:["Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚", "Î ÏŒÎ»Î·"], costLevel:"ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î“Î­Ï†Ï…ÏÎ± Î¼ÎµÏ„Î±Î¾Ï Î•Ï…ÏÏÏ€Î·Ï‚ ÎºÎ±Î¹ Î‘ÏƒÎ¯Î±Ï‚, Î‘Î³Î¯Î± Î£Î¿Ï†Î¯Î± ÎºÎ±Î¹ Ï€Î±Î¶Î¬ÏÎ¹Î±."},
  {name:"Î£ÏŒÏ†Î¹Î±", dist:1, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎŒÏ‡Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "Î¦Î¸Î¹Î½ÏŒÏ€Ï‰ÏÎ¿"], desc:"Î’Î¿Ï…Î»Î³Î±ÏÎ¹ÎºÎ® Ï€ÏÏ‰Ï„ÎµÏÎ¿Ï…ÏƒÎ±, Î¼Îµ Ï„Î¿Î½ ÎºÎ±Î¸ÎµÎ´ÏÎ¹ÎºÏŒ Ï„Î¿Ï… Î‘Î»ÎµÎ¾Î¬Î½Î´ÏÎ¿Ï… ÎÎ¹Î­Ï†ÏƒÎºÎ¹."},
  {name:"Î’Î±ÏÏƒÎ¿Î²Î¯Î±", dist:3, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹"], desc:"Î— Ï€ÏÏ‰Ï„ÎµÏÎ¿Ï…ÏƒÎ± Ï„Î·Ï‚ Î Î¿Î»Ï‰Î½Î¯Î±Ï‚ Î¼Îµ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÎºÎ­Î½Ï„ÏÎ¿ ÎºÎ±Î¹ ÏŒÎ¼Î¿ÏÏ†Î± Ï€Î¬ÏÎºÎ±."},
  {name:"ÎšÏÎ±ÎºÎ¿Î²Î¯Î±", dist:2, weather:"Î Î¹Î¿ ÎºÏÏÎ¿", themeparks:"ÎÎ±Î¹", christmas:"ÎÎ±Î¹", vacationType:["Î ÏŒÎ»Î·", "Î Î¿Î»Î¹Ï„Î¹ÏƒÎ¼ÏŒÏ‚"], costLevel:"ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÏŒ", suitableFor:["ÎÎµÎ¿Î³Î­Î½Î½Î·Ï„Î±", "Î Î±Î¹Î´Î¹ÎºÏŒ"], bestSeason:["Î†Î½Î¿Î¹Î¾Î·", "ÎšÎ±Î»Î¿ÎºÎ±Î¯ÏÎ¹"], desc:"Î— Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ® Ï€ÏŒÎ»Î· Î¼Îµ Ï„Î¿ Î²Î±ÏƒÎ¹Î»Î¹ÎºÏŒ ÎºÎ¬ÏƒÏ„ÏÎ¿ Wawel ÎºÎ±Î¹ Ï„Î·Î½ Ï€Î±Î»Î¹Î¬ Ï€ÏŒÎ»Î·."}
];


function toggleFamily(){
  const type = document.getElementById("travel-type").value;
  document.getElementById("family-options").style.display = (type==="ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±")?"flex":"none";
}
// ==================== ğŸ‘‡ Î Î¡ÎŸÎ£Î˜Î•Î£Î• Î‘Î¥Î¤Î— Î¤Î— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î— Î‘ÎšÎ¡Î™Î’Î©Î£ Î•Î”Î© ğŸ‘‡ ====================
function toggleQuickSelection() {
    const quickSelect = document.getElementById('quick-city-select');
    if (quickSelect) {
        quickSelect.style.display = quickSelect.style.display === 'none' ? 'block' : 'none';
        
        // Î‘Î½ Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ ÏƒÏ…Î¼Ï€Î»Î·ÏÏ‰Î¸ÎµÎ¯ Î· Î»Î¯ÏƒÏ„Î± Ï€ÏŒÎ»ÎµÏ‰Î½, Ï„Î· ÏƒÏ…Î¼Ï€Î»Î·ÏÏÎ½Î¿Ï…Î¼Îµ
        if (document.getElementById('quick-city').options.length <= 1) {
            fillQuickCityDropdown();
        }
    } else {
        alert('âš ï¸ Î— Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î³ÏÎ®Î³Î¿ÏÎ·Ï‚ ÎµÏ€Î¹Î»Î¿Î³Î®Ï‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.');
    }
}
function filterDestinations(){
  const distance = document.getElementById("distance").value;
  const weather = document.getElementById("weather").value;
  const themeparks = document.getElementById("themeparks").value;
  const christmas = document.getElementById("christmas").value;
  const vacationType = document.getElementById("vacation-type").value;
  const costLevel = document.getElementById("cost-level").value;
 
  const suitabilityFilters = [];
  document.querySelectorAll('#suitability-options input[type="checkbox"]:checked').forEach(cb => {
    suitabilityFilters.push(cb.value);
  });

  const budget = document.getElementById("travel-budget").value;
  if (budget) {
    selectedBudget = parseInt(budget);
  }

  const filtered = destinations.filter(dest=>{
    let ok=true;
   
    if(distance && distance!==""){
      if(distance==="5") ok = ok && (dest.dist>4);
      else ok = ok && (dest.dist <= parseInt(distance));
    }
    if(weather && weather!=="") ok = ok && (dest.weather===weather);
    if(themeparks && themeparks!=="") ok = ok && (themeparks==="ÎÎ±Î¹"?dest.themeparks==="ÎÎ±Î¹":true);
    if(christmas && christmas!=="") ok = ok && (christmas==="ÎÎ±Î¹"?dest.christmas==="ÎÎ±Î¹":true);
   
    if(vacationType && vacationType!=="") ok = ok && (dest.vacationType && dest.vacationType.includes(vacationType));
    if(costLevel && costLevel!=="") ok = ok && (dest.costLevel===costLevel);
   
    if(suitabilityFilters.length > 0){
      ok = ok && suitabilityFilters.some(filter => dest.suitableFor && dest.suitableFor.includes(filter));
    }
   
    return ok;
  });

  const container = document.getElementById("destination-cards");
  container.innerHTML="";
  if(filtered.length===0) {
    container.innerHTML="<p>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯ Î¼Îµ Î±Ï…Ï„Î¬ Ï„Î± ÎºÏÎ¹Ï„Î®ÏÎ¹Î±.</p>";
    return;
  }
 
  filtered.forEach(dest=>{
    const card = document.createElement("div");
    card.className="destination-card";
    card.innerHTML=`<h3>${dest.name}</h3><p>${dest.desc}</p><button onclick="selectDestination('${dest.name}')">Î£Î¥ÎÎ•Î§Î•Î™Î‘ Î£Î¤ÎŸ Î’Î—ÎœÎ‘ 2</button>`;
    container.appendChild(card);
  });
}

function selectDestination(name) {
    selectedDestinationName = name;
    updateCityBackground(name);
    goToStep2();
}

// ** 3. Î’Î—ÎœÎ‘ 2, 3 & 5 - Î›ÎŸÎ“Î™ÎšÎ— Î Î›ÎŸÎ—Î“Î—Î£Î—Î£ & ÎÎ•ÎÎŸÎ”ÎŸÎ§Î•Î™Î©Î **
function goToStep2(){
  activateStep('step-flight');
}

function goToStep3(){
  activateStep('step-hotel');
  document.getElementById("hotel-destination").value = selectedDestinationName;
}

function searchHotels() {
  const expediaLink = 'https://www.tkqlhce.com/click-101567631-13853200';
  window.open(expediaLink, '_blank');
  const img = document.createElement('img');
  img.src = 'https://www.lduhtrp.net/image-101567631-13853200';
  img.width = 1; img.height = 1; img.border = 0;
  document.body.appendChild(img);
}

async function goToStep4() {
    activateStep('step-activities');
    
    const step4Section = document.getElementById("step-activities");
    const activityContainer = document.getElementById("activities-container");
    const overallTotalDiv = document.getElementById("overall-total");
    const step5BtnContainer = step4Section.querySelector('.step-5-btn-container');

    // 1. Î¦ÎŸÎ¡Î¤Î©Î£Î— Î”Î¡Î‘Î£Î¤Î—Î¡Î™ÎŸÎ¤Î—Î¤Î©Î ÎœÎ• Î¤ÎŸ ÎÎ•ÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘
    const cityData = await loadCityActivities(selectedDestinationName);
    
    if (!cityData || cityData.activities.length === 0) {
        // Î‘Î Î”Î•Î Î’Î¡Î•Î˜ÎŸÎ¥Î Î”Î¡Î‘Î£Î¤Î—Î¡Î™ÎŸÎ¤Î—Î¤Î•Î£
        step4Section.querySelector('h1').innerText = `Î’Î®Î¼Î± 4: Î ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚: ${selectedDestinationName || 'Î§Ï‰ÏÎ¯Ï‚ Î•Ï€Î¹Î»Î¿Î³Î®'}`;
        activityContainer.style.display = 'block';
        overallTotalDiv.style.display = 'none';
        step5BtnContainer.style.display = 'none';
        activityContainer.innerHTML = `
            <div style="text-align:center; font-size:1.5em; color:#ff6b6b; padding:40px; border:2px dashed #ff6b6b; border-radius:15px; background: #fff; margin:20px;">
                <h3>ğŸ—ï¸ Î¥Î ÎŸ ÎšÎ‘Î¤Î‘Î£ÎšÎ•Î¥Î—</h3>
                <p>ÎŸÎ¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î³Î¹Î± Ï„Î·Î½ Ï€ÏŒÎ»Î· <strong>${selectedDestinationName}</strong> Ï€ÏÎ¿ÏƒÏ„Î¯Î¸ÎµÎ½Ï„Î±Î¹ ÏƒÏÎ½Ï„Î¿Î¼Î±!</p>
                <p>ğŸ’¡ ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î±:</p>
                <ul style="text-align:left; display:inline-block; margin:15px 0;">
                    <li>Î•Ï€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÏ„Îµ ÏƒÏ„Î¿ Î’Î®Î¼Î± 1 ÎºÎ±Î¹ ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ Î¬Î»Î»Î· Ï€ÏŒÎ»Î·</li>
                    <li>Î‰ Î½Î± Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ Î³Î¹Î± Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·</li>
                </ul>
                <button onclick="activateStep('step-destination')" style="padding:12px 24px; background:#3eb489; color:white; border:none; border-radius:8px; cursor:pointer; font-size:16px; margin-top:15px;">
                    â†©ï¸ Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î’Î®Î¼Î± 1
                </button>
            </div>
        `;
        return;
    }
    
    // 2. Î•ÎœÎ¦Î‘ÎÎ™Î£Î— Î¤Î™Î¤Î›ÎŸÎ¥
    step4Section.querySelector('h1').innerText = `ÎŸÎ¹ÎºÎ¿Î³ÎµÎ½ÎµÎ¹Î±ÎºÎ­Ï‚ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ - ${cityData.name}`;
    
    // 3. Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î— Î“Î™Î‘ Î§Î¡Î—Î£Î—
    window.currentCityActivities = cityData.activities;
    
    // 4. Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ ÎšÎ‘Î¡Î¤Î©Î
    // 1. Î¦ÏŒÏÏ„Ï‰ÏƒÎµ Ï„Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
const savedData = localStorage.getItem('travelPlannerData');
if (savedData) {
    const data = JSON.parse(savedData);
    
    // 2. Î‘Î½ Î­Ï‡Î¿Ï…Î¼Îµ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½ÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Î³Î¹Î± Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Ï€ÏŒÎ»Î·
    if (data.selectedDestinationName === selectedDestinationName && 
        data.selectedActivities && data.selectedActivities.length > 0) {
        
        console.log("ğŸ”„ Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬", data.selectedActivities.length, "ÎµÏ€Î¹Î»Î¿Î³ÏÎ½...");
        
        // 3. Î£Ï…Î½Î´Ï…Î¬Î¶Î¿Ï…Î¼Îµ: Î Î­ÏÎ½Î¿Ï…Î¼Îµ Ï„Î¹Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î±Ï€ÏŒ Ï„Î¿ JSON ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Ï…Î¼Îµ Ï„Î± selected
        const activitiesWithSelections = cityData.activities.map(activity => {
            // Î‘Î½ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±Ï‚ ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î±
            const isSelected = data.selectedActivities.includes(activity.name);
            return {
                ...activity,  // ÎšÏÎ±Ï„Î¬Î¼Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î¹Î´Î¹ÏŒÏ„Î·Ï„ÎµÏ‚
                selected: isSelected  // Î ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Ï…Î¼Îµ Ï„Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ selected
            };
        });
        
        // 4. Î‘Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Ï…Î¼Îµ ÏƒÏ„Î¿Î½ ÎºÎµÎ½Ï„ÏÎ¹ÎºÏŒ Ï€Î¯Î½Î±ÎºÎ±
        window.currentCityActivities = activitiesWithSelections;
        
        // 5. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ¼Îµ ÎºÎ¬ÏÏ„ÎµÏ‚ Î¼Îµ Ï„Î¹Ï‚ ÏƒÏ‰ÏƒÏ„Î­Ï‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚
        createActivityCardsNew(activitiesWithSelections);
    } else {
        // Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½ÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚
        window.currentCityActivities = cityData.activities;
        createActivityCardsNew(cityData.activities);
    }
} else {
    // Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎºÎ±Î¸ÏŒÎ»Î¿Ï… saved data
    window.currentCityActivities = cityData.activities;
    createActivityCardsNew(cityData.activities);
}
    
    // 5. Î•ÎÎ—ÎœÎ•Î¡Î©Î£Î— ÎŸÎ™ÎšÎŸÎ“Î•ÎÎ•Î™Î‘Î£
    updateFamilyMembers();
    
    // 6. Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ ÎšÎŸÎ£Î¤ÎŸÎ¥Î£
    calculateAllCostsNew();
    
    activityContainer.style.display = 'grid';
    overallTotalDiv.style.display = 'block';
    step5BtnContainer.style.display = 'block';
    
    saveToLocalStorage();
}
function goToStep5(){
    // Î ÏÎ¿Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Leaflet Î³Î¹Î± Î³ÏÎ·Î³Î¿ÏÏŒÏ„ÎµÏÎ¿ Ï‡Î¬ÏÏ„Î·
    preloadLeaflet();
   
    // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î”Î¹Î±Î²Î¬Î¶Î¿Ï…Î¼Îµ Ï€Î¬Î½Ï„Î± Ï„Î¹Ï‚ Î·Î¼Î­ÏÎµÏ‚ Î±Ï€ÏŒ Ï„Î¿ dropdown
    const daysSelect = document.getElementById("days-stay");
    selectedDaysStay = daysSelect.value ? parseInt(daysSelect.value) : 0;
   
    activateStep('step-summary');
    const summaryDiv = document.getElementById('summary-content');
   
    if (!selectedDestinationName) {
        summaryDiv.innerHTML = `
            <h3>âš ï¸ Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒ Î±ÎºÏŒÎ¼Î±</h3>
            <p>Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÏ„Îµ ÏƒÏ„Î¿ Î’Î®Î¼Î± 1 Î³Î¹Î± Î½Î± ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒ.</p>
            <button onclick="activateStep('step-destination')" style="padding: 10px 20px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î’Î®Î¼Î± 1
            </button>
        `;
        return;
    }
   
   const selectedActivities = window.currentCityActivities ? 
    window.currentCityActivities.filter(act => act.selected === true) : [];
    const daysText = selectedDaysStay > 0 ? `${selectedDaysStay} Î¼Î­ÏÎµÏ‚` : "Î¼Î· Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î¼Î­ÏÎµÏ‚";
   
    if (selectedDestinationName.includes("Î’Î¹Î­Î½Î½Î·")) {
        if (selectedActivities.length > 0) {
            const dailyProgram = createSmartDailyProgram(selectedActivities, selectedDaysStay || 1);
            const distancesInfo = calculateDistances(selectedActivities);
           
            summaryDiv.innerHTML = `
                <h3>âœ… Î¤Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ ÏƒÎ±Ï‚ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î³Î¹Î± ${daysText} ÏƒÏ„Î· Î’Î¹Î­Î½Î½Î·!</h3>
                <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; border: 2px solid #3eb489; margin: 15px 0;">
                    <strong>ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½:</strong>
                    ${dailyProgram}
                </div>
                ${distancesInfo}
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border: 1px solid #ffeaa7; margin: 15px 0;">
                    <strong>ÎŸÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏƒÎ±Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (${selectedActivities.length}):</strong>
                    <ul>
                        ${selectedActivities.map(act => `<li>${act.name}</li>`).join('')}
                    </ul>
                </div>
            `;
        } else {
            summaryDiv.innerHTML = `
                <h3>ğŸ›ï¸ Î’Î¹Î­Î½Î½Î· - Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ${daysText}</h3>
                <p>Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î±ÎºÏŒÎ¼Î±. Î•Ï€Î¹ÏƒÏ„ÏÎ­ÏˆÏ„Îµ ÏƒÏ„Î¿ Î’Î®Î¼Î± 4 ÎºÎ±Î¹ ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚!</p>
                <button onclick="activateStep('step-activities')" style="padding: 10px 20px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                    Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î’Î®Î¼Î± 4
                </button>
            `;
        }
        summaryDiv.style.border = '2px dashed #3eb489';
        summaryDiv.style.background = '#e0fff0';
       
    } else if (selectedDestinationName.includes("Î’ÎµÏÎ¿Î»Î¯Î½Î¿")) {
        if (selectedActivities.length > 0) {
           const dailyProgram = createSmartDailyProgram(selectedActivities, selectedDaysStay || 1);
            const distancesInfo = calculateDistances(selectedActivities);
           
            summaryDiv.innerHTML = `
                <h3>âœ… Î¤Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ ÏƒÎ±Ï‚ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î³Î¹Î± ${daysText} ÏƒÏ„Î¿ Î’ÎµÏÎ¿Î»Î¯Î½Î¿!</h3>
                <div style="background: #e8f4f8; padding: 15px; border-radius: 10px; border: 2px solid #4c7af0; margin: 15px 0;">
                    <strong>ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½:</strong>
                    ${dailyProgram}
                </div>
                ${distancesInfo}
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border: 1px solid #ffeaa7; margin: 15px 0;">
                    <strong>ÎŸÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏƒÎ±Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (${selectedActivities.length}):</strong>
                    <ul>
                        ${selectedActivities.map(act => `<li>${act.name}</li>`).join('')}
                    </ul>
                </div>
            `;
        } else {
            summaryDiv.innerHTML = `
                <h3>ğŸ™ï¸ Î’ÎµÏÎ¿Î»Î¯Î½Î¿ - Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ${daysText}</h3>
                <p>Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î±ÎºÏŒÎ¼Î±. Î•Ï€Î¹ÏƒÏ„ÏÎ­ÏˆÏ„Îµ ÏƒÏ„Î¿ Î’Î®Î¼Î± 4 ÎºÎ±Î¹ ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚!</p>
                <p style="color: red; font-size: 0.9em;">ğŸ’¡ Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î­Ï‡ÎµÏ„Îµ ÎºÎ»Î¹ÎºÎ¬ÏÎµÎ¹ ÏƒÏ„Î¹Ï‚ ÎºÎ¬ÏÏ„ÎµÏ‚ Ï„Ï‰Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½ Î³Î¹Î± Î½Î± Ï„Î¹Ï‚ ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ (Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î³Î¯Î½Î¿Ï…Î½ ÎºÎ¯Ï„ÏÎ¹Î½ÎµÏ‚ Î¼Îµ Î±ÏƒÏ„Î­ÏÎ¹ â­)</p>
                <button onclick="activateStep('step-activities')" style="padding: 10px 20px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                    Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î’Î®Î¼Î± 4
                </button>
            `;
        }
        summaryDiv.style.border = '2px dashed #4c7af0';
        summaryDiv.style.background = '#f0f8ff';
    } else if (selectedDestinationName.includes("Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î±")) {
        if (selectedActivities.length > 0) {
            const dailyProgram = createSmartDailyProgram(selectedActivities, selectedDaysStay || 1);
            const distancesInfo = calculateDistances(selectedActivities);
           
            summaryDiv.innerHTML = `
                <h3>âœ… Î¤Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ ÏƒÎ±Ï‚ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î³Î¹Î± ${daysText} ÏƒÏ„Î· Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î±!</h3>
                <div style="background: #ffeaea; padding: 15px; border-radius: 10px; border: 2px solid #ff6b6b; margin: 15px 0;">
                    <strong>ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½:</strong>
                    ${dailyProgram}
                </div>
                ${distancesInfo}
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border: 1px solid #ffeaa7; margin: 15px 0;">
                    <strong>ÎŸÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏƒÎ±Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (${selectedActivities.length}):</strong>
                    <ul>
                        ${selectedActivities.map(act => `<li>${act.name}</li>`).join('')}
                    </ul>
                </div>
            `;
        } else {
            summaryDiv.innerHTML = `
                <h3>ğŸŒŠ Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î± - Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ${daysText}</h3>
                <p>Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î±ÎºÏŒÎ¼Î±. Î•Ï€Î¹ÏƒÏ„ÏÎ­ÏˆÏ„Îµ ÏƒÏ„Î¿ Î’Î®Î¼Î± 4 ÎºÎ±Î¹ ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚!</p>
                <p style="color: red; font-size: 0.9em;">ğŸ’¡ Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î­Ï‡ÎµÏ„Îµ ÎºÎ»Î¹ÎºÎ¬ÏÎµÎ¹ ÏƒÏ„Î¹Ï‚ ÎºÎ¬ÏÏ„ÎµÏ‚ Ï„Ï‰Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½ Î³Î¹Î± Î½Î± Ï„Î¹Ï‚ ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ</p>
                <button onclick="activateStep('step-activities')" style="padding: 10px 20px; background: #ff6b6b; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                    Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î’Î®Î¼Î± 4
                </button>
            `;
        }
        summaryDiv.style.border = '2px dashed #ff6b6b';
        summaryDiv.style.background = '#fff5f5';
    } else if (selectedDestinationName.includes("Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·")) {
        if (selectedActivities.length > 0) {
            const dailyProgram = createSmartDailyProgram(selectedActivities, selectedDaysStay || 1);
            const distancesInfo = calculateDistances(selectedActivities);
           
            summaryDiv.innerHTML = `
                <h3>âœ… Î¤Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ ÏƒÎ±Ï‚ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î³Î¹Î± ${daysText} ÏƒÏ„Î· Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·!</h3>
                <div style="background: #fff0e6; padding: 15px; border-radius: 10px; border: 2px solid #ff9933; margin: 15px 0;">
                    <strong>ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½:</strong>
                    ${dailyProgram}
                </div>
                ${distancesInfo}
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border: 1px solid #ffeaa7; margin: 15px 0;">
                    <strong>ÎŸÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏƒÎ±Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (${selectedActivities.length}):</strong>
                    <ul>
                        ${selectedActivities.map(act => `<li>${act.name}</li>`).join('')}
                    </ul>
                </div>
            `;
        } else {
            summaryDiv.innerHTML = `
                <h3>ğŸ° Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î· - Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ${daysText}</h3>
                <p>Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î±ÎºÏŒÎ¼Î±. Î•Ï€Î¹ÏƒÏ„ÏÎ­ÏˆÏ„Îµ ÏƒÏ„Î¿ Î’Î®Î¼Î± 4 ÎºÎ±Î¹ ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚!</p>
                <button onclick="activateStep('step-activities')" style="padding: 10px 20px; background: #ff9933; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                    Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î’Î®Î¼Î± 4
                </button>
            `;
        }
        summaryDiv.style.border = '2px dashed #ff9933';
        summaryDiv.style.background = '#fff5e6';
   
    } else if (selectedDestinationName.includes("ÎœÎ±Î´ÏÎ¯Ï„Î·")) {
        if (selectedActivities.length > 0) {
            const dailyProgram = createSmartDailyProgram(selectedActivities, selectedDaysStay || 1);
            const distancesInfo = calculateDistances(selectedActivities);
           
            summaryDiv.innerHTML = `
                <h3>âœ… Î¤Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ ÏƒÎ±Ï‚ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î³Î¹Î± ${daysText} ÏƒÏ„Î· ÎœÎ±Î´ÏÎ¯Ï„Î·!</h3>
                <div style="background: #e8f0f8; padding: 15px; border-radius: 10px; border: 2px solid #ff6b35; margin: 15px 0;">
                    <strong>ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½:</strong>
                    ${dailyProgram}
                </div>
                ${distancesInfo}
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border: 1px solid #ffeaa7; margin: 15px 0;">
                    <strong>ÎŸÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏƒÎ±Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (${selectedActivities.length}):</strong>
                    <ul>
                        ${selectedActivities.map(act => `<li>${act.name}</li>`).join('')}
                    </ul>
                </div>
            `;
        } else {
            summaryDiv.innerHTML = `
                <h3>ğŸŒ ÎœÎ±Î´ÏÎ¯Ï„Î· - Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ${daysText}</h3>
                <p>Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î±ÎºÏŒÎ¼Î±. Î•Ï€Î¹ÏƒÏ„ÏÎ­ÏˆÏ„Îµ ÏƒÏ„Î¿ Î’Î®Î¼Î± 4 ÎºÎ±Î¹ ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚!</p>
                <button onclick="activateStep('step-activities')" style="padding: 10px 20px; background: #ff6b35; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                    Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î’Î®Î¼Î± 4
                </button>
            `;
        }
        summaryDiv.style.border = '2px dashed #ff6b35';
        summaryDiv.style.background = '#fff5e6';
   
    } else {
        // Î“Î¹Î± ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Î¬Î»Î»Î¿Ï…Ï‚ Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚
        const daysTextLocal = selectedDaysStay > 0 ? `${selectedDaysStay} Î¼Î­ÏÎµÏ‚` : "Î¼Î· Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î¼Î­ÏÎµÏ‚";
        
        if (selectedActivities.length > 0) {
            const dailyProgram = createSmartDailyProgram(selectedActivities, selectedDaysStay || 1);
            const distancesInfo = calculateDistances(selectedActivities);
            
            summaryDiv.innerHTML = `
                <h3>âœ… Î¤Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ ÏƒÎ±Ï‚ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î³Î¹Î± ${daysTextLocal} ÏƒÏ„Î·Î½ ${selectedDestinationName}!</h3>
                <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; border: 2px solid #3eb489; margin: 15px 0;">
                    <strong>ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½:</strong>
                    ${dailyProgram}
                </div>
                ${distancesInfo}
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border: 1px solid #ffeaa7; margin: 15px 0;">
                    <strong>ÎŸÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏƒÎ±Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (${selectedActivities.length}):</strong>
                    <ul>
                        ${selectedActivities.map(act => `<li>${act.name}</li>`).join('')}
                    </ul>
                </div>
            `;
            summaryDiv.style.border = '2px dashed #3eb489';
            summaryDiv.style.background = '#e0fff0';
            // Î’Î¬Î»Îµ Î±Ï…Ï„ÏŒ Î‘ÎšÎ¡Î™Î’Î©Î£ Ï€ÏÎ¹Î½ Ï„Î¿: } else {
} else if (selectedDestinationName.includes("Î›Î¿Î½Î´Î¯Î½Î¿")) {
    const daysText = selectedDaysStay > 0 ? `${selectedDaysStay} Î¼Î­ÏÎµÏ‚` : "Î¼Î· Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î¼Î­ÏÎµÏ‚";
    
    if (selectedActivities.length > 0) {
        const dailyProgram = createSmartDailyProgram(selectedActivities, selectedDaysStay || 1);
        const distancesInfo = calculateDistances(selectedActivities);
        
        summaryDiv.innerHTML = `
            <h3>ğŸ‡¬ğŸ‡§ Î¤Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ ÏƒÎ±Ï‚ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î³Î¹Î± ${daysText} ÏƒÏ„Î¿ Î›Î¿Î½Î´Î¯Î½Î¿!</h3>
            <div style="background: #e8f4f8; padding: 15px; border-radius: 10px; border: 2px solid #1565c0; margin: 15px 0;">
                <strong>ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½:</strong>
                ${dailyProgram}
            </div>
            ${distancesInfo}
            <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border: 1px solid #ffeaa7; margin: 15px 0;">
                <strong>ÎŸÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏƒÎ±Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (${selectedActivities.length}):</strong>
                <ul>
                    ${selectedActivities.map(act => `<li>${act.name}</li>`).join('')}
                </ul>
            </div>
        `;
        summaryDiv.style.border = '2px dashed #1565c0';
        summaryDiv.style.background = '#f0f8ff';
    } else {
        summaryDiv.innerHTML = `
            <h3>ğŸ‡¬ğŸ‡§ Î›Î¿Î½Î´Î¯Î½Î¿ - Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ${daysText}</h3>
            <p>Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î±ÎºÏŒÎ¼Î±.</p>
            <button onclick="activateStep('step-activities')" style="padding: 10px 20px; background: #1565c0; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¹Ï‚ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚
            </button>
        `;
        summaryDiv.style.border = '2px dashed #1565c0';
        summaryDiv.style.background = '#f0f8ff';
    }
    
// ÎºÎ±Î¹ ÎœÎ•Î¤Î‘ ÏƒÏ…Î½ÎµÏ‡Î¯Î¶ÎµÎ¹ Ï„Î¿ Ï…Ï€Î¬ÏÏ‡Î¿Î½: } else {
        } else {
            summaryDiv.innerHTML = `
                <h3>ğŸ™ï¸ ${selectedDestinationName} - Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ${daysTextLocal}</h3>
                <p>Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î±ÎºÏŒÎ¼Î±. Î•Ï€Î¹ÏƒÏ„ÏÎ­ÏˆÏ„Îµ ÏƒÏ„Î¿ Î’Î®Î¼Î± 4 ÎºÎ±Î¹ ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚!</p>
                <button onclick="activateStep('step-activities')" style="padding: 10px 20px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                    Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î’Î®Î¼Î± 4
                </button>
            `;
            summaryDiv.style.border = '2px dashed #3eb489';
            summaryDiv.style.background = '#e0fff0';
        }
    }
}
function activateStep(targetId) {
    const steps = document.querySelectorAll('.step');
    const sections = document.querySelectorAll('.section');
    steps.forEach(s => s.classList.remove('active'));
    sections.forEach(sec => sec.classList.remove('active'));
   
    document.querySelector(`[data-target="${targetId}"]`).classList.add('active');
    document.getElementById(targetId).classList.add('active');
window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ** 4. Î’Î—ÎœÎ‘ 4 - Î”Î¡Î‘Î£Î¤Î—Î¡Î™ÎŸÎ¤Î—Î¤Î•Î§ **
function createActivityCards(activityList) {
     if (selectedDestinationName.includes("ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¹Î½Î¿ÏÏ€Î¿Î»Î·") || 
        selectedDestinationName.includes("Î Î±ÏÎ¯ÏƒÎ¹") || 
        selectedDestinationName.includes("Î ÏÎ¬Î³Î±")) {
        window.loadedExtraCityActivities = activityList;
    }
  const containerActivities = document.getElementById('activities-container');
  containerActivities.innerHTML = "";
 
  const emojiMap = {
    "Palace": "ğŸ°", "Zoo": "ğŸ¯", "Museum": "ğŸ›ï¸", "Aquarium": "ğŸ ",
    "Park": "ğŸŒ³", "Castle": "ğŸ¯", "Science": "ğŸ”¬", "Music": "ğŸµ",
    "Tower": "ğŸ—¼", "Theme": "ğŸ¡", "History": "ğŸ“œ", "Art": "ğŸ¨",
    "Nature": "ğŸŒ¿", "Adventure": "ğŸ§—", "Cruise": "ğŸš¢", "Garden": "ğŸŒ¸",
    "Schonbrunn": "ğŸ°", "Prater": "ğŸ¡", "Opera": "ğŸ­", "Danube": "ğŸŒ‰",
    "Illuseum": "ğŸ­", "Technikmuseum": "âš™ï¸", "Naturkunde": "ğŸ¦•",
    "LEGOLAND": "ğŸ§±", "Tussauds": "ğŸ‘‘", "Fernsehturm": "ğŸ—¼",
    "OceanÃ¡rio": "ğŸ ", "PavilhÃ£o": "ğŸ”­", "BelÃ©m": "ğŸ°", "Mosteiro": "â›ª",
    "Parliament": "ğŸ›ï¸", "Thermal": "â™¨ï¸", "Eye": "ğŸ¡", "Margaret": "ğŸï¸"
  };
 
  activityList.forEach((act, index) => {
    // Î’ÏÎ¯ÏƒÎºÎ¿Ï…Î¼Îµ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î¿ emoji Î±Ï€ÏŒ Ï„Î¿ ÏŒÎ½Î¿Î¼Î±
    let emoji = "ğŸ“";
    for (const [key, value] of Object.entries(emojiMap)) {
      if (act.name.includes(key)) {
        emoji = value;
        break;
      }
    }
   
    const card = document.createElement('div');
    card.className = "activity-card";
    card.id = `activity-${index}`;
    card.innerHTML = `
      <span class="emoji-icon">${emoji}</span>
      <span class="star">â­</span>
      <div class="activity-info">
        <h3>${act.name}</h3>
        <p>${act.desc}</p>
        ${act.website ? `<a href="${act.website}" target="_blank" style="color: #3eb489; font-weight: bold; text-decoration: none; display: inline-block; margin-top: 10px;">ğŸ”— Î”ÎµÎ¯Ï„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ±</a>` : ''}
        ${act.ageWarning ? `<div style="background: #fff3cd; padding: 5px; border-radius: 6px; margin: 5px 0; font-size: 0.9em; color: #856404;">âš ï¸ ${act.ageWarning}</div>` : ''}
        ${act.priceNote ? `<div style="background: #d1ecf1; padding: 5px; border-radius: 6px; margin: 5px 0; font-size: 0.9em; color: #0c5460;">â„¹ï¸ ${act.priceNote}</div>` : ''}
       <table class="activity-table">
    ${selectedDestinationName.includes("ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¹Î½Î¿ÏÏ€Î¿Î»Î·") || 
      selectedDestinationName.includes("Î Î±ÏÎ¯ÏƒÎ¹") || 
      selectedDestinationName.includes("Î ÏÎ¬Î³Î±") ?
      // ğŸ‘‡ Î“Î™Î‘ ÎšÎ©ÎÎ£Î¤Î‘ÎÎ¤Î™ÎÎŸÎ¥Î ÎŸÎ›Î—, Î Î‘Î¡Î™Î£Î™, Î Î¡Î‘Î“Î‘ ğŸ‘‡
      `<tr><th>0-6</th><th>7-12</th><th>13-17</th><th>18+</th></tr>
       <tr>
          <td>${formatPrice(act.prices["0-6"])}</td>
          <td>${formatPrice(act.prices["7-12"])}</td>
          <td>${formatPrice(act.prices["13-17"])}</td>
          <td>${formatPrice(act.prices["18+"])}</td>
       </tr>` :
      // ğŸ‘‡ Î“Î™Î‘ ÎŸÎ›Î•Î£ Î¤Î™Î£ Î‘Î›Î›Î•Î£ Î ÎŸÎ›Î•Î™Î£ ğŸ‘‡
      `<tr><th>0-2</th><th>3-5</th><th>6-14</th><th>15-19</th><th>18+</th></tr>
       <tr>
          <td>${formatPrice(act.prices["0-2"])}</td>
          <td>${formatPrice(act.prices["3-5"])}</td>
          <td>${formatPrice(act.prices["6-14"])}</td>
          <td>${formatPrice(act.prices["15-19"])}</td>
          <td>${formatPrice(act.prices["18+"])}</td>
       </tr>`
    }
</table>
        <div class="total" id="total-${index}">ÎšÏŒÏƒÏ„Î¿Ï‚: 0 â‚¬</div>
      </div>
    `;
   
    card.addEventListener('click', ()=> {
    card.classList.toggle('selected');
    activityList[index].selected = !activityList[index].selected;
   
    const listToPass = selectedDestinationName.includes("Î’Î¹Î­Î½Î½Î·") ? activities :
                      selectedDestinationName.includes("Î’ÎµÏÎ¿Î»Î¯Î½Î¿") ? activitiesBerlin :
                      selectedDestinationName.includes("Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î±") ? activitiesLisbon :
                      selectedDestinationName.includes("Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·") ? activitiesBudapest :
                      selectedDestinationName.includes("ÎœÎ±Î´ÏÎ¯Ï„Î·") ? activitiesMadrid : // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—
                      activities;
    calculateAllCosts(listToPass);
   
    saveToLocalStorage();
});
    containerActivities.appendChild(card);
  });
}
// ==================== ÎÎ•Î•Î£ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ Î“Î™Î‘ Î¤ÎŸ ÎÎ•ÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘ ====================


// Î’Î¿Î·Î¸Î·Ï„Î¹ÎºÎ®: Î Î¬ÏÏ„Î¹ Ï„Î·Î½ Ï„Î¹Î¼Î® Î³Î¹Î± Î¼Î¹Î± Î·Î»Î¹ÎºÎ¹Î±ÎºÎ® Î¿Î¼Î¬Î´Î±
function getPriceForAgeRange(prices, minAge, maxAge) {
  if (!prices) return 0;
  
  // Î¨Î¬Ï‡Î½Î¿Ï…Î¼Îµ Î³Î¹Î± Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Ï„Î¹Î¼Î® ÏƒÏ„Î·Î½ Î¿Î¼Î¬Î´Î±
  for (let age = minAge; age <= maxAge; age++) {
    if (prices[age] !== undefined) {
      return prices[age];
    }
  }
  
  // Î‘Î½ Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ, Î´Î¿ÎºÎ¹Î¼Î¬Î¶Î¿Ï…Î¼Îµ Ï„Î¿ adult
  return prices.adult || 0;
}

// 2. ÎÎ•ÎŸÎ£ Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ ÎšÎŸÎ£Î¤ÎŸÎ¥Î£
function calculateAllCostsNew() {
    console.log("ğŸ§® Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÎºÏŒÏƒÏ„Î¿Ï…Ï‚ Î³Î¹Î±", familyMembers.length, "Î¼Î­Î»Î·...");
    
    if (!window.currentCityActivities) {
        console.error("âŒ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚!");
        return;
    }
    
    // Î’Î•Î’Î‘Î™Î©Î£ÎŸÎ¥ ÎŸÎ¤Î™ Î— ÎŸÎ™ÎšÎŸÎ“Î•ÎÎ•Î™Î‘ Î•Î™ÎÎ‘Î™ Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎ—
    if (familyMembers.length === 0) {
        alert("âš ï¸ Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Î¿ÏÎ¯ÏƒÎµÎ¹ Î¼Î­Î»Î· Î¿Î¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚! Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î¹Ï‚ Î·Î»Î¹ÎºÎ¯ÎµÏ‚ ÎºÎ±Î¹ Ï€Î±Ï„Î®ÏƒÏ„Îµ 'ğŸ”„ Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚'");
        return;
    }
    
    let overallTotal = 0;
    
    window.currentCityActivities.forEach((act, index) => {
        const card = document.getElementById(`activity-new-${index}`);
        if (!card) return;
        
        const isSelected = card.classList.contains('selected');
        const totalElement = document.getElementById(`total-new-${index}`);
        
        if (isSelected && totalElement) {
            // Î Î¡Î‘Î“ÎœÎ‘Î¤Î™ÎšÎŸÎ£ Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£
            let activityTotal = 0;
            
            familyMembers.forEach(member => {
                const age = member.age;
                let price = 0;
                
                // Î•Î›Î•Î“Î§ÎŸÎ£ Î“Î™Î‘ Î¤Î‘ Î Î‘Î›Î™Î‘ FORMATS
                if (act.prices) {
                    // 1. Î•Î‘Î Î•Î§Î•Î™ ÎÎ•ÎŸ FORMAT (0, 1, 2, ..., adult)
                    if (act.prices[age] !== undefined) {
                        price = act.prices[age];
                    }
                    // 2. Î•Î‘Î Î•Î§Î•Î™ Î Î‘Î›Î™ÎŸ FORMAT (0-2, 3-5, ÎºÎ»Ï€)
                    else if (age <= 2 && act.prices["0-2"] !== undefined) {
                        price = act.prices["0-2"];
                    }
                    else if (age <= 5 && act.prices["3-5"] !== undefined) {
                        price = act.prices["3-5"];
                    }
                    else if (age <= 14 && act.prices["6-14"] !== undefined) {
                        price = act.prices["6-14"];
                    }
                    else if (age <= 19 && act.prices["15-19"] !== undefined) {
                        price = act.prices["15-19"];
                    }
                    else if (act.prices["18+"] !== undefined) {
                        price = act.prices["18+"];
                    }
                    // 3. Î•Î‘Î Î•Î§Î•Î™ JSON FORMAT (0-6, 7-12, ÎºÎ»Ï€)
                    else if (age <= 6 && act.prices["0-6"] !== undefined) {
                        price = act.prices["0-6"];
                    }
                    else if (age <= 12 && act.prices["7-12"] !== undefined) {
                        price = act.prices["7-12"];
                    }
                    else if (age <= 17 && act.prices["13-17"] !== undefined) {
                        price = act.prices["13-17"];
                    }
                    // 4. Î¤Î•Î›Î™ÎšÎŸ: Î•ÎÎ—Î›Î™ÎšÎŸÎ£
                    else if (act.prices["adult"] !== undefined) {
                        price = act.prices["adult"];
                    }
                    else if (act.prices["18+"] !== undefined) {
                        price = act.prices["18+"];
                    }
                }
                
                activityTotal += price;
            });
            
            totalElement.textContent = `ÎšÏŒÏƒÏ„Î¿Ï‚: ${activityTotal} â‚¬`;
            overallTotal += activityTotal;
            
        } else if (totalElement) {
            totalElement.textContent = "ÎšÏŒÏƒÏ„Î¿Ï‚: 0 â‚¬";
        }
    });
    
    const overallElement = document.getElementById('overall-total');
    if (overallElement) {
        overallElement.textContent = `Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½Ï‰Î½ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½: ${overallTotal} â‚¬`;
    }
    
    console.log("ğŸ’° Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚:", overallTotal, "â‚¬");
}
    
// ==================== Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—ÎœÎ•ÎÎ— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î— calculateAllCosts ====================
function calculateAllCosts(activityList = null) {
            if (!activityList) {
        activityList = selectedDestinationName.includes("Î’Î¹Î­Î½Î½Î·") ? activities :
                      selectedDestinationName.includes("Î’ÎµÏÎ¿Î»Î¯Î½Î¿") ? activitiesBerlin :
                      selectedDestinationName.includes("Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î±") ? activitiesLisbon :
                      selectedDestinationName.includes("Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·") ? activitiesBudapest :
                      selectedDestinationName.includes("ÎœÎ±Î´ÏÎ¯Ï„Î·") ? activitiesMadrid :
                      (selectedDestinationName.includes("Î ÏÎ¬Î³Î±") || selectedDestinationName.includes("Î Î±ÏÎ¯ÏƒÎ¹")) ? 
                      (window.loadedExtraCityActivities || []) : // ğŸ‘ˆ Î“Î™Î‘ JSON Î ÎŸÎ›Î•Î™Î£
                      [];
    }
   
    // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Ï‰Î½ familyMembers Ï€ÏÎ¹Î½ Ï„Î¿Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ
    updateFamilyMembers();
   
    let overallTotal = 0;
   
    activityList.forEach((act, index) => {
        const cardElement = document.getElementById(`activity-${index}`);
        const isSelected = cardElement ? cardElement.classList.contains('selected') : false;
       
        act.selected = isSelected;

        if(isSelected){
            let total = 0;
           
            // Î•ÎÎ¥Î ÎÎŸÎ£ Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ Ï€Î¿Ï… ÎºÎ±Ï„Î±Î»Î±Î²Î±Î¯Î½ÎµÎ¹ ÎŸÎ›Î•Î£ Ï„Î¹Ï‚ Î·Î»Î¹ÎºÎ¹Î±ÎºÎ­Ï‚ Î¿Î¼Î¬Î´ÎµÏ‚
familyMembers.forEach(member => {
    let price = 0;
    const age = member.age;
    
    console.log(`   ğŸ‘¤ ${member.name} (${age} ÎµÏ„ÏÎ½):`);
    
    // 1. Î Î¡Î©Î¤Î‘: Î¨Î¬Î¾Îµ Î³Î¹Î± EXACT Î·Î»Î¹ÎºÎ¯Î± (0, 1, 2, 3, ..., 99)
    if (act.prices && act.prices[age] !== undefined) {
        price = act.prices[age];
        console.log(`     âœ… Î’ÏÎ­Î¸Î·ÎºÎµ exact match: ${price}â‚¬`);
    }
    // 2. Î‘Î ÎŸÎ§Î™: Î¨Î¬Î¾Îµ Î³Î¹Î± "adult" price
    else if (act.prices && act.prices.adult !== undefined) {
        price = act.prices.adult;
        console.log(`     âš ï¸ Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ adult price: ${price}â‚¬`);
    }
    // 3. Î¤Î•Î›Î™ÎšÎ‘: default = 0
    else {
        price = 0;
        console.log(`     âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¹Î¼Î® Î³Î¹Î± ${age} ÎµÏ„ÏÎ½`);
    }
    
    total += price;
});
            
           
            if (document.getElementById(`total-${index}`)) {
                document.getElementById(`total-${index}`).innerText = `ÎšÏŒÏƒÏ„Î¿Ï‚: ${total.toFixed(2)} â‚¬`;
            }
            overallTotal += total;
        } else {
            const totalElement = document.getElementById(`total-${index}`);
            if (totalElement) totalElement.innerText = `ÎšÏŒÏƒÏ„Î¿Ï‚: 0 â‚¬`;
        }
    });
   
    const overallTotalElement = document.getElementById('overall-total');
    if (overallTotalElement) {
        overallTotalElement.innerText = `Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½Ï‰Î½ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½: ${overallTotal.toFixed(2)} â‚¬`;
    }

    // Budget Tracker (Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ Î¯Î´Î¹Î¿)
    if (selectedBudget > 0) {
        const budgetStatus = document.getElementById('budget-status') || document.createElement('div');
        budgetStatus.id = 'budget-status';
        budgetStatus.style.cssText = `
            max-width: 1000px;
            margin: 20px auto;
            padding: 15px;
            border-radius: 16px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        `;
       
        const remaining = selectedBudget - overallTotal;
        if (remaining >= 0) {
            budgetStatus.style.background = '#d4edda';
            budgetStatus.style.color = '#155724';
            budgetStatus.style.border = '2px solid #28a745';
            budgetStatus.innerHTML = `
                ğŸ’° <strong>Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚:</strong> ${selectedBudget}â‚¬ |
                ğŸ“Š <strong>ÎÎ¿Î´ÎµÏÏ„Î·ÎºÎµ:</strong> ${overallTotal.toFixed(2)}â‚¬ |
                âœ… <strong>Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿:</strong> ${remaining.toFixed(2)}â‚¬
            `;
        } else {
            budgetStatus.style.background = '#f8d7da';
            budgetStatus.style.color = '#721c24';
            budgetStatus.style.border = '2px solid #dc3545';
            budgetStatus.innerHTML = `
                ğŸ’° <strong>Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚:</strong> ${selectedBudget}â‚¬ |
                ğŸ“Š <strong>ÎÎ¿Î´ÎµÏÏ„Î·ÎºÎµ:</strong> ${overallTotal.toFixed(2)}â‚¬ |
                âŒ <strong>Î¥Ï€Î­ÏÎ²Î±ÏƒÎ·:</strong> ${Math.abs(remaining).toFixed(2)}â‚¬
            `;
        }
       
        if (!document.getElementById('budget-status')) {
            const activitiesContainer = document.getElementById('activities-container-wrapper');
            activitiesContainer.parentNode.insertBefore(budgetStatus, activitiesContainer);
        }
    }
}

// Î‘Î¡Î§Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— & Î Î›ÎŸÎ—Î“Î—Î£Î— SIDEBAR
document.querySelectorAll('.step').forEach(step=>{
  step.addEventListener('click', ()=>{
    const target = step.dataset.target;
    if (target === 'step-activities') {
      goToStep4();
    } else if (target === 'step-summary') {
      goToStep5();
    } else if (target === 'step-map') {
      goToStep6();
    } else {
      activateStep(target);
    }
  });
});

function toggleQuickSelection() {
  const quickSelect = document.getElementById('quick-city-select');
  quickSelect.style.display = quickSelect.style.display === 'none' ? 'block' : 'none';
 
  if (document.getElementById('quick-city').options.length <= 1) {
    fillQuickCityDropdown();
  }
}

function fillQuickCityDropdown() {
    const select = document.getElementById('quick-city');
    select.innerHTML = '<option value="">-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏŒÎ»Î· --</option>';
   
    const sortedDestinations = [...destinations].sort((a, b) => {
        return a.name.localeCompare(b.name, 'el');
    });
   
    sortedDestinations.forEach(dest => {
        const option = document.createElement('option');
        option.value = dest.name;
        option.textContent = dest.name;
        select.appendChild(option);
    });
}

function selectQuickCity() {
  const selectedCity = document.getElementById('quick-city').value;
  const selectedDays = document.getElementById("days-stay").value;
 
  if (selectedCity) {
    selectedDestinationName = selectedCity;
    updateCityBackground(selectedCity);
    selectedDaysStay = selectedDays ? parseInt(selectedDays) : 0;
   
    const budget = document.getElementById("travel-budget").value;
    if (budget) {
        selectedBudget = parseInt(budget);
    }
   
        updateStep1Display();
   
    document.getElementById('quick-city-select').style.display = 'none';
  } else {
    alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î¼Î¹Î± Ï€ÏŒÎ»Î· Î±Ï€ÏŒ Ï„Î· Î»Î¯ÏƒÏ„Î±');
  }
}

function getSelectedActivities() {
  if (!window.currentCityActivities || window.currentCityActivities.length === 0) {
    console.log("âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Ï†Î¿ÏÏ„Ï‰Î¼Î­Î½ÎµÏ‚");
    return [];
  }
  
  // Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†Î¿Ï…Î¼Îµ ÎœÎŸÎÎŸ Ï„Î¹Ï‚ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚
  const selected = window.currentCityActivities.filter(act => act.selected === true);
  console.log(`âœ… Î’ÏÎ­Î¸Î·ÎºÎ±Î½ ${selected.length} ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚`);
  return selected;
}

function createSmartDailyProgram(activities, days) {
    const activitiesWithCoords = activities.filter(act => act.lat && act.lng);
    
    if (activitiesWithCoords.length === 0) {
        // Î‘Î Î›ÎŸÎ£ Î§Î©Î¡Î™Î£ÎœÎŸÎ£ (ÏŒÏ„Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏƒÏ…Î½Ï„ÎµÏ„Î±Î³Î¼Î­Î½ÎµÏ‚)
        if (!activities || activities.length === 0) {
            return '<p>Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚.</p>';
        }
        
        if (!days || days <= 0) days = 1;
        
        let programHTML = '<p>ğŸ—ºï¸ <strong>Î‘Ï€Î»ÏŒ Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î±:</strong></p>';
        const activitiesPerDay = Math.ceil(activities.length / days);
        
        for (let day = 0; day < days; day++) {
            const startIndex = day * activitiesPerDay;
            const endIndex = Math.min(startIndex + activitiesPerDay, activities.length);
            const dayActivities = activities.slice(startIndex, endIndex);
            
            if (dayActivities.length === 0) continue;
            
            const morningActivities = dayActivities.slice(0, Math.ceil(dayActivities.length / 2));
            const afternoonActivities = dayActivities.slice(Math.ceil(dayActivities.length / 2));
            
            programHTML += `
                <div style="margin: 15px 0; padding: 12px; background: white; border-radius: 8px; border-left: 4px solid #ff7f50;">
                    <h4 style="margin: 0 0 8px 0; color: #ff7f50;">ğŸ“ Î—Î¼Î­ÏÎ± ${day + 1}</h4>
                    
                    ${morningActivities.length > 0 ? `
                    <div style="margin-bottom: 8px;">
                        <h5 style="margin: 0 0 4px 0; color: #3eb489;">ğŸŒ… Î ÏÏ‰Î¹Î½ÏŒ (9:00-13:00)</h5>
                        <ul style="margin: 0; padding-left: 20px;">
                            ${morningActivities.map(act => `<li>${act.name}</li>`).join('')}
                        </ul>
                    </div>` : ''}
                    
                    ${afternoonActivities.length > 0 ? `
                    <div style="margin-bottom: 6px;">
                        <h5 style="margin: 0 0 4px 0; color: #4c7af0;">ğŸŒ‡ Î‘Ï€Î¿Î³ÎµÏ…Î¼Î±Ï„Î¹Î½ÏŒ (14:00-18:00)</h5>
                        <ul style="margin: 0; padding-left: 20px;">
                            ${afternoonActivities.map(act => `<li>${act.name}</li>`).join('')}
                        </ul>
                    </div>` : ''}
                </div>
            `;
        }
        
        return programHTML;
    }
    
    // Î•ÎÎ¥Î ÎÎŸÎ£ Î§Î©Î¡Î™Î£ÎœÎŸÎ£ (ÏŒÏ„Î±Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏƒÏ…Î½Ï„ÎµÏ„Î±Î³Î¼Î­Î½ÎµÏ‚)
    const clusters = createSmartClusters(activitiesWithCoords, days);
    
    let programHTML = '<p>ğŸ—ºï¸ <strong>ÎˆÎ¾Ï…Ï€Î½Î¿ Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î¼Îµ Î’Î¬ÏƒÎ· Ï„Î·Î½ Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ· & Î§ÏÏŒÎ½Î¿:</strong></p>';
    
    clusters.forEach((cluster, index) => {
        const morningActivities = cluster.slice(0, Math.ceil(cluster.length / 2));
        const afternoonActivities = cluster.slice(Math.ceil(cluster.length / 2));
        
        programHTML += `
            <div style="margin: 15px 0; padding: 12px; background: white; border-radius: 8px; border-left: 4px solid #ff7f50;">
                <h4 style="margin: 0 0 8px 0; color: #ff7f50;">ğŸ“ Î—Î¼Î­ÏÎ± ${index + 1} - ÎˆÎ¾Ï…Ï€Î½Î¿ Î Î»Î¬Î½Î¿</h4>
                
                ${morningActivities.length > 0 ? `
                <div style="margin-bottom: 8px;">
                    <h5 style="margin: 0 0 4px 0; color: #3eb489;">ğŸŒ… Î ÏÏ‰Î¹Î½ÏŒ (9:00-13:00)</h5>
                    <ul style="margin: 0; padding-left: 20px;">
                        ${morningActivities.map(act => `<li>${act.name}</li>`).join('')}
                    </ul>
                </div>` : ''}
                
                ${afternoonActivities.length > 0 ? `
                <div style="margin-bottom: 6px;">
                    <h5 style="margin: 0 0 4px 0; color: #4c7af0;">ğŸŒ‡ Î‘Ï€Î¿Î³ÎµÏ…Î¼Î±Ï„Î¹Î½ÏŒ (14:00-18:00)</h5>
                    <ul style="margin: 0; padding-left: 20px;">
                        ${afternoonActivities.map(act => `<li>${act.name}</li>`).join('')}
                    </ul>
                </div>` : ''}
                
                <div style="background: #f8f9fa; padding: 6px; border-radius: 4px; margin-top: 6px;">
                    <p style="margin: 0; font-size: 0.8em; color: #666;">
                        âœ… <strong>Î’ÎµÎ»Ï„Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î”Î¹Î±Î´ÏÎ¿Î¼Î®</strong> | 
                        ğŸš¶ <strong>Î•Î»Î¬Ï‡Î¹ÏƒÏ„ÎµÏ‚ ÎœÎµÏ„Î±ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚</strong> | 
                        â±ï¸ <strong>Î™ÏƒÎ¿ÏÏÎ¿Ï€Î·Î¼Î­Î½Î¿Ï‚ Î§ÏÏŒÎ½Î¿Ï‚</strong>
                    </p>
                </div>
            </div>
        `;
    });
    
    return programHTML;
}

function createSmartClusters(activities, numClusters) {
    if (activities.length <= numClusters) {
        const clusters = [];
        for (let i = 0; i < numClusters; i++) {
            clusters.push(activities[i] ? [activities[i]] : []);
        }
        return clusters.filter(cluster => cluster.length > 0);
    }
   
    const centerLat = activities.reduce((sum, act) => sum + act.lat, 0) / activities.length;
    const centerLng = activities.reduce((sum, act) => sum + act.lng, 0) / activities.length;
   
    const activitiesWithDistance = activities.map(act => {
        const distance = Math.sqrt(
            Math.pow(act.lat - centerLat, 2) + Math.pow(act.lng - centerLng, 2)
        );
        return { ...act, distance };
    });
   
    const sortedByDistance = [...activitiesWithDistance].sort((a, b) => a.distance - b.distance);
   
    const clusterSize = Math.ceil(sortedByDistance.length / numClusters);
    const clusters = [];
   
    for (let i = 0; i < numClusters; i++) {
        const start = i * clusterSize;
        const end = start + clusterSize;
        const cluster = sortedByDistance.slice(start, end).map(act => {
            const { distance, ...activityWithoutDistance } = act;
            return activityWithoutDistance;
        });
       
        if (cluster.length > 0) {
            cluster.sort((a, b) => a.lat - b.lat);
            clusters.push(cluster);
        }
    }
   
    return clusters;
}

function goToStep6() {
    activateStep('step-map');
}

// ** Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î— Î“Î™Î‘ Î¤ÎŸÎ Î§Î‘Î¡Î¤Î— **
function preloadLeaflet() {
    if (typeof L === 'undefined') {
        // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· CSS Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
        if (!document.querySelector('link[href*="leaflet"]')) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
            document.head.appendChild(link);
        }
       
        // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· script Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
        if (!document.querySelector('script[src*="leaflet"]')) {
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
            document.head.appendChild(script);
        }
    }
}

function initializeSmartMap() {
const selectedActivities = window.currentCityActivities ? 
    window.currentCityActivities.filter(act => act.selected === true) : [];   const mapContainer = document.getElementById('map-container');
    mapContainer.innerHTML = '<div id="smart-map" style="height: 100%; width: 100%;"></div>';
   
    let mapCenter, mapZoom;
   
    // Î ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÎºÎ­Î½Ï„ÏÎ¿Ï… Î²Î¬ÏƒÎµÎ¹ Ï€ÏŒÎ»Î·Ï‚
    if (selectedDestinationName.includes("Î’ÎµÏÎ¿Î»Î¯Î½Î¿")) {
        mapCenter = [52.5200, 13.4050];
        mapZoom = 12;
    } else if (selectedDestinationName.includes("Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î±")) {
        mapCenter = [38.7223, -9.1393];
        mapZoom = 13;
    } else if (selectedDestinationName.includes("Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·")) {
        mapCenter = [47.4979, 19.0402];
        mapZoom = 13;
    } else {
        // Î ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® Î³Î¹Î± Î’Î¹Î­Î½Î½Î· Î® Î¬Î»Î»ÎµÏ‚
        mapCenter = [48.2082, 16.3738];
        mapZoom = 13;
    }
   
    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï‡Î¬ÏÏ„Î·
    const map = L.map('smart-map').setView(mapCenter, mapZoom);
    
    // Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î— Î§Î‘Î¡Î¤Î— Î“Î™Î‘ Î Î¡ÎŸÎ£Î’Î‘Î£Î—
    window.currentMap = map;
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);
   
    // Î•Î‘Î Î¥Î Î‘Î¡Î§ÎŸÎ¥Î Î•Î Î™Î›Î•Î“ÎœÎ•ÎÎ•Î£ Î”Î¡Î‘Î£Î¤Î—Î¡Î™ÎŸÎ¤Î—Î¤Î•Î£, Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€Î¹Î½ÎµÎ¶ÏÎ½
    if (selectedActivities.length > 0) {
        addActivityMarkers(map, selectedActivities);
    }
   
    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï ÎºÎ»ÎµÎ¹ÏƒÎ¯Î¼Î±Ï„Î¿Ï‚
    addMapCloseButton(mapContainer, map);
    
    // Î¦ÎŸÎ¡Î¤Î©Î£Î— CUSTOM POINTS
    loadCustomPointsOnMap();
}
   
    const mapContainer = document.getElementById('map-container');
    mapContainer.innerHTML = '<div id="smart-map" style="height: 100%; width: 100%;"></div>';
   
    // Î’Î•Î›Î¤Î™Î£Î¤ÎŸÎ ÎŸÎ™Î—Î£Î—: ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Î¿ Leaflet ÎµÎ¯Î½Î±Î¹ Î®Î´Î· Ï†Î¿ÏÏ„Ï‰Î¼Î­Î½Î¿Ï‚
    if (typeof L === 'undefined') {
        // Î‘Î½ ÎŸÎ§Î™, Ï†Î¿ÏÏ„ÏÎ½Î¿Ï…Î¼Îµ ÎºÎ±Î¹ Ï€ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ
        if (!document.querySelector('link[href*="leaflet"]')) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
            document.head.appendChild(link);
        }
       
        if (!document.querySelector('script[src*="leaflet"]')) {
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
            script.onload = () => {
                // ÎœÎ¹ÎºÏÎ® ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ· Î³Î¹Î± ÏƒÎ¯Î³Î¿Ï…ÏÎ¿ Ï†ÏŒÏÏ„Ï‰Î¼Î±
                setTimeout(() => {
    const selectedActivitiesForMap = window.currentCityActivities ? 
        window.currentCityActivities.filter(act => act.selected === true) : [];
    createSmartMapWithActivities(selectedActivitiesForMap);
}, 300);
            };
            document.head.appendChild(script);
        } else {
            // Î¤Î¿ script ÎµÎ¯Î½Î±Î¹ Î®Î´Î· Ï†Î¿ÏÏ„Ï‰Î¼Î­Î½Î¿, Î±Ï€Î»Î¬ Ï€ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ
            setTimeout(() => {
                if (typeof L !== 'undefined') {
                   const selectedActivitiesForMap = window.currentCityActivities ? 
    window.currentCityActivities.filter(act => act.selected === true) : [];
createSmartMapWithActivities(selectedActivitiesForMap);
                } else {
                    // Î‘Î½ Î±ÎºÏŒÎ¼Î± Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Ï„Î¿Î¹Î¼Î¿, Î¾Î±Î½Î±Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î¿ÏÎ¼Îµ
                    setTimeout(() => initializeSmartMap(), 500);
                }
            }, 500);
        }
    } else {
        // ÎŸ Leaflet ÎµÎ¯Î½Î±Î¹ Î‰Î”Î— Ï†Î¿ÏÏ„Ï‰Î¼Î­Î½Î¿Ï‚ - Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ¼Îµ Ï‡Î¬ÏÏ„Î· Î±Î¼Î­ÏƒÏ‰Ï‚
        const selectedActivitiesForMap = window.currentCityActivities ? 
    window.currentCityActivities.filter(act => act.selected === true) : [];
createSmartMapWithActivities(selectedActivitiesForMap);
    }

// ÎÎ•Î‘ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï‡Î¬ÏÏ„Î· Î¼Îµ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (ÎºÎ¿Î¹Î½Î® Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€ÏŒÎ»ÎµÎ¹Ï‚)
function createSmartMapWithActivities(activities) {
    const mapContainer = document.getElementById('map-container');
    const mapDiv = document.getElementById('smart-map');
    
    if (!mapDiv) {
        mapContainer.innerHTML = '<div id="smart-map" style="height: 100%; width: 100%;"></div>';
    }
    
    let mapCenter, mapZoom;
    
    // Î ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÎºÎ­Î½Ï„ÏÎ¿Ï… Î²Î¬ÏƒÎµÎ¹ Ï€ÏŒÎ»Î·Ï‚ (Î Î¡ÎŸÎ£Î˜Î—ÎšÎ— Î›ÎŸÎÎ”Î™ÎÎŸÎ¥)
    if (selectedDestinationName.includes("Î’ÎµÏÎ¿Î»Î¯Î½Î¿")) {
        mapCenter = [52.5200, 13.4050];
        mapZoom = 12;
    } else if (selectedDestinationName.includes("Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î±")) {
        mapCenter = [38.7223, -9.1393];
        mapZoom = 13;
    } else if (selectedDestinationName.includes("Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·")) {
        mapCenter = [47.4979, 19.0402];
        mapZoom = 13;
    } else if (selectedDestinationName.includes("Î›Î¿Î½Î´Î¯Î½Î¿")) {
        mapCenter = [51.5074, -0.1278];  // ÎšÎ•ÎÎ¤Î¡Î™ÎšÎŸ Î£Î—ÎœÎ•Î™ÎŸ Î›ÎŸÎÎ”Î™ÎÎŸÎ¥
        mapZoom = 12;
    } else {
        mapCenter = [48.2082, 16.3738];
        mapZoom = 13;
    }
    
    const map = L.map('smart-map').setView(mapCenter, mapZoom);
    window.currentMap = map;
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);
    
    addActivityMarkers(map, activities);
    addMapCloseButton(mapContainer, map);
    loadCustomPointsOnMap();
}

// ÎÎ•Î‘ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€Î¹Î½ÎµÎ¶ÏÎ½ ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·
function addActivityMarkers(map, activities) {
    console.log("ğŸ“ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€Î¹Î½ÎµÎ¶ÏÎ½ Î³Î¹Î±", activities.length, "Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚");
    
    let selectedMarkers = [];
    let markerColor = 'green';
    
    activities.forEach((activity, index) => {
        // Î•Î›Î•Î“Î§ÎŸÎ£: Î Î‘ÎÎ¤Î‘ Î±Ï€ÏŒ Ï„Î¿ location object
        if (!activity.location || activity.location.lat === undefined) {
            console.warn(`âš ï¸ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ${activity.name} Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ location!`, activity);
            return;
        }
        
        const lat = activity.location.lat;
        const lng = activity.location.lng;
        
        console.log(`   âœ… ${activity.name}: (${lat}, ${lng})`);
        
        const customIcon = L.icon({
            iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${markerColor}.png`,
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34]
        });
        
        const marker = L.marker([lat, lng], { icon: customIcon }).addTo(map);
        
        marker.bindPopup(createPopupContent(activity));
        
        marker.on('click', function() {
            handleMarkerClick(marker, selectedMarkers, map, activity);
        });
    });
    
    if (activities.length > 0) {
        const latlngs = activities
            .filter(a => a.location && a.location.lat !== undefined)
            .map(a => [a.location.lat, a.location.lng]);
        
        if (latlngs.length > 0) {
            const bounds = L.latLngBounds(latlngs);
            map.fitBounds(bounds, { padding: [50, 50], maxZoom: 15 });
        }
    }
}
// ÎÎ•Î‘ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï‡Î¬ÏÏ„Î· Î¼Îµ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (ÎºÎ¿Î¹Î½Î® Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€ÏŒÎ»ÎµÎ¹Ï‚)
function createSmartMapWithActivities(activities) {
    const mapContainer = document.getElementById('map-container');
    const mapDiv = document.getElementById('smart-map');
   
    // Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· ÏŒÏ„Î¹ Î¿ Ï‡Î¬ÏÏ„Î·Ï‚ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
    if (!mapDiv) {
        mapContainer.innerHTML = '<div id="smart-map" style="height: 100%; width: 100%;"></div>';
    }
   
    let mapCenter, mapZoom;
   
    // Î ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÎºÎ­Î½Ï„ÏÎ¿Ï… Î²Î¬ÏƒÎµÎ¹ Ï€ÏŒÎ»Î·Ï‚
    if (selectedDestinationName.includes("Î’ÎµÏÎ¿Î»Î¯Î½Î¿")) {
        mapCenter = [52.5200, 13.4050];
        mapZoom = 12;
    } else if (selectedDestinationName.includes("Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î±")) {
        mapCenter = [38.7223, -9.1393];
        mapZoom = 13;
    } else if (selectedDestinationName.includes("Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·")) {
        mapCenter = [47.4979, 19.0402];
        mapZoom = 13;
    } else {
        // Î ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® Î³Î¹Î± Î’Î¹Î­Î½Î½Î· Î® Î¬Î»Î»ÎµÏ‚
        mapCenter = [48.2082, 16.3738];
        mapZoom = 13;
    }
   
    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï‡Î¬ÏÏ„Î·
    const map = L.map('smart-map').setView(mapCenter, mapZoom);
    // Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î— Î§Î‘Î¡Î¤Î— Î“Î™Î‘ Î Î¡ÎŸÎ£Î’Î‘Î£Î—
window.currentMap = map;
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);
   
    // Î’Î•Î›Î¤Î™Î£Î¤ÎŸÎ ÎŸÎ™Î—Î£Î—: Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€Î¹Î½ÎµÎ¶ÏÎ½ ÎœÎ• Î‘ÎœÎ•Î£Î‘
    addActivityMarkers(map, activities);
   
    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï ÎºÎ»ÎµÎ¹ÏƒÎ¯Î¼Î±Ï„Î¿Ï‚
    addMapCloseButton(mapContainer, map);
        // Î¦ÎŸÎ¡Î¤Î©Î£Î— CUSTOM POINTS
    loadCustomPointsOnMap();
}

// ÎÎ•Î‘ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€Î¹Î½ÎµÎ¶ÏÎ½ ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·
function addActivityMarkers(map, activities) {
    console.log(`âœ… Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ${activities.length} Ï€Î¹Î½ÎµÎ¶ÏÎ½`);
    
    let markerColor = 'green'; // Î Î¬Î½Ï„Î± Ï€ÏÎ¬ÏƒÎ¹Î½Î¿
    
    activities.forEach((activity, index) => {
        // Î•Î›Î•Î“Î§ÎŸÎ£: Î¤Î¹ Î´Î¿Î¼Î® Î­Ï‡Î¿Ï…Î½ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±;
        if (activity.location && activity.location.lat && activity.location.lng) {
            const lat = activity.location.lat;
            const lng = activity.location.lng;
            
            const customIcon = L.icon({
                iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${markerColor}.png`,
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34]
            });
            
            const marker = L.marker([lat, lng], { icon: customIcon }).addTo(map);
            marker.bindPopup(createPopupContent(activity));
            
        } else {
            console.warn(`âš ï¸ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ${activity.name} Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ ÏƒÏ…Î½Ï„ÎµÏ„Î±Î³Î¼Î­Î½ÎµÏ‚!`);
        }
    });
    
    // Fit bounds
    const latlngs = activities
        .filter(a => a.location && a.location.lat && a.location.lng)
        .map(a => [a.location.lat, a.location.lng]);
    
    if (latlngs.length > 0) {
        const bounds = L.latLngBounds(latlngs);
        map.fitBounds(bounds, { padding: [50, 50], maxZoom: 15 });
    }
}

function createPopupContent(activity) {
    // Î”Î­Ï‡ÎµÏ„Î±Î¹ ÎºÎ±Î¹ Ï„Î¹Ï‚ Î´ÏÎ¿ Î´Î¿Î¼Î­Ï‚ (Ï€Î±Î»Î¹Î¬ ÎºÎ±Î¹ Î½Î­Î± JSON)
    const name = activity.name || activity.title || 'Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±';
    const desc = activity.description || activity.desc || '';
    const restaurant = activity.restaurant || 'Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯Î±';
    const website = activity.website || '';
    
    return `
        <div style="max-width: 280px;">
            <h4 style="margin: 0 0 8px 0; color: #3eb489;">${name}</h4>
            <p style="margin: 0 0 8px 0; font-size: 0.9em;">${desc}</p>
            <div style="margin: 6px 0; font-size: 0.9em;">
                <strong>ğŸ½ï¸ ÎšÎ¿Î½Ï„Î¹Î½ÏŒ Î•ÏƒÏ„Î¹Î±Ï„ÏŒÏÎ¹Î¿:</strong><br>${restaurant}
            </div>
            ${website ? `<a href="${website}" target="_blank" style="color: #3eb489; font-weight: bold; text-decoration: none;">ğŸ”— Î”ÎµÎ¯Ï„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ±</a>` : ''}
        </div>
    `;
}

function handleMarkerClick(marker, selectedMarkers, map, activity) {
    console.log("ğŸ“ ÎšÎ»Î¹Îº ÏƒÎµ Ï€Î¹Î½Î­Î¶Î±:", activity.name);
    
    const markerIndex = selectedMarkers.findIndex(m => m === marker);
    
    if (markerIndex === -1) {
        // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î·Î½ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Î»Î¯ÏƒÏ„Î±
        selectedMarkers.push(marker);
        
        // Î‘Î»Î»Î±Î³Î® Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚ ÏŒÏ„Î±Î½ ÎµÏ€Î¹Î»ÎµÎ³ÎµÎ¯
        marker.setIcon(L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
        }));
        
        console.log("âœ… Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ ÏƒÏ„Î¹Ï‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚. Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½Î±:", selectedMarkers.length);
        
    } else {
        // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î±Ï€ÏŒ Ï„Î·Î½ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Î»Î¯ÏƒÏ„Î±
        selectedMarkers.splice(markerIndex, 1);
        
        // Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Ï‡ÏÏÎ¼Î±
        let color = 'green'; // Î ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Î³Î¹Î± Î›Î¿Î½Î´Î¯Î½Î¿
        
        marker.setIcon(L.icon({
            iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
            iconSize: [25, 41],
            iconAnchor: [12, 41],
        }));
        
        console.log("âŒ Î‘Ï†Î±Î¹ÏÎ­Î¸Î·ÎºÎµ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚. Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½Î±:", selectedMarkers.length);
    }
    
    // Î‘Î½ Î­Ï‡Î¿Ï…Î¼Îµ 2 ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ Ï€Î¹Î½Î­Î¶ÎµÏ‚, Î´ÎµÎ¯Î¾Îµ Î´Î¹Î±Î´ÏÎ¿Î¼Î®
    if (selectedMarkers.length === 2) {
        console.log("ğŸ—ºï¸ Î ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚ Î¼ÎµÏ„Î±Î¾Ï 2 ÏƒÎ·Î¼ÎµÎ¯Ï‰Î½");
        showRouteAndDirections(selectedMarkers[0], selectedMarkers[1], map);
        
    } else if (selectedMarkers.length > 2) {
        console.log("âš ï¸ Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î±Ï€ÏŒ 2 ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ - Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Ï„Ï‰Î½ 2 Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Ï‰Î½");
        
        // Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Î¼ÏŒÎ½Î¿ Ï„Ï‰Î½ 2 Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Ï‰Î½
        const oldMarker = selectedMarkers.shift();
        
        // Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® Ï„Î¿Ï… Ï€Î±Î»Î¹Î¿Ï marker ÏƒÏ„Î¿ ÎºÎ±Î½Î¿Î½Î¹ÎºÏŒ Ï‡ÏÏÎ¼Î±
        let color = 'green';
        oldMarker.setIcon(L.icon({
            iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
            iconSize: [25, 41],
            iconAnchor: [12, 41],
        }));
        
        // Î”ÎµÎ¯Î¾Îµ Î´Î¹Î±Î´ÏÎ¿Î¼Î® Î³Î¹Î± Ï„Î± 2 Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î±
        showRouteAndDirections(selectedMarkers[0], selectedMarkers[1], map);
        
    } else {
        console.log("ğŸ—‘ï¸ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚");
        // ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
        if (window.polyline) {
            map.removeLayer(window.polyline);
            window.polyline = null;
        }
        
        // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î¿Î´Î·Î³Î¹ÏÎ½
        const directionsDiv = document.getElementById('route-directions');
        if (directionsDiv) directionsDiv.remove();
    }
}

function addMapCloseButton(mapContainer, map) {
    const closeBtn = document.createElement('button');
    closeBtn.textContent = 'âœ–ï¸ ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Î§Î¬ÏÏ„Î·';
    closeBtn.style.cssText = `
        position: absolute;
        top: 15px;
        right: 15px;
        z-index: 1000;
        padding: 10px 15px;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-family: 'Comic Neue', Arial, Helvetica, sans-serif;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    `;
    closeBtn.onclick = () => {
        mapContainer.innerHTML = `
            <div style="text-align: center; padding: 40px;">
                <p style="font-size: 18px; margin-bottom: 20px;">ÎŸ Ï‡Î¬ÏÏ„Î·Ï‚ Î­ÎºÎ»ÎµÎ¹ÏƒÎµ.</p>
                <button onclick="initializeSmartMap()" style="padding: 12px 25px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                    ğŸ—ºï¸ ÎÎ±Î½Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î§Î¬ÏÏ„Î·
                </button>
            </div>
        `;
    };
    mapContainer.appendChild(closeBtn);
}

function calculateDistances(activities) {
    if (activities.length < 2) return '';
   
    let distancesHTML = '<div style="background: #e8f4f8; padding: 15px; border-radius: 10px; margin: 15px 0; border: 2px solid #4c7af0;"><h4>ğŸ—ºï¸ Î‘Ï€Î¿ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ & ÎœÎµÏ„Î±ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚:</h4>';
   
    for (let i = 0; i < activities.length - 1; i++) {
        const fromAct = activities[i];
        const toAct = activities[i + 1];
       
        if (fromAct.lat && fromAct.lng && toAct.lat && toAct.lng) {
            const distance = calculateDistance(fromAct.lat, fromAct.lng, toAct.lat, toAct.lng);
            distancesHTML += `
                <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 8px;">
                    <strong>${fromAct.name}</strong> â†’ <strong>${toAct.name}</strong>
                    <div style="font-size: 0.9em; margin-top: 5px;">
                        ğŸ“ Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ·: <strong>${distance} km</strong><br>
                        ğŸš¶ Î ÎµÏÏ€Î¬Ï„Î·Î¼Î±: ~${Math.round(distance * 15)} Î»ÎµÏ€Ï„Î¬<br>
                        ğŸš— Î‘Ï…Ï„Î¿ÎºÎ¯Î½Î·Ï„Î¿: ~${Math.round(distance * 3)} Î»ÎµÏ€Ï„Î¬<br>
                        ğŸš‡ ÎœÎœÎœ: ~${Math.round(distance * 5)} Î»ÎµÏ€Ï„Î¬
                    </div>
                    <a href="https://www.google.com/maps/dir/${fromAct.lat},${fromAct.lng}/${toAct.lat},${toAct.lng}" target="_blank" style="color: #4c7af0; font-size: 0.9em;">ğŸ“± Î†Î½Î¿Î¹Î³Î¼Î± Google Maps</a>
                </div>
            `;
        }
    }
   
    distancesHTML += '</div>';
    return distancesHTML;
}

function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    const distance = R * c;
    return distance.toFixed(1);
}

function showRouteAndDirections(marker1, marker2, map) {
    console.log("ğŸ“ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚ Î¼ÎµÏ„Î±Î¾Ï ÏƒÎ·Î¼ÎµÎ¯Ï‰Î½");
    
    if (!marker1 || !marker2 || !map) {
        console.error("âŒ Î›ÎµÎ¯Ï€Î¿Ï…Î½ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Î³Î¹Î± Î´Î¹Î±Î´ÏÎ¿Î¼Î®");
        return;
    }
    
    const latlngs = [marker1.getLatLng(), marker2.getLatLng()];
    
    // ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï€Î±Î»Î¹Î¬Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚
    if (window.polyline) {
        map.removeLayer(window.polyline);
    }
    
    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î±Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚
    window.polyline = L.polyline(latlngs, {
        color: 'red',
        weight: 5,
        opacity: 0.7,
        dashArray: '10, 10'
    }).addTo(map);
    
    // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·Ï‚ (ÏƒÎµ km)
    const distance = map.distance(latlngs[0], latlngs[1]) / 1000;
    console.log("ğŸ“ Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ·:", distance.toFixed(2), "km");
    
    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¿Î´Î·Î³Î¹ÏÎ½
    createDirectionsPanel(latlngs[0], latlngs[1], distance, map);
}
 // ==================== Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ ÎŸÎ”Î—Î“Î™Î©Î ====================

function createDirectionsPanel(point1, point2, distance, map) {
    console.log("ğŸ“ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¿Î´Î·Î³Î¹ÏÎ½ Î³Î¹Î± Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·:", distance.toFixed(2), "km");
    
    // 1. ÎšÎ›Î•Î™Î£Î™ÎœÎŸ Î Î‘Î›Î™Î©Î ÎŸÎ”Î—Î“Î™Î©Î
    const oldDirections = document.getElementById('route-directions');
    if (oldDirections) oldDirections.remove();
    
    // 2. Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ Î§Î¡ÎŸÎÎ©Î ÎœÎ•Î¤Î‘ÎšÎ™ÎÎ—Î£Î—Î£
    const walkTime = Math.round(distance * 15);     // 4 km/h (Ï€ÎµÏÏ€Î¬Ï„Î·Î¼Î±)
    const carTime = Math.round(distance * 3);       // 40 km/h (Î¼Îµ ÎºÎ¯Î½Î·ÏƒÎ·)
    const transitTime = Math.round(distance * 5);   // ÎœÎœÎœ (Î¼Îµ Î±Î½Î±Î¼Î¿Î½Î®)
    const bikeTime = Math.round(distance * 8);      // Î Î¿Î´Î®Î»Î±Ï„Î¿
    
    // 3. Î•Î™Î”Î™ÎšÎ•Î£ Î£Î¥ÎœÎ’ÎŸÎ¥Î›Î•Î£ Î“Î™Î‘ Î›ÎŸÎÎ”Î™ÎÎŸ
    let londonTip = "";
    if (selectedDestinationName.includes("Î›Î¿Î½Î´Î¯Î½Î¿")) {
        londonTip = "ğŸš‡ <strong>Tube Tip:</strong> Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î·Î½ Oyster Card Î® contactless payment Î³Î¹Î± ÎºÎ±Î»ÏÏ„ÎµÏÎµÏ‚ Ï„Î¹Î¼Î­Ï‚!";
    }
    
    // 4. Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ HTML PANEL
    const directionsDiv = document.createElement('div');
    directionsDiv.id = 'route-directions';
    directionsDiv.style.cssText = `
        position: absolute;
        top: 80px;
        left: 15px;
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        z-index: 1000;
        max-width: 380px;
        width: 90%;
        border: 3px solid #3eb489;
        font-family: 'Comic Neue', Arial, sans-serif;
        animation: slideIn 0.3s ease-out;
    `;
    
    directionsDiv.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0; color: #3eb489; font-size: 1.4em;">ğŸ—ºï¸ ÎŸÎ´Î·Î³Î¯ÎµÏ‚ ÎœÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎ·Ï‚</h3>
            <button onclick="closeDirectionsPanel()" 
                    style="background: #e74c3c; color: white; border: none; border-radius: 50%; 
                           width: 30px; height: 30px; cursor: pointer; font-size: 16px; font-weight: bold;">
                Ã—
            </button>
        </div>
        
        <!-- Î‘Î ÎŸÎ£Î¤Î‘Î£Î— -->
        <div style="background: linear-gradient(135deg, #3eb489, #4c7af0); 
                    padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; color: white;">
            <div style="font-size: 14px; margin-bottom: 5px;">ğŸ“ Î‘Î ÎŸÎ£Î¤Î‘Î£Î—</div>
            <div style="font-size: 32px; font-weight: bold; margin-bottom: 5px;">
                ${distance.toFixed(1)} km
            </div>
            <div style="font-size: 12px; opacity: 0.9;">
                ${distance < 1 ? "ÎšÎ¿Î½Ï„Î¬! ğŸ¯" : distance < 3 ? "ÎœÎ­Ï„ÏÎ¹Î± Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ· ğŸ‘Œ" : "ÎœÎ±ÎºÏÎ¹Î¬ âš ï¸"}
            </div>
        </div>
        
        <!-- Î§Î¡ÎŸÎÎŸÎ™ ÎœÎ•Î¤Î‘ÎšÎ™ÎÎ—Î£Î—Î£ -->
        <div style="margin-bottom: 20px;">
            <h4 style="margin: 0 0 12px 0; color: #2c3e50; font-size: 1.1em;">â±ï¸ Î•ÎºÏ„Î¹Î¼ÏÎ¼ÎµÎ½Î¿Ï‚ Î§ÏÏŒÎ½Î¿Ï‚</h4>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                <div style="padding: 12px; background: #e8f5e9; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px;">ğŸš¶</div>
                    <div style="font-size: 16px; font-weight: bold; color: #2e7d32;">${walkTime} Î»ÎµÏ€Ï„Î¬</div>
                    <div style="font-size: 11px; color: #666; margin-top: 3px;">Î ÎµÏÏ€Î¬Ï„Î·Î¼Î±</div>
                    <div style="font-size: 10px; color: #888; margin-top: 2px;">~${(distance / 4).toFixed(1)} ÏÏÎµÏ‚</div>
                </div>
                
                <div style="padding: 12px; background: #e3f2fd; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px;">ğŸš—</div>
                    <div style="font-size: 16px; font-weight: bold; color: #1565c0;">${carTime} Î»ÎµÏ€Ï„Î¬</div>
                    <div style="font-size: 11px; color: #666; margin-top: 3px;">Î‘Ï…Ï„Î¿ÎºÎ¯Î½Î·Ï„Î¿</div>
                    <div style="font-size: 10px; color: #888; margin-top: 2px;">+Ï€Î¬ÏÎºÎ¹Î½Î³Îº</div>
                </div>
                
                <div style="padding: 12px; background: #fff3e0; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px;">ğŸš‡</div>
                    <div style="font-size: 16px; font-weight: bold; color: #f57c00;">${transitTime} Î»ÎµÏ€Ï„Î¬</div>
                    <div style="font-size: 11px; color: #666; margin-top: 3px;">ÎœÎœÎœ</div>
                    <div style="font-size: 10px; color: #888; margin-top: 2px;">+Î±Î½Î±Î¼Î¿Î½Î®</div>
                </div>
                
                <div style="padding: 12px; background: #f3e5f5; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px;">ğŸš²</div>
                    <div style="font-size: 16px; font-weight: bold; color: #7b1fa2;">${bikeTime} Î»ÎµÏ€Ï„Î¬</div>
                    <div style="font-size: 11px; color: #666; margin-top: 3px;">Î Î¿Î´Î®Î»Î±Ï„Î¿</div>
                    <div style="font-size: 10px; color: #888; margin-top: 2px;">Santander bikes</div>
                </div>
            </div>
        </div>
        
        <!-- GOOGLE MAPS LINK -->
        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: center;">
            <a href="https://www.google.com/maps/dir/${point1.lat},${point1.lng}/${point2.lat},${point2.lng}"
               target="_blank"
               style="display: block; padding: 14px; background: #4c7af0; color: white; 
                      text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px;
                      transition: all 0.3s; border: 2px solid #4c7af0;">
                <span style="font-size: 20px; margin-right: 8px;">ğŸ“±</span>
                Î†Î½Î¿Î¹Î³Î¼Î± Google Maps
                <span style="font-size: 14px; margin-left: 8px;">â†—ï¸</span>
            </a>
            <p style="font-size: 12px; color: #666; margin-top: 8px; margin-bottom: 0;">
                Î˜Î± Î±Î½Î¿Î¯Î¾ÎµÎ¹ ÏƒÎµ Î½Î­Î± ÎºÎ±ÏÏ„Î­Î»Î± Î¼Îµ Ï€Î»Î®ÏÎµÎ¹Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚
            </p>
        </div>
        
        <!-- Î£Î¥ÎœÎ’ÎŸÎ¥Î›Î•Î£ -->
        ${londonTip ? `
        <div style="background: #e8f4f8; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #1565c0;">
            <div style="font-size: 13px; color: #1565c0;">
                ${londonTip}
            </div>
        </div>` : ''}
        
        <div style="background: #fff8e1; padding: 12px; border-radius: 8px; border-left: 4px solid #ff9800;">
            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                <span style="font-size: 18px; margin-right: 8px;">ğŸ’¡</span>
                <strong style="color: #f57c00;">Î“ÏÎ®Î³Î¿ÏÎµÏ‚ ÎŸÎ´Î·Î³Î¯ÎµÏ‚</strong>
            </div>
            <div style="font-size: 12px; color: #666;">
                <ul style="margin: 0; padding-left: 20px;">
                    <li><strong>Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î± ÎœÎœÎœ</strong> Î³Î¹Î± Î³ÏÎ®Î³Î¿ÏÎ· Î¼ÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎ· ÏƒÏ„Î¿ ÎºÎ­Î½Ï„ÏÎ¿</li>
                    <li><strong>Î ÎµÏÏ€Î¬Ï„Î·Î¼Î±</strong> Î³Î¹Î± Î±Ï€Î¿ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ ÎºÎ¬Ï„Ï‰ Ï„Ï‰Î½ 2km</li>
                    <li><strong>Î Î¿Î´Î®Î»Î±Ï„Î¿</strong> Î¼Îµ Santander Bikes Î³Î¹Î± ÎµÏ…Î­Î»Î¹ÎºÏ„Î· Î¼ÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎ·</li>
                </ul>
            </div>
        </div>
    `;
    
    // 5. CSS ANIMATION
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        #route-directions a:hover {
            background: #3a6bd9 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 122, 240, 0.3);
        }
    `;
    directionsDiv.appendChild(style);
    
    // 6. Î Î¡ÎŸÎ£Î˜Î—ÎšÎ— Î£Î¤ÎŸÎ Î§Î‘Î¡Î¤Î—
    map.getContainer().appendChild(directionsDiv);
    
    // 7. CLICK OUTSIDE TO CLOSE
    setTimeout(() => {
        const closeOnClickOutside = (e) => {
            if (directionsDiv && 
                !directionsDiv.contains(e.target) && 
                !e.target.closest('.leaflet-marker-icon')) {
                closeDirectionsPanel();
                document.removeEventListener('click', closeOnClickOutside);
            }
        };
        
        // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· event listener Î¼Îµ Î¼Î¹ÎºÏÎ® ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ·
        setTimeout(() => {
            document.addEventListener('click', closeOnClickOutside);
        }, 100);
    }, 0);
}

// ==================== Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: ÎšÎ›Î•Î™Î£Î™ÎœÎŸ ÎŸÎ”Î—Î“Î™Î©Î ====================

function closeDirectionsPanel() {
    console.log("ğŸ—‘ï¸ ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Î¿Î´Î·Î³Î¹ÏÎ½ Î¼ÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎ·Ï‚");
    
    // 1. Î‘Î¦Î‘Î™Î¡Î•Î£Î— ÎŸÎ”Î—Î“Î™Î©Î
    const directionsDiv = document.getElementById('route-directions');
    if (directionsDiv) {
        directionsDiv.style.animation = 'slideOut 0.2s ease-in';
        setTimeout(() => directionsDiv.remove(), 200);
    }
    
    // 2. ÎšÎ‘Î˜Î‘Î¡Î™Î£ÎœÎŸÎ£ Î”Î™Î‘Î”Î¡ÎŸÎœÎ—Î£
    if (window.polyline && window.currentMap) {
        window.currentMap.removeLayer(window.polyline);
        window.polyline = null;
    }
    
    // 3. ÎšÎ‘Î˜Î‘Î¡Î™Î£ÎœÎŸÎ£ Î•Î Î™Î›Î•Î“ÎœÎ•ÎÎ©Î MARKERS
    if (window.customMarkers) {
        window.customMarkers.forEach(markerObj => {
            const color = 'green'; // Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ ÎºÎ±Î½Î¿Î½Î¹ÎºÏŒ Ï‡ÏÏÎ¼Î±
            markerObj.marker.setIcon(L.icon({
                iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
                iconSize: [25, 41],
                iconAnchor: [12, 41]
            }));
        });
    }
    
    // 4. ÎšÎ‘Î˜Î‘Î¡Î™Î£ÎœÎŸÎ£ GLOBAL SELECTED MARKERS
    if (window.selectedMarkersForRoute) {
        window.selectedMarkersForRoute = [];
    }
}

// ==================== CSS Î“Î™Î‘ ÎšÎ›Î•Î™Î£Î™ÎœÎŸ ====================
// Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· CSS animation Î³Î¹Î± ÎºÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿
if (!document.querySelector('#route-directions-style')) {
    const closeStyle = document.createElement('style');
    closeStyle.id = 'route-directions-style';
    closeStyle.textContent = `
        @keyframes slideOut {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-20px); opacity: 0; }
        }
    `;
    document.head.appendChild(closeStyle);
}   
function isMobile() {
    return window.innerWidth <= 640;
}

function checkMobileView() {
    const mobileNav = document.querySelector('.mobile-nav');
    const sidebar = document.querySelector('.sidebar');
   
    if (isMobile()) {
        if (mobileNav) mobileNav.style.display = 'block';
        if (sidebar) sidebar.style.display = 'none';
    } else {
        if (mobileNav) mobileNav.style.display = 'none';
        if (sidebar) sidebar.style.display = 'block';
    }
}

window.addEventListener('resize', checkMobileView);
window.addEventListener('load', checkMobileView);


function updateCityBackground(cityName) {
    const cityBackgrounds = {
        "Î’Î¹Î­Î½Î½Î·": "https://images.unsplash.com/photo-1516550893923-42d28e5677af?w=1200",
        "Î’ÎµÏÎ¿Î»Î¯Î½Î¿": "https://images.unsplash.com/photo-1587330979470-3595ac045ab0?w=1200",
        "Î Î±ÏÎ¯ÏƒÎ¹": "https://images.unsplash.com/photo-1499856871958-5b9627545d1a?w=1200", 
        "Î¡ÏÎ¼Î·": "https://images.unsplash.com/photo-1552832230-c0197dd311b5?w=1200",
        "Î›Î¿Î½Î´Î¯Î½Î¿": "https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=1200",
        "Î†Î¼ÏƒÏ„ÎµÏÎ½Ï„Î±Î¼": "https://images.unsplash.com/photo-1512470876302-972faa2aa9a4?w=1200",
        "Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·": "https://cdn.pixabay.com/photo/2017/06/12/19/02/budapest-2396725_1280.jpg",
        "Î ÏÎ¬Î³Î±": "https://images.unsplash.com/photo-1592906209472-a36b1f3782ef?w=1200",
        "ÎœÏŒÎ½Î±Ï‡Î¿": "https://images.unsplash.com/photo-1595867818082-083862f3d630?w=1200",
        "ÎšÎ¿Î»Ï‰Î½Î¯Î±": "https://images.unsplash.com/photo-1467269204594-9661b134dd2b?w=1200",
        "Î’Î±ÏÎºÎµÎ»ÏÎ½Î·": "https://images.unsplash.com/photo-1583422409516-2895a77efded?w=1200",
        "ÎœÎ±Î´ÏÎ¯Ï„Î·": "https://images.unsplash.com/photo-1539037116277-4db20889f2d4?w=1200",
        "Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î±": "https://images.unsplash.com/photo-1544025162-d76694265947?w=1200&auto=format&fit=crop",  
        "Î”Î¿Ï…Î²Î»Î¯Î½Î¿": "https://images.unsplash.com/photo-1549918864-6bac32c52dcb?w=1200",
        "Î•Î´Î¹Î¼Î²Î¿ÏÏÎ³Î¿": "https://images.unsplash.com/photo-1507089947368-19c1da9775ae?w=1200",
        "Î–Ï…ÏÎ¯Ï‡Î·": "https://images.unsplash.com/photo-1544483048-8b74d33a11bd?w=1200",
        "Î“ÎµÎ½ÎµÏÎ·": "https://images.unsplash.com/photo-1503919545889-aef636e10ad4?w=1200",
        "ÎšÎ¿Ï€ÎµÎ³Ï‡Î¬Î³Î·": "https://images.unsplash.com/photo-1513622472932-bd5c45e1987b?w=1200",
        "Î£Ï„Î¿ÎºÏ‡ÏŒÎ»Î¼Î·": "https://images.unsplash.com/photo-1506970843675-04a04c64ad6f?w=1200",
        "Î’Î¿Ï…ÎºÎ¿Ï…ÏÎ­ÏƒÏ„Î¹": "https://images.unsplash.com/photo-1594736797933-d0f289d3f0b3?w=1200",
        "ÎŒÏƒÎ»Î¿": "https://images.unsplash.com/photo-1583149454066-4c76b4d2ad23?w=1200",
        "ÎœÎ¹Î»Î¬Î½Î¿": "https://images.unsplash.com/photo-1610018556010-6c6d89b95a0a?w=1200",
        "Î¦Î»Ï‰ÏÎµÎ½Ï„Î¯Î±": "https://images.unsplash.com/photo-1543429259-5070ada7b72c?w=1200",
        "ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¹Î½Î¿ÏÏ€Î¿Î»Î·": "https://images.unsplash.com/photo-1524231757912-21f4fe3a7200?w=1200",
        "Î£ÏŒÏ†Î¹Î±": "https://images.unsplash.com/photo-1578351120013-6e2ada1d570d?w=1200",
        "Î’Î±ÏÏƒÎ¿Î²Î¯Î±": "https://images.unsplash.com/photo-1590330237165-7c36d3d82b44?w=1200",
        "ÎšÏÎ±ÎºÎ¿Î²Î¯Î±": "https://images.unsplash.com/photo-1544298628-3a4c18a4fb6b?w=1200"
    };
   
    const backgroundUrl = cityBackgrounds[cityName] || 'https://images.unsplash.com/photo-1483728642387-6c3bdd6c93e5?w=1200';
   
    const img = new Image();
    img.src = backgroundUrl;
   
    img.onload = function() {
        document.body.style.backgroundImage = `linear-gradient(rgba(255,255,255,0.25), rgba(255,255,255,0.4)), url(${backgroundUrl})`;
    };
}

function resetFilters(){
  document.querySelectorAll('select').forEach(select => select.value = '');
  document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
  document.getElementById("travel-budget").value = '';
  filterDestinations();
}

// ==================== Î‘Î¥Î¤ÎŸÎœÎ‘Î¤Î— Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î— ÎšÎ‘Î™ Î•Î Î‘ÎÎ‘Î¦ÎŸÎ¡Î¤Î©Î£Î— ====================
function saveToLocalStorage() {
    const data = {
        selectedDestinationName,
        selectedDaysStay,
        selectedBudget,
        selectedActivities: getSelectedActivities().map(act => act.name),
        familyMembers: familyMembers
    };
    localStorage.setItem('travelPlannerData', JSON.stringify(data));
}

function loadFromLocalStorage() {
    const saved = localStorage.getItem('travelPlannerData');
    if (saved) {
        const data = JSON.parse(saved);
       
        const shouldContinue = confirm('ğŸ“‹ Î’ÏÎ­Î¸Î·ÎºÎµ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ ÏƒÏ‡Î­Î´Î¹Î¿ Ï„Î±Î¾Î¹Î´Î¹Î¿Ï! Î˜Î­Î»ÎµÏ„Îµ Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÏ„Îµ Î±Ï€ÏŒ ÎµÎºÎµÎ¯ Ï€Î¿Ï… ÎµÎ¯Ï‡Î±Ï„Îµ Î¼ÎµÎ¯Î½ÎµÎ¹;');
       
        if (shouldContinue) {
            selectedDestinationName = data.selectedDestinationName || "";
            selectedDaysStay = data.selectedDaysStay || 0;
            selectedBudget = data.selectedBudget || 0;
           
            // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Î·Î¼ÎµÏÏÎ½
            if (selectedDaysStay > 0) {
                document.getElementById("days-stay").value = selectedDaysStay;
            }
           
            // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ budget
            if (selectedBudget > 0) {
                document.getElementById("travel-budget").value = selectedBudget;
            }
           
            // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ family members
            if (data.familyMembers && data.familyMembers.length > 0) {
                familyMembers = data.familyMembers;
                updateFamilyMembersUI();
            }
           
            // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Ï‰Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½
            if (data.selectedActivities && data.selectedActivities.length > 0) {
                window.savedActivities = data.selectedActivities;
            }
           
            setTimeout(() => {
                alert(`âœ… Î¦Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ ÏƒÏ‡Î­Î´Î¹Î¿:\nğŸ™ï¸ Î ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚: ${selectedDestinationName || 'ÎšÎ±Î½Î­Î½Î±Ï‚'}\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÎœÎ­Î»Î·: ${familyMembers.length}\nğŸ“… ÎœÎ­ÏÎµÏ‚: ${selectedDaysStay}\nğŸ’° Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚: ${selectedBudget}â‚¬`);
            }, 500);
        } else {
            localStorage.removeItem('travelPlannerData');
        }
    }
}

// Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î— Î“Î™Î‘ Î•Î Î‘ÎÎ‘Î¦ÎŸÎ¡Î¤Î©Î£Î— UI
function updateFamilyMembersUI() {
    const container = document.getElementById('family-members-list');
    container.innerHTML = '';
   
    familyMembers.forEach((member, index) => {
        const emoji = index === 0 ? 'ğŸ‘¨' : index === 1 ? 'ğŸ‘©' : 'ğŸ§’';
        const memberDiv = document.createElement('div');
        memberDiv.className = 'family-member-input';
        memberDiv.innerHTML = `
            <span>${emoji}</span>
            <input type="text" placeholder="ÎŒÎ½Î¿Î¼Î±" value="${member.name}" class="member-name">
            <input type="number" placeholder="Î—Î»Î¹ÎºÎ¯Î±" value="${member.age}" class="member-age" min="0" max="120">
            <span>ÎµÏ„ÏÎ½</span>
            ${index >= 2 ? '<button onclick="removeFamilyMember(this)" class="remove-member-btn">Ã—</button>' : ''}
        `;
        container.appendChild(memberDiv);
    });
}

// Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î·Î¼ÎµÏÏÎ½ ÏŒÏ„Î±Î½ Î±Î»Î»Î¬Î¶ÎµÎ¹ Ï„Î¿ dropdown - Î¼Îµ autosave
document.getElementById("days-stay").addEventListener("change", function() {
    selectedDaysStay = this.value ? parseInt(this.value) : 0;
    saveToLocalStorage();
   
    updateStep1Display();
   
    if (document.getElementById('step-summary').classList.contains('active')) {
        setTimeout(() => goToStep5(), 100);
    }
});

function updateDaysStay() {
    const daysSelect = document.getElementById("days-stay");
    selectedDaysStay = daysSelect.value ? parseInt(daysSelect.value) : 0;
   
    saveToLocalStorage();
   
    updateStep1Display();
   
    if (document.getElementById('step-summary').classList.contains('active')) {
        goToStep5();
    }
   
    const message = document.createElement('div');
    message.textContent = `âœ… Î•Î½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎ±Î½ Î¿Î¹ Î¼Î­ÏÎµÏ‚: ${selectedDaysStay}`;
    message.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #3eb489; color: white; padding: 10px; border-radius: 8px; z-index: 10000;';
    document.body.appendChild(message);
    setTimeout(() => message.remove(), 3000);
}

function clearAllData() {
    if (confirm('âš ï¸ Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ ÎŸÎ›Î‘ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï„Î¿Ï… Ï„Î±Î¾Î¹Î´Î¹Î¿Ï; Î‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±Î¹ÏÎµÎ¸ÎµÎ¯.')) {
        localStorage.removeItem('travelPlannerData');
        familyMembers = [
            { name: "Î Î±Ï„Î­ÏÎ±Ï‚", age: 42 },
            { name: "ÎœÎ·Ï„Î­ÏÎ±", age: 40 }
        ];
        updateFamilyMembersUI();
        location.reload();
    }
}

function updateStep1Display() {
    const destinationCards = document.getElementById('destination-cards');
   
    destinationCards.innerHTML = `
        <div style="text-align: center; padding: 20px; background: #d4edda; border-radius: 12px; border: 2px solid #3eb489;">
            <h3>âœ… Î•Ï€Î¹Î»Î­Î¾Î±Ï„Îµ: ${selectedDestinationName}</h3>
            <p>ğŸ“… Î”Î¹Î¬ÏÎºÎµÎ¹Î± Î´Î¹Î±ÎºÎ¿Ï€ÏÎ½: ${selectedDaysStay > 0 ? selectedDaysStay + ' Î¼Î­ÏÎµÏ‚' : 'Î¼Î· Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î¼Î­ÏÎµÏ‚'}</p>
            <p>ğŸ’° Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚: ${selectedBudget > 0 ? selectedBudget + 'â‚¬' : 'Î”ÎµÎ½ Î¿ÏÎ¯ÏƒÏ„Î·ÎºÎµ'}</p>
            <p>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÎœÎ­Î»Î· Î¿Î¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚: ${familyMembers.length}</p>
            <p>ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÏ„Îµ ÏƒÏ„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î²Î®Î¼Î±</p>
            <button onclick="goToStep2()" style="padding: 10px 20px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± ÏƒÏ„Î¿ Î’Î®Î¼Î± 2
            </button>
        </div>
    `;
}

// ÎšÎ»Î®ÏƒÎ· Ï„Î·Ï‚ loadFromLocalStorage ÏŒÏ„Î±Î½ Ï†Î¿ÏÏ„ÏÎ½ÎµÎ¹ Î· ÏƒÎµÎ»Î¯Î´Î±
window.addEventListener('load', function() {
    setTimeout(() => {
        loadFromLocalStorage();
        checkMobileView();
    }, 100);
});

// Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÏŒÏ„Î±Î½ Î±Î»Î»Î¬Î¶ÎµÎ¹ Ï„Î¿ budget
document.getElementById("travel-budget").addEventListener("input", function() {
    selectedBudget = this.value ? parseInt(this.value) : 0;
    saveToLocalStorage();
});

// Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÏŒÏ„Î±Î½ Î±Î»Î»Î¬Î¶Î¿Ï…Î½ Ï„Î± Î¿Î½ÏŒÎ¼Î±Ï„Î±/Î·Î»Î¹ÎºÎ¯ÎµÏ‚
document.addEventListener('input', function(e) {
    if (e.target.classList.contains('member-name') || e.target.classList.contains('member-age')) {
        setTimeout(saveToLocalStorage, 100);
    }
});

function updateSelectedActivities(activityList) {
    console.log("ğŸ” Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Ï‰Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½ Î³Î¹Î±:", selectedDestinationName);
    
    // Î•Î¹Î´Î¹ÎºÎ® Î»Î¿Î³Î¹ÎºÎ® Î³Î¹Î± JSON Ï€ÏŒÎ»ÎµÎ¹Ï‚
    if ((selectedDestinationName.includes("ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¹Î½Î¿ÏÏ€Î¿Î»Î·") || 
         selectedDestinationName.includes("Î Î±ÏÎ¯ÏƒÎ¹") || 
         selectedDestinationName.includes("Î ÏÎ¬Î³Î±")) &&
        window.loadedExtraCityActivities) {
        
        console.log("ğŸ”„ Î£Ï…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î¼Îµ window.loadedExtraCityActivities");
        activityList = window.loadedExtraCityActivities;
    }
   
    activityList.forEach((act, index) => {
        const cardElement = document.getElementById(`activity-${index}`);
        if (cardElement) {
            const isSelected = cardElement.classList.contains('selected');
            act.selected = isSelected;
            console.log(`   ${act.name}: ${isSelected ? 'âœ… Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½Î·' : 'âŒ ÎœÎ· ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î·'}`);
        } else {
            console.log(`   âš ï¸ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ card Î³Î¹Î±: ${act.name} (index: ${index})`);
        }
    });
   
    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚
    const selectedCount = activityList.filter(act => act.selected).length;
    console.log(`ğŸ“Š Î£ÏÎ½Î¿Î»Î¿ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Ï‰Î½: ${selectedCount}`);
    
    // ğŸ”½ ğŸ”½ ğŸ”½ Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î•Î Î™Î£Î¤Î¡ÎŸÎ¦Î— Î¤Î—Î£ Î›Î™Î£Î¤Î‘Î£ ğŸ”½ ğŸ”½ ğŸ”½
    return activityList;
}

function categorizeFamilyMembers() {
    console.log("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¹Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¿Î¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚...");
    console.log("ÎœÎ­Î»Î· Î¿Î¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚:", familyMembers);
   
    const categories = {
        "0-2": 0,
        "3-5": 0,
        "6-14": 0,
        "15-19": 0,
        "18+": 0
    };
   
    familyMembers.forEach(member => {
        console.log(`   ${member.name} (${member.age} ÎµÏ„ÏÎ½):`);
       
        if (member.age <= 2) {
            categories["0-2"]++;
            console.log(`     â†’ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±: 0-2`);
        } else if (member.age <= 5) {
            categories["3-5"]++;
            console.log(`     â†’ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±: 3-5`);
        } else if (member.age <= 14) {
            categories["6-14"]++;
            console.log(`     â†’ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±: 6-14`);
        } else if (member.age <= 19) {
            categories["15-19"]++;
            console.log(`     â†’ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±: 15-19`);
        } else {
            categories["18+"]++;
            console.log(`     â†’ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±: 18+`);
        }
    });
   
    console.log("ğŸ“Š Î¤ÎµÎ»Î¹ÎºÎ­Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚:", categories);
    return categories;
}
function displayComboResults(results, regularCost) {
    // ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï€Î±Î»Î¹Î¿Ï modal Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
    closeComboModal();
    
    const modal = document.createElement('div');
    modal.id = 'combo-modal-main';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 10000;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: 'Comic Neue', Arial, sans-serif;
    `;
   
    const modalContent = document.createElement('div');
    modalContent.style.cssText = `
        background: white;
        padding: 30px;
        border-radius: 20px;
        max-width: 900px;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    `;
    
    // Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ Î£Î©Î£Î¤Î©Î ÎÎŸÎ¥ÎœÎ•Î¡Î©Î
    let bestSavingAmount = 0;
    let finalTotalCost = regularCost;
    let bestCombo = results.bestCombo;
    
    if (bestCombo && results.bestSaving > 0) {
        // Î£Î©Î£Î¤ÎŸÎ£ Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£: ÎµÎ¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ· = regularPrice - comboPrice
        bestSavingAmount = bestCombo.regularPrice - bestCombo.comboPrice;
        finalTotalCost = regularCost - bestSavingAmount;
    }
    
    let contentHTML = `
        <div style="text-align: center;">
            <h2 style="color: #9c27b0; margin-top: 0;">ğŸ’° ÎˆÎ¾Ï…Ï€Î½Î¿Ï‚ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Combos</h2>
            
            <div style="background: #f3e5f5; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #7b1fa2;">ğŸ“Š Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ Î§Î©Î¡Î™Î£ Combos: <strong>${regularCost.toFixed(2)} â‚¬</strong></h3>
                <p style="color: #666;">ğŸ™ï¸ Î ÏŒÎ»Î·: ${selectedDestinationName} | ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÎœÎ­Î»Î·: ${familyMembers.length}</p>
            </div>
    `;
    
    if (results.allCombos.length > 0) {
        if (results.bestSaving > 0 && bestCombo) {
            contentHTML += `
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; border: 3px solid #4caf50; margin-bottom: 20px;">
                    <h3 style="color: #2e7d32;">ğŸ† ÎšÎ‘Î›Î¥Î¤Î•Î¡Î— Î•Î Î™Î›ÎŸÎ“Î—</h3>
                    <h4>${bestCombo.name}</h4>
                    <p>${bestCombo.description}</p>
                    
                    <div style="background: #fff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="color: #1565c0; margin-top: 0;">ğŸ§® Î£Î©Î£Î¤ÎŸÎ£ Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£:</h4>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">1. Î£Î¥ÎÎŸÎ›ÎŸ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right; font-weight: bold;">${regularCost.toFixed(2)} â‚¬</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">2. ÎšÏŒÏƒÏ„Î¿Ï‚ ${bestCombo.activities.length} Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½ Î§Î©Î¡Î™Î£ combo</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right; color: #f44336;">${bestCombo.regularPrice.toFixed(2)} â‚¬</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">3. ÎšÏŒÏƒÏ„Î¿Ï‚ ${bestCombo.activities.length} Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½ ÎœÎ• combo</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right; color: #4caf50; font-weight: bold;">${bestCombo.comboPrice.toFixed(2)} â‚¬</td>
                            </tr>
                            <tr style="background: #f9f9f9;">
                                <td style="padding: 10px;"><strong>Î•ÎÎŸÎ™ÎšÎŸÎÎŸÎœÎ—Î£Î— (2 - 3)</strong></td>
                                <td style="padding: 10px; text-align: right; color: #4caf50; font-weight: bold;">${bestSavingAmount.toFixed(2)} â‚¬</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; font-size: 1.1em;"><strong>ÎÎ•ÎŸ Î£Î¥ÎÎŸÎ›Î™ÎšÎŸ ÎšÎŸÎ£Î¤ÎŸÎ£ (1 - Î•ÎÎŸÎ™ÎšÎŸÎÎŸÎœÎ—Î£Î—)</strong></td>
                                <td style="padding: 10px; text-align: right; font-size: 1.1em; color: #3f51b5; font-weight: bold;">
                                    ${finalTotalCost.toFixed(2)} â‚¬
                                </td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="display: flex; justify-content: space-around; margin: 20px 0; align-items: center;">
                        <div style="text-align: center;">
                            <div style="font-size: 24px; color: #f44336;">${regularCost.toFixed(2)}â‚¬</div>
                            <small>Î§Ï‰ÏÎ¯Ï‚ combo</small>
                        </div>
                        <div style="font-size: 30px; color: #666;">â¡ï¸</div>
                        <div style="text-align: center;">
                            <div style="font-size: 28px; color: #4caf50; font-weight: bold;">${finalTotalCost.toFixed(2)}â‚¬</div>
                            <small>ÎœÎµ combo</small>
                        </div>
                    </div>
                    
                    <div style="background: #4caf50; color: white; padding: 12px; border-radius: 8px; font-size: 22px; font-weight: bold; margin-top: 10px;">
                        ğŸ’° Î Î¡Î‘Î“ÎœÎ‘Î¤Î™ÎšÎ— Î•ÎÎŸÎ™ÎšÎŸÎÎŸÎœÎ—Î£Î—: ${bestSavingAmount.toFixed(2)} â‚¬
                    </div>
                    
                    <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 6px; font-size: 0.9em;">
                        <strong>ğŸ“‹ ÎŸÎ¹ ${bestCombo.activities.length} Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Ï€Î¿Ï… ÎºÎ±Î»ÏÏ€Ï„Î¿Î½Ï„Î±Î¹:</strong><br>
                        ${bestCombo.activities.map((act, i) => `${i+1}. ${act}`).join('<br>')}
                    </div>
                    
                    ${bestCombo.note ? `
                    <div style="margin-top: 10px; padding: 8px; background: #fff8e1; border-radius: 6px; font-size: 0.9em; color: #666;">
                        ğŸ“ <strong>Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:</strong> ${bestCombo.note}
                    </div>` : ''}
                </div>
            `;
        }
        
        contentHTML += `<h3 style="color: #3f51b5;">ğŸ¯ ÎŒÎ»Î± Ï„Î± Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Combos:</h3>`;
        
        results.allCombos.forEach((combo, index) => {
            // Î£Î©Î£Î¤ÎŸÎ£ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î³Î¹Î± ÎºÎ¬Î¸Îµ combo
            const comboRealSaving = combo.regularPrice - combo.comboPrice;
            const totalWithThisCombo = regularCost - comboRealSaving;
            const borderColor = comboRealSaving > 0 ? '#4caf50' : '#ff9800';
            const bgColor = comboRealSaving > 0 ? '#f1f8e9' : '#fff3e0';
            
            contentHTML += `
                <div style="background: ${bgColor}; padding: 15px; border-radius: 10px; border-left: 5px solid ${borderColor}; margin-bottom: 15px;">
                    <h4 style="margin-top: 0; color: #3f51b5;">${combo.name}</h4>
                    <p style="margin: 5px 0;">${combo.description}</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0;">
                        <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                            <div style="font-size: 0.9em; color: #666;">ÎšÎ±Î½Î¿Î½Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚:</div>
                            <div style="font-size: 18px; color: #f44336; text-decoration: line-through;">${combo.regularPrice.toFixed(2)}â‚¬</div>
                            <small style="font-size: 0.8em;">Î³Î¹Î± ${combo.activities.length} Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚</small>
                        </div>
                        <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                            <div style="font-size: 0.9em; color: #666;">Combo Ï„Î¹Î¼Î®:</div>
                            <div style="font-size: 18px; color: #4caf50; font-weight: bold;">${combo.comboPrice.toFixed(2)}â‚¬</div>
                            <small style="font-size: 0.8em;">Î³Î¹Î± ${combo.activities.length} Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚</small>
                        </div>
                    </div>
                    
                    <div style="background: ${comboRealSaving > 0 ? '#e8f5e9' : '#ffebee'}; padding: 10px; border-radius: 6px; margin: 8px 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <span><strong>Î•Î¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ· ÏƒÎµ Î±Ï…Ï„Î­Ï‚:</strong></span>
                            <span style="color: ${comboRealSaving > 0 ? '#4caf50' : '#f44336'}; font-weight: bold;">
                                ${comboRealSaving > 0 ? 'ğŸ’° ' : 'âš ï¸ '}${comboRealSaving.toFixed(2)}â‚¬
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9em; margin-top: 5px;">
                            <span>ÎÎ­Î¿ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚:</span>
                            <span><strong>${totalWithThisCombo.toFixed(2)}â‚¬</strong></span>
                        </div>
                    </div>
                    
                    ${combo.note ? `
                    <div style="font-size: 0.85em; color: #666; background: rgba(0,0,0,0.05); padding: 5px; border-radius: 4px; margin-top: 5px;">
                        ğŸ“ ${combo.note}
                    </div>` : ''}
                </div>
            `;
        });
    } else {
        contentHTML += `
            <div style="background: #fff3cd; padding: 20px; border-radius: 10px; border: 2px solid #ffc107;">
                <h3 style="color: #856404;">â„¹ï¸ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± combos</h3>
                <p>ÎŸÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏƒÎ±Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î´ÎµÎ½ Î­Ï‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ¬ combos.</p>
            </div>
        `;
    }
    
    contentHTML += `
        <div style="margin-top: 20px; padding-top: 20px; border-top: 2px dashed #ccc;">
            <h4 style="color: #9c27b0;">ğŸ“Š Î¤Î•Î›Î™ÎšÎ— Î£Î¥ÎÎŸÎ¨Î—:</h4>
            <div style="background: #e3f2fd; padding: 15px; border-radius: 10px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                    <tr>
                        <td style="padding: 8px;">Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚ Ï‡Ï‰ÏÎ¯Ï‚ combo:</td>
                        <td style="padding: 8px; text-align: right; font-weight: bold;">${regularCost.toFixed(2)} â‚¬</td>
                    </tr>
                    ${bestCombo ? `
                    <tr>
                        <td style="padding: 8px;">ÎšÎ±Î»ÏÏ„ÎµÏÎ¿ combo (${bestCombo.name}):</td>
                        <td style="padding: 8px; text-align: right; color: #4caf50; font-weight: bold;">-${bestSavingAmount.toFixed(2)} â‚¬</td>
                    </tr>
                    <tr style="border-top: 2px solid #ccc;">
                        <td style="padding: 8px; font-size: 1.1em;"><strong>Î¤Î•Î›Î™ÎšÎŸ Î£Î¥ÎÎŸÎ›ÎŸ:</strong></td>
                        <td style="padding: 8px; text-align: right; font-size: 1.1em; color: #3f51b5; font-weight: bold;">
                            ${finalTotalCost.toFixed(2)} â‚¬
                        </td>
                    </tr>` : `
                    <tr>
                        <td style="padding: 8px;">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ ÎµÎ¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ·</td>
                        <td style="padding: 8px; text-align: right; color: #666;">-</td>
                    </tr>`}
                    <tr>
                        <td style="padding: 8px;">Î’ÏÎ­Î¸Î·ÎºÎ±Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± combos:</td>
                        <td style="padding: 8px; text-align: right;">${results.allCombos.length}</td>
                    </tr>
                </table>
            </div>
        </div>
       
        <div style="margin-top: 25px; display: flex; justify-content: center; gap: 15px;">
            <button onclick="closeComboModal()"
                style="padding: 12px 25px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿
            </button>
            ${bestCombo && bestSavingAmount > 0 ? `
            <button onclick="applyComboToTotal('${bestCombo.name}', ${bestSavingAmount})"
                    style="padding: 12px 25px; background: #9c27b0; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;">
                âœ… Î•Ï†Î±ÏÎ¼Î¿Î³Î® ÏƒÏ„Î¿ Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚
            </button>` : ''}
        </div>
    `;
    
    modalContent.innerHTML = contentHTML;
    modal.appendChild(modalContent);
    
    const closeBtn = document.createElement('button');
    closeBtn.innerHTML = 'Ã—';
    closeBtn.style.cssText = `
        position: absolute;
        top: 20px;
        right: 20px;
        background: #f44336;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 24px;
        cursor: pointer;
        z-index: 10001;
    `;
    closeBtn.onclick = () => {
        modal.remove();
        closeBtn.remove();
    };
    
    document.body.appendChild(modal);
    document.body.appendChild(closeBtn);
}

function applyBestCombo() {
    alert("â„¹ï¸ Î— Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ Ï„Î¿Ï… combo Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ Ï…Ï€ÏŒ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·.\n\nğŸ’¡ Î£Î±Ï‚ ÏƒÏ…Î½Î¹ÏƒÏ„Î¿ÏÎ¼Îµ Î½Î± Î±Î³Î¿ÏÎ¬ÏƒÎµÏ„Îµ Ï„Î¿ combo online Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Î»ÏÏ„ÎµÏÎ· Ï„Î¹Î¼Î®!");
   
    // ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï„Î¿Ï… modal
    const modal = document.querySelector('div[style*="position: fixed"]');
    const closeBtn = document.querySelector('button[style*="position: absolute"]');
    if (modal) modal.remove();
    if (closeBtn) closeBtn.remove();
}
// ==================== Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ•Î£ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ COMBO ====================

function closeComboModal() {
    console.log("ğŸ”’ ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ modal combo...");
   
    // Î•Î½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÏŒÏ‚ Ï„ÏÏŒÏ€Î¿Ï‚ 1 - Î‘Ï€ÏŒ Ï„Î¿ ID (Ï€Î¹Î¿ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Î¿)
    const comboModal = document.getElementById('combo-modal-main');
    if (comboModal) {
        console.log("âœ… Î’ÏÎ­Î¸Î·ÎºÎµ modal Î±Ï€ÏŒ ID - Î±Ï†Î±Î¯ÏÎµÏƒÎ·...");
        comboModal.remove();
    }
   
    // Î•Î½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÏŒÏ‚ Ï„ÏÏŒÏ€Î¿Ï‚ 2 - Î‘Ï€ÏŒ Ï„Î¿ style
    const modal = document.querySelector('div[style*="position: fixed"][style*="top: 0"][style*="left: 0"]');
    if (modal && modal.style.background.includes('rgba(0,0,0,0.8)')) {
        console.log("âœ… Î’ÏÎ­Î¸Î·ÎºÎµ modal Î±Ï€ÏŒ style - Î±Ï†Î±Î¯ÏÎµÏƒÎ·...");
        modal.remove();
    }
   
    // Î•Î½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÏŒÏ‚ Ï„ÏÏŒÏ€Î¿Ï‚ 3 - Î’ÏÎµÏ‚ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ ÎºÎ»ÎµÎ¹ÏƒÎ¯Î¼Î±Ï„Î¿Ï‚
    const closeBtn = document.querySelector('button[onclick*="closeComboModal"]');
    if (closeBtn) {
        console.log("âœ… Î’ÏÎ­Î¸Î·ÎºÎµ ÎºÎ¿Ï…Î¼Ï€Î¯ ÎºÎ»ÎµÎ¹ÏƒÎ¯Î¼Î±Ï„Î¿Ï‚ - Î±Ï†Î±Î¯ÏÎµÏƒÎ·...");
        closeBtn.remove();
    }
   
    // Î•Ï€Î¹Ï€Î»Î­Î¿Î½: ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ modals
    document.querySelectorAll('div').forEach(div => {
        const style = div.style.cssText || '';
        if (style.includes('position: fixed') && style.includes('top: 0') && style.includes('left: 0')) {
            div.remove();
        }
    });
   
    console.log("âœ… Modal ÎºÎ»ÎµÎ¯ÏƒÏ„Î·ÎºÎµ!");
}

function applyBestCombo() {
    alert("â„¹ï¸ Î— Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ Ï„Î¿Ï… combo Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ Ï…Ï€ÏŒ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·.\n\nğŸ’¡ Î£Î±Ï‚ ÏƒÏ…Î½Î¹ÏƒÏ„Î¿ÏÎ¼Îµ Î½Î± Î±Î³Î¿ÏÎ¬ÏƒÎµÏ„Îµ Ï„Î¿ combo online Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Î»ÏÏ„ÎµÏÎ· Ï„Î¹Î¼Î®!");
   
    // ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï„Î¿Ï… modal
    closeComboModal();
}
function applyBestCombo() {
    alert("â„¹ï¸ Î— Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ Ï„Î¿Ï… combo Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ Ï…Ï€ÏŒ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·.\n\nğŸ’¡ Î£Î±Ï‚ ÏƒÏ…Î½Î¹ÏƒÏ„Î¿ÏÎ¼Îµ Î½Î± Î±Î³Î¿ÏÎ¬ÏƒÎµÏ„Îµ Ï„Î¿ combo online Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Î»ÏÏ„ÎµÏÎ· Ï„Î¹Î¼Î®!");
   
    // Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î·Î½ Î¯Î´Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· ÎºÎ»ÎµÎ¹ÏƒÎ¯Î¼Î±Ï„Î¿Ï‚
    closeComboModal();
}
    // ==================== ğŸ‘‡ Î Î¡ÎŸÎ£Î˜Î•Î£Î• Î‘Î¥Î¤ÎŸÎ Î¤ÎŸÎ ÎšÎ©Î”Î™ÎšÎ‘ Î‘ÎšÎ¡Î™Î’Î©Î£ Î•Î”Î© ğŸ‘‡ ====================

// Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î— CUSTOM POINTS
let customPoints = JSON.parse(localStorage.getItem('travel_custom_points')) || [];

// 1. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î•ÎÎ‘Î¡ÎÎ— Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—Î£ Î£Î—ÎœÎ•Î™ÎŸÎ¥
function startAddingCustomPoint() {
    if (typeof L === 'undefined' || !window.currentMap) {
        alert('âš ï¸ Î ÏÎ­Ï€ÎµÎ¹ Ï€ÏÏÏ„Î± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÎµÏ„Îµ Ï„Î¿Î½ Ï‡Î¬ÏÏ„Î·!');
        initializeSmartMap();
        setTimeout(() => {
            alert('âœ… ÎŸ Ï‡Î¬ÏÏ„Î·Ï‚ Ï†Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ! ÎšÎ¬Î½Ï„Îµ Î¾Î±Î½Î¬ ÎºÎ»Î¹Îº ÏƒÏ„Î¿ "ğŸŸ£ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î£Î·Î¼ÎµÎ¯Î¿Ï…"');
        }, 1000);
        return;
    }
    
    const map = window.currentMap;
    
    // Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ·Ï‚
    alert('ğŸ—ºï¸ ÎšÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î· Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ ÏƒÎ·Î¼ÎµÎ¯Î¿!');
    
    // Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® Î±Î»Î»Î±Î³Î® Ï„Î¿Ï… cursor
    map.getContainer().style.cursor = 'crosshair';
    
    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· event listener Î³Î¹Î± ÎºÎ»Î¹Îº
    const clickHandler = function(e) {
        // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Ï„Î¿Ï… event listener
        map.off('click', clickHandler);
        map.getContainer().style.cursor = '';
        
        // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· form Î³Î¹Î± ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½
        showCustomPointForm(e.latlng.lat, e.latlng.lng);
    };
    
    map.on('click', clickHandler);
    
    // ÎšÎ¿Ï…Î¼Ï€Î¯ Î±ÎºÏÏÏ‰ÏƒÎ·Ï‚
    const cancelBtn = document.createElement('button');
    cancelBtn.textContent = 'âœ–ï¸ Î‘ÎºÏÏÏ‰ÏƒÎ·';
    cancelBtn.style.cssText = `
        position: absolute;
        top: 80px;
        right: 15px;
        z-index: 1000;
        padding: 10px 15px;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-family: 'Comic Neue', Arial, Helvetica, sans-serif;
        font-weight: bold;
    `;
    cancelBtn.onclick = function() {
        map.off('click', clickHandler);
        map.getContainer().style.cursor = '';
        cancelBtn.remove();
    };
    
    document.getElementById('map-container').appendChild(cancelBtn);
}

// 2. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î•ÎœÎ¦Î‘ÎÎ™Î£Î— FORM Î“Î™Î‘ Î£Î—ÎœÎ•Î™ÎŸ
function showCustomPointForm(lat, lng) {
    const formHTML = `
        <div id="custom-point-modal" style="
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000;
            max-width: 400px;
            width: 90%;
        ">
            <h3 style="margin-top: 0; color: #9c27b0;">ğŸŸ£ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎÎ­Î¿Ï… Î£Î·Î¼ÎµÎ¯Î¿Ï…</h3>
            
            <label style="display: block; margin: 10px 0 5px 0;">ğŸ·ï¸ ÎŒÎ½Î¿Î¼Î±:</label>
            <input type="text" id="custom-point-name" placeholder="Ï€.Ï‡. Î¤Î¿ Î‘Î³Î±Ï€Î·Î¼Î­Î½Î¿ ÎœÎ¿Ï… Î•ÏƒÏ„Î¹Î±Ï„ÏŒÏÎ¹Î¿" 
                   style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 10px;">
            
            <label style="display: block; margin: 10px 0 5px 0;">ğŸ“ Î¤ÏÏ€Î¿Ï‚:</label>
            <select id="custom-point-type" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 15px;">
                <option value="attraction">ğŸ›ï¸ Î‘Î¾Î¹Î¿Î¸Î­Î±Ï„Î¿</option>
                <option value="restaurant">ğŸ½ï¸ Î•ÏƒÏ„Î¹Î±Ï„ÏŒÏÎ¹Î¿</option>
                <option value="cafe">â˜• ÎšÎ±Ï†Î­</option>
                <option value="shop">ğŸ›ï¸ ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î±</option>
                <option value="personal">ğŸ  Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ Î£Î·Î¼ÎµÎ¯Î¿</option>
                <option value="other">ğŸ“ Î†Î»Î»Î¿</option>
            </select>
            
            <label style="display: block; margin: 10px 0 5px 0;">ğŸ“ Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ· (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ):</label>
            <textarea id="custom-point-note" placeholder="Ï€.Ï‡. ÎšÎ»ÎµÎ¹ÏƒÏ„Î¬ Î¤ÏÎ¯Ï„ÎµÏ‚, ÎšÎ±Î»Î­Ï‚ Ï„Î¹Î¼Î­Ï‚..." 
                     style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 15px; height: 80px;"></textarea>
            
            <div style="text-align: center;">
                <button onclick="saveCustomPoint(${lat}, ${lng})" 
                        style="padding: 12px 25px; background: #9c27b0; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 5px; font-size: 16px;">
                    ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
                </button>
                <button onclick="closeCustomPointForm()" 
                        style="padding: 12px 25px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 5px; font-size: 16px;">
                    âŒ Î‘ÎºÏÏÏ‰ÏƒÎ·
                </button>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', formHTML);
}

// 3. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î— Î£Î—ÎœÎ•Î™ÎŸÎ¥
function saveCustomPoint(lat, lng) {
    const name = document.getElementById('custom-point-name').value;
    const type = document.getElementById('custom-point-type').value;
    const note = document.getElementById('custom-point-note').value;
    
    if (!name.trim()) {
        alert('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ½Î¿Î¼Î±!');
        return;
    }
    
    const newPoint = {
        id: Date.now(),
        name: name.trim(),
        type: type,
        lat: lat,
        lng: lng,
        note: note.trim(),
        date: new Date().toLocaleDateString('el-GR')
    };
    
    customPoints.push(newPoint);
    localStorage.setItem('travel_custom_points', JSON.stringify(customPoints));
    
    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·
    addCustomPointToMap(newPoint);
    
    // ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ form
    closeCustomPointForm();
    
    alert(`âœ… Î¤Î¿ ÏƒÎ·Î¼ÎµÎ¯Î¿ "${name}" Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·!`);
}

// 4. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: ÎšÎ›Î•Î™Î£Î™ÎœÎŸ FORM
function closeCustomPointForm() {
    const modal = document.getElementById('custom-point-modal');
    if (modal) modal.remove();
}

// 5. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î Î¡ÎŸÎ£Î˜Î—ÎšÎ— Î£Î¤ÎŸÎ Î§Î‘Î¡Î¤Î—
function addCustomPointToMap(point) {
    if (typeof L === 'undefined' || !window.currentMap) return;
    
    const map = window.currentMap;
    
    // Î§ÏÏÎ¼Î± Î±Î½Î¬ Ï„ÏÏ€Î¿
    const typeColors = {
        'attraction': 'violet',
        'restaurant': 'red',
        'cafe': 'orange',
        'shop': 'blue',
        'personal': 'green',
        'other': 'gray'
    };
    
    const color = typeColors[point.type] || 'gray';
    
    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· marker
    const customIcon = L.icon({
        iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
        iconSize: [25, 41],
        iconAnchor: [12, 41]
    });
    
    const marker = L.marker([point.lat, point.lng], { icon: customIcon }).addTo(map);
    
    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· popup
    const typeNames = {
        'attraction': 'ğŸ›ï¸ Î‘Î¾Î¹Î¿Î¸Î­Î±Ï„Î¿',
        'restaurant': 'ğŸ½ï¸ Î•ÏƒÏ„Î¹Î±Ï„ÏŒÏÎ¹Î¿',
        'cafe': 'â˜• ÎšÎ±Ï†Î­',
        'shop': 'ğŸ›ï¸ ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î±',
        'personal': 'ğŸ  Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ Î£Î·Î¼ÎµÎ¯Î¿',
        'other': 'ğŸ“ Î†Î»Î»Î¿'
    };
    
    marker.bindPopup(`
        <div style="max-width: 250px;">
            <h4 style="margin: 0 0 8px 0; color: #9c27b0;">${point.name}</h4>
            <p style="margin: 0 0 5px 0;"><strong>${typeNames[point.type] || 'ğŸ“ Î£Î·Î¼ÎµÎ¯Î¿'}</strong></p>
            ${point.note ? `<p style="margin: 5px 0; font-size: 0.9em;">ğŸ“ ${point.note}</p>` : ''}
            <p style="margin: 5px 0; font-size: 0.85em; color: #666;">Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ: ${point.date}</p>
            <button onclick="deleteCustomPoint(${point.id}, this)" 
                    style="padding: 5px 10px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8em;">
                ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î®
            </button>
        </div>
    `);
    
    // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· reference
    if (!window.customMarkers) window.customMarkers = [];
    window.customMarkers.push({ id: point.id, marker: marker });
}

// 6. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î”Î™Î‘Î“Î¡Î‘Î¦Î— Î£Î—ÎœÎ•Î™ÎŸÎ¥
function deleteCustomPoint(id, button) {
    if (!confirm('âš ï¸ Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÎ·Î¼ÎµÎ¯Î¿;')) return;
    
    // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î±Ï€ÏŒ Ï„Î¿Î½ Ï‡Î¬ÏÏ„Î·
    if (window.customMarkers) {
        const markerIndex = window.customMarkers.findIndex(m => m.id === id);
        if (markerIndex !== -1) {
            window.currentMap.removeLayer(window.customMarkers[markerIndex].marker);
            window.customMarkers.splice(markerIndex, 1);
        }
    }
    
    // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î±Ï€ÏŒ Ï„Î· Î»Î¯ÏƒÏ„Î±
    customPoints = customPoints.filter(point => point.id !== id);
    localStorage.setItem('travel_custom_points', JSON.stringify(customPoints));
    
    // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· UI
    viewCustomPoints();
    
    alert('âœ… Î¤Î¿ ÏƒÎ·Î¼ÎµÎ¯Î¿ Î´Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ!');
}

// 7. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î Î¡ÎŸÎ’ÎŸÎ›Î— ÎŸÎ›Î©Î Î¤Î©Î Î£Î—ÎœÎ•Î™Î©Î
function viewCustomPoints() {
    const container = document.getElementById('custom-points-container');
    const listDiv = document.getElementById('custom-points-list');
    
    if (customPoints.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <p>ğŸ“­ Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ Î±ÎºÏŒÎ¼Î± Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¬ ÏƒÎ·Î¼ÎµÎ¯Î±.</p>
                <p>ÎšÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÏƒÏ„Î¿ "ğŸŸ£ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î£Î·Î¼ÎµÎ¯Î¿Ï… ÏƒÏ„Î¿Î½ Î§Î¬ÏÏ„Î·" Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÏ„Îµ!</p>
            </div>
        `;
    } else {
        let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">';
        
        customPoints.forEach(point => {
            const typeNames = {
                'attraction': 'ğŸ›ï¸ Î‘Î¾Î¹Î¿Î¸Î­Î±Ï„Î¿',
                'restaurant': 'ğŸ½ï¸ Î•ÏƒÏ„Î¹Î±Ï„ÏŒÏÎ¹Î¿',
                'cafe': 'â˜• ÎšÎ±Ï†Î­',
                'shop': 'ğŸ›ï¸ ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î±',
                'personal': 'ğŸ  Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ Î£Î·Î¼ÎµÎ¯Î¿',
                'other': 'ğŸ“ Î†Î»Î»Î¿'
            };
            
            html += `
                <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #9c27b0;">
                    <h4 style="margin: 0 0 8px 0;">${point.name}</h4>
                    <p style="margin: 0 0 5px 0; color: #666;">${typeNames[point.type] || 'ğŸ“ Î£Î·Î¼ÎµÎ¯Î¿'}</p>
                    ${point.note ? `<p style="margin: 0 0 5px 0; font-size: 0.9em;">ğŸ“ ${point.note}</p>` : ''}
                    <p style="margin: 0 0 8px 0; font-size: 0.85em; color: #999;">ğŸŒ Î£Ï…Î½Ï„ÎµÏ„Î±Î³Î¼Î­Î½ÎµÏ‚: ${point.lat.toFixed(4)}, ${point.lng.toFixed(4)}</p>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="focusOnPoint(${point.lat}, ${point.lng})" 
                                style="padding: 6px 12px; background: #3eb489; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em;">
                            ğŸ—ºï¸ Î”ÎµÎ¯Î¾Îµ ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·
                        </button>
                        <button onclick="deleteCustomPoint(${point.id})" 
                                style="padding: 6px 12px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em;">
                            ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î®
                        </button>
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
        container.innerHTML = html;
    }
    
    listDiv.style.display = 'block';
}

// 8. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î•Î£Î¤Î™Î‘Î£Î— Î£Î• Î£Î—ÎœÎ•Î™ÎŸ
function focusOnPoint(lat, lng) {
    if (typeof L === 'undefined' || !window.currentMap) {
        alert('âš ï¸ Î ÏÎ­Ï€ÎµÎ¹ Ï€ÏÏÏ„Î± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÎµÏ„Îµ Ï„Î¿Î½ Ï‡Î¬ÏÏ„Î·!');
        return;
    }
    
    window.currentMap.setView([lat, lng], 16);
    
    // Î‘Î½Î¿Î¯Î³Î¿Ï…Î¼Îµ Ï„Î¿ popup Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ marker
    if (window.customMarkers) {
        const pointMarker = window.customMarkers.find(m => 
            Math.abs(m.marker.getLatLng().lat - lat) < 0.001 && 
            Math.abs(m.marker.getLatLng().lng - lng) < 0.001
        );
        
        if (pointMarker) {
            pointMarker.marker.openPopup();
        }
    }
}

// 9. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î¦ÎŸÎ¡Î¤Î©Î£Î— CUSTOM POINTS Î£Î¤ÎŸÎ Î§Î‘Î¡Î¤Î—
function loadCustomPointsOnMap() {
    if (typeof L === 'undefined' || !window.currentMap) return;
    
    // ÎšÎ±Î¸Î±ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï€Î±Î»Î¹Î¿ÏÏ‚ markers
    if (window.customMarkers) {
        window.customMarkers.forEach(m => window.currentMap.removeLayer(m.marker));
        window.customMarkers = [];
    }
    
    // Î ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Ï…Î¼Îµ ÏŒÎ»Î± Ï„Î± custom points
    customPoints.forEach(point => {
        addCustomPointToMap(point);
    });
}
    // ==================== Î•ÎÎ¥Î ÎÎ— Î Î¡ÎŸÎ£Î˜Î—ÎšÎ— Î£Î—ÎœÎ•Î™Î©Î ====================

// 10. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î•ÎÎ¥Î ÎÎ— Î Î¡ÎŸÎ£Î˜Î—ÎšÎ— (3 Î¤Î¡ÎŸÎ ÎŸÎ™)
function addCustomPointSmart() {
    if (typeof L === 'undefined' || !window.currentMap) {
        alert('âš ï¸ Î ÏÎ­Ï€ÎµÎ¹ Ï€ÏÏÏ„Î± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÎµÏ„Îµ Ï„Î¿Î½ Ï‡Î¬ÏÏ„Î·!');
        initializeSmartMap();
        setTimeout(() => {
            alert('âœ… ÎŸ Ï‡Î¬ÏÏ„Î·Ï‚ Ï†Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
        }, 1500);
        return;
    }
    
    // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· menu ÎµÏ€Î¹Î»Î¿Î³ÏÎ½
    const choice = prompt(`ğŸ† Î Î©Î£ Î˜Î•Î›Î•Î¤Î• ÎÎ‘ Î Î¡ÎŸÎ£Î˜Î•Î£Î•Î¤Î• Î¤ÎŸ Î£Î—ÎœÎ•Î™ÎŸ;

1ï¸âƒ£ ğŸ” Î‘ÎÎ‘Î–Î—Î¤Î—Î£Î— ÎŸÎÎŸÎœÎ‘Î¤ÎŸÎ£ (Î³Î¹Î± Î´Î¹Î¬ÏƒÎ·Î¼Î± Î¼Î­ÏÎ· ÏŒÏ€Ï‰Ï‚ "Î’Î±Ï„Î¹ÎºÎ±Î½ÏŒ", "Î ÏÏÎ³Î¿Ï‚ Ï„Î¿Ï… Î†Î¹Ï†ÎµÎ»")
2ï¸âƒ£ ğŸ—ºï¸ ÎšÎ›Î™Îš Î£Î¤ÎŸÎ Î§Î‘Î¡Î¤Î— (Î³Î¹Î± Ï€ÏÎ¿ÏƒÎµÎ³Î³Î¹ÏƒÏ„Î¹ÎºÎ® Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±)
3ï¸âƒ£ ğŸ“« Î Î›Î—ÎšÎ¤Î¡ÎŸÎ›ÎŸÎ“Î—Î£Î— Î”Î™Î•Î¥Î˜Î¥ÎÎ£Î—Î£ (Î³Î¹Î± Î±ÎºÏÎ¹Î²Î® Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·)

Î•Ï€Î¹Î»Î­Î¾Ï„Îµ 1, 2 Î® 3:`);
    
    if (choice === '1') {
        searchPointByName();
    } else if (choice === '2') {
        startAddingCustomPoint(); // Î— Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ± Î¼Î­Î¸Î¿Î´Î¿Ï‚
    } else if (choice === '3') {
        searchPointByAddress();
    } else {
        alert('âŒ Î‘ÎºÏ…ÏÏÎ¸Î·ÎºÎµ');
    }
}

// 11. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î‘ÎÎ‘Î–Î—Î¤Î—Î£Î— Î‘Î ÎŸ ÎŸÎÎŸÎœÎ‘ (Î“Î™Î‘ Î”Î™Î‘Î£Î—ÎœÎ‘ ÎœÎ•Î¡Î—)
function searchPointByName() {
    const query = prompt('ğŸ” Î“ÏÎ¬ÏˆÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±Ï‚:\n\nÎ Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±:\nâ€¢ Î’Î±Ï„Î¹ÎºÎ±Î½ÏŒ\nâ€¢ Î ÏÏÎ³Î¿Ï‚ Ï„Î¿Ï… Î†Î¹Ï†ÎµÎ»\nâ€¢ Disneyland Paris\nâ€¢ ÎšÎ¿Î»Ï‰Î½Î¬ÎºÎ¹ Î‘Î¸Î®Î½Î±\nâ€¢ Î£Ï„Î¬Î´Î¹Î¿ Î£Ï€ÏÏÎ¿Ï‚ Î›Î¿ÏÎ·Ï‚');
    
    if (!query || query.trim() === '') {
        alert('âŒ Î”ÎµÎ½ ÎµÎ¹ÏƒÎ¬Î³Î±Ï„Îµ ÏŒÎ½Î¿Î¼Î±');
        return;
    }
    
    // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î¼Î·Î½ÏÎ¼Î±Ï„Î¿Ï‚ Î±Î½Î±Î¼Î¿Î½Î®Ï‚
    alert('ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±Ï‚... Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ.');
    
    // Î§ÏÎ®ÏƒÎ· Nominatim API (OpenStreetMap - Î”Î©Î¡Î•Î‘Î)
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5`)
        .then(response => response.json())
        .then(data => {
            if (data && data.length > 0) {
                // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎµÏ€Î¹Î»Î¿Î³ÏÎ½ Î±Î½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Ï€Î¿Î»Î»Î¬
                if (data.length > 1) {
                    let optionsText = 'ğŸ“‹ Î’ÏÎ­Î¸Î·ÎºÎ±Î½ Ï€Î¿Î»Î»Î­Ï‚ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯ÎµÏ‚:\n\n';
                    data.slice(0, 5).forEach((item, index) => {
                        optionsText += `${index + 1}. ${item.display_name}\n`;
                    });
                    optionsText += '\nÎ•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±ÏÎ¹Î¸Î¼ÏŒ (1-5) Î® 0 Î³Î¹Î± Î±ÎºÏÏÏ‰ÏƒÎ·:';
                    
                    const choice = prompt(optionsText);
                    const choiceNum = parseInt(choice);
                    
                    if (choiceNum >= 1 && choiceNum <= data.length) {
                        const selected = data[choiceNum - 1];
                        showCustomPointForm(selected.lat, selected.lon, `${selected.display_name}`);
                    } else {
                        alert('Î‘ÎºÏ…ÏÏÎ¸Î·ÎºÎµ');
                    }
                } else {
                    // ÎœÏŒÎ½Î¿ Î­Î½Î± Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±
                    const firstResult = data[0];
                    showCustomPointForm(firstResult.lat, firstResult.lon, `${firstResult.display_name}`);
                }
            } else {
                alert('âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏŒÎ½Î¿Î¼Î±.\n\nğŸ’¡ Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ:\nâ€¢ Î Î¹Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ ÏŒÎ½Î¿Î¼Î±\nâ€¢ Î‰ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ "ÎšÎ»Î¹Îº ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·"');
                startAddingCustomPoint(); // Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Ï€Î±Î»Î¹Î¬ Î¼Î­Î¸Î¿Î´Î¿
            }
        })
        .catch(error => {
            console.error('Î£Ï†Î¬Î»Î¼Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚:', error);
            alert('âš ï¸ Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½ÏŒ ÏƒÏ†Î¬Î»Î¼Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚.\n\nğŸ’¡ Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ "ÎšÎ»Î¹Îº ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·" Î³Î¹Î± Ï„ÏÏÎ±.');
            startAddingCustomPoint();
        });
}

// 12. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î‘ÎÎ‘Î–Î—Î¤Î—Î£Î— Î‘Î ÎŸ Î”Î™Î•Î¥Î˜Î¥ÎÎ£Î—
function searchPointByAddress() {
    const address = prompt('ğŸ“« Î’Î¬Î»Ï„Îµ Ï€Î»Î®ÏÎ· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·:\n\nÎ Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±:\nâ€¢ ÎœÎ¿Ï„ÏƒÎ±ÏÏ„ÏƒÏ„ÏÎ¬ÏƒÎµ 12, Î’Î¹Î­Î½Î½Î·\nâ€¢ Î Î»Î±Ï„ÎµÎ¯Î± Î£Ï…Î½Ï„Î¬Î³Î¼Î±Ï„Î¿Ï‚ 2, Î‘Î¸Î®Î½Î±\nâ€¢ Champs-Ã‰lysÃ©es 50, Î Î±ÏÎ¯ÏƒÎ¹');
    
    if (!address || address.trim() === '') {
        alert('âŒ Î”ÎµÎ½ ÎµÎ¹ÏƒÎ¬Î³Î±Ï„Îµ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·');
        return;
    }
    
    alert('ğŸ“¡ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚... Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ.');
    
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&addressdetails=1`)
        .then(response => response.json())
        .then(data => {
            if (data && data.length > 0) {
                const result = data[0];
                showCustomPointForm(result.lat, result.lon, `${result.display_name}`);
            } else {
                alert('âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·.\n\nğŸ’¡ Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ:\nâ€¢ Î Î¹Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·\nâ€¢ Î‰ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ "ÎšÎ»Î¹Îº ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·"');
                startAddingCustomPoint();
            }
        })
        .catch(error => {
            console.error('Î£Ï†Î¬Î»Î¼Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚:', error);
            alert('âš ï¸ Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½ÏŒ ÏƒÏ†Î¬Î»Î¼Î±.\nğŸ’¡ Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ "ÎšÎ»Î¹Îº ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·".');
            startAddingCustomPoint();
        });
}

// 13. Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î—: Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î¦ÎŸÎ¡ÎœÎ‘ (ÎœÎ• Î Î¡ÎŸÎ¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎ•ÎÎŸ ÎŸÎÎŸÎœÎ‘)
function showCustomPointForm(lat, lng, suggestedName = '') {
    const formHTML = `
        <div id="custom-point-modal" style="
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000;
            max-width: 450px;
            width: 90%;
        ">
            <h3 style="margin-top: 0; color: #9c27b0;">ğŸ† Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎÎ­Î¿Ï… Î£Î·Î¼ÎµÎ¯Î¿Ï…</h3>
            
            <div style="background: #f0f0f0; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9em;">
                ğŸ“ Î£Ï…Î½Ï„ÎµÏ„Î±Î³Î¼Î­Î½ÎµÏ‚: ${parseFloat(lat).toFixed(6)}, ${parseFloat(lng).toFixed(6)}
            </div>
            
            <label style="display: block; margin: 10px 0 5px 0;">ğŸ·ï¸ ÎŒÎ½Î¿Î¼Î±:</label>
            <input type="text" id="custom-point-name" 
                   value="${suggestedName ? suggestedName.split(',')[0] : ''}"
                   placeholder="Ï€.Ï‡. Î¤Î¿ Î¾ÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î¿ Î¼Î±Ï‚" 
                   style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 10px;">
            
            <label style="display: block; margin: 10px 0 5px 0;">ğŸ“ Î¤ÏÏ€Î¿Ï‚:</label>
            <select id="custom-point-type" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 15px;">
                <option value="attraction">ğŸ›ï¸ Î‘Î¾Î¹Î¿Î¸Î­Î±Ï„Î¿</option>
                <option value="hotel" selected>ğŸ¨ ÎÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î¿</option>
                <option value="restaurant">ğŸ½ï¸ Î•ÏƒÏ„Î¹Î±Ï„ÏŒÏÎ¹Î¿</option>
                <option value="cafe">â˜• ÎšÎ±Ï†Î­</option>
                <option value="shop">ğŸ›ï¸ ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î±</option>
                <option value="transport">ğŸš‡ Î£Ï„Î±Î¸Î¼ÏŒÏ‚ ÎœÎµÏ„Î±Ï†Î¿ÏÏÎ½</option>
                <option value="personal">ğŸ  Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ Î£Î·Î¼ÎµÎ¯Î¿</option>
                <option value="other">ğŸ“ Î†Î»Î»Î¿</option>
            </select>
            
            <label style="display: block; margin: 10px 0 5px 0;">ğŸ“ Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ· (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ):</label>
            <textarea id="custom-point-note" placeholder="Ï€.Ï‡. Î¤Î¿ Î¾ÎµÎ½Î¿Î´Î¿Ï‡ÎµÎ¯Î¿ ÏŒÏ€Î¿Ï… Î¸Î± Î¼ÎµÎ¯Î½Î¿Ï…Î¼Îµ, ÎšÎ»ÎµÎ¹ÏƒÏ„Î¬ Î¤ÏÎ¯Ï„ÎµÏ‚..." 
                     style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 15px; height: 80px;"></textarea>
            
            <div style="text-align: center;">
                <button onclick="saveCustomPoint(${lat}, ${lng})" 
                        style="padding: 12px 25px; background: #9c27b0; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 5px; font-size: 16px;">
                    ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
                </button>
                <button onclick="closeCustomPointForm()" 
                        style="padding: 12px 25px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 5px; font-size: 16px;">
                    âŒ Î‘ÎºÏÏÏ‰ÏƒÎ·
                </button>
            </div>
        </div>
    `;
    
    // ÎšÎ±Î¸Î±ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï€Î±Î»Î¹ÏŒ modal Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
    const oldModal = document.getElementById('custom-point-modal');
    if (oldModal) oldModal.remove();
    
    document.body.insertAdjacentHTML('beforeend', formHTML);
}

// ==================== ğŸ‘† ÎœÎ•Î§Î¡Î™ Î•Î”Î© ğŸ‘† ====================

// ==================== Î Î¡ÎŸÎ£Î©Î¡Î™ÎÎŸÎ£ ÎšÎ©Î”Î™ÎšÎ‘Î£ Î“Î™Î‘ ÎÎ•Î•Î£ Î ÎŸÎ›Î•Î™Î£ ====================
const EXTRA_CITIES_CONFIG = {
    "ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¹Î½Î¿ÏÏ€Î¿Î»Î·": {  // ğŸ‘ˆ Î Î¡ÎŸÎ£Î˜Î•Î£Î• Î‘Î¥Î¤Î— Î¤Î— Î“Î¡Î‘ÎœÎœÎ—
    file: "istanbul.json", // ğŸ‘ˆ ÎšÎ‘Î™ Î‘Î¥Î¤Î— Î¤Î— Î“Î¡Î‘ÎœÎœÎ—
    enabled: true,        // ğŸ‘ˆ ÎšÎ‘Î™ Î‘Î¥Î¤Î— Î¤Î— Î“Î¡Î‘ÎœÎœÎ—
    emoji: "ğŸ•Œ"           // ğŸ‘ˆ ÎšÎ‘Î™ Î‘Î¥Î¤Î— Î¤Î— Î“Î¡Î‘ÎœÎœÎ—
  },                      // ğŸ‘ˆ ÎšÎ‘Î™ Î‘Î¥Î¤ÎŸ Î¤ÎŸ ÎšÎŸÎœÎœÎ‘
  "Î Î±ÏÎ¯ÏƒÎ¹": {
    file: "paris.json",
    enabled: true,
    emoji: "ğŸ—¼"
  },
    "Î ÏÎ¬Î³Î±": {  // ğŸ‘ˆ Î Î¡ÎŸÎ£Î˜Î—ÎšÎ— Î¤Î—Î£ Î Î¡Î‘Î“Î‘Î£!
    file: "prague.json",
    enabled: true,
    emoji: "ğŸ°"
  },
  "Î¡ÏÎ¼Î·": {
    file: "data/rome.json", 
    enabled: true,
    emoji: "ğŸ•"
  }
};

window.TravelPlannerExtensions = {
  checkAndLoadExtraCity: async function(cityName) {
    console.log(`ğŸ” ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ® Ï€ÏŒÎ»Î·: ${cityName}`);
    
    const cityConfig = EXTRA_CITIES_CONFIG[cityName];
    if (!cityConfig || !cityConfig.enabled) {
      console.log(`âŒ Î— Ï€ÏŒÎ»Î· ${cityName} Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î·`);
      return null;
    }
    
    try {
      console.log(`ğŸ“¥ Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î±Ï€ÏŒ: ${cityConfig.file}`);
      const response = await fetch(cityConfig.file);
      
      if (!response.ok) {
        console.log(`âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î±ÏÏ‡ÎµÎ¯Î¿: ${cityConfig.file}`);
        return null;
      }
      
      const data = await response.json();
      console.log(`âœ… Î¦Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ: ${cityName} (${data.activities?.length || 0} Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚)`);
      return data;
      
    } catch (error) {
      console.error(`âŒ Î£Ï†Î¬Î»Î¼Î±:`, error);
      return null;
    }
  }
};
// ==================== PWA SERVICE WORKER ====================
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js')
      .then(function(registration) {
        console.log('âœ… Service Worker registered: ', registration.scope);
      })
      .catch(function(error) {
        console.log('âŒ Service Worker registration failed: ', error);
      });
  });
}
 // ==================== ÎœÎ•Î¤Î‘Î¤Î¡ÎŸÎ Î•Î‘Î£ Î“Î™Î‘ ÎŸÎ›Î‘ Î¤Î‘ Î Î‘Î›Î™Î‘ FORMATS ====================
function convertAnyPriceFormatToPerAge(oldPrices) {
  console.log("ğŸ”„ ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® Ï€Î±Î»Î¹ÏÎ½ Ï„Î¹Î¼ÏÎ½:", oldPrices);
  
  const newPrices = {};
  
  // 1. Î•Î›Î•Î“Î§ÎŸÎ£ Î“Î™Î‘ ÎšÎ‘Î™ÎÎŸÎ¥Î¡Î“Î™ÎŸ FORMAT
  if (oldPrices["0"] !== undefined || oldPrices["adult"] !== undefined) {
    console.log("âœ… Î‰Î´Î· ÎµÎ¯Î½Î±Î¹ per-age format");
    return oldPrices;
  }
  
  // 2. ÎœÎ•Î¤Î‘Î¤Î¡ÎŸÎ Î—
  
  // 0-2 ÎµÏ„ÏÎ½
  if (oldPrices["0-2"] !== undefined) {
    for (let age = 0; age <= 2; age++) newPrices[age] = oldPrices["0-2"];
  }
  
  // 3-5 ÎµÏ„ÏÎ½
  if (oldPrices["3-5"] !== undefined) {
    for (let age = 3; age <= 5; age++) newPrices[age] = oldPrices["3-5"];
  }
  
  // 6-14 ÎµÏ„ÏÎ½
  if (oldPrices["6-14"] !== undefined) {
    for (let age = 6; age <= 14; age++) newPrices[age] = oldPrices["6-14"];
  }
  
  // 15-19 ÎµÏ„ÏÎ½ - Î£Î ÎŸÎ¥Î”Î‘Î™Î‘ Î”Î™ÎŸÎ¡Î˜Î©Î£Î—!
  if (oldPrices["15-19"] !== undefined) {
    // 15-17: 31.5â‚¬
    for (let age = 15; age <= 17; age++) {
        newPrices[age] = oldPrices["15-19"];
    }
    // 18-19: adult price (ÏŒÏ‡Î¹ 15-19 price!)
    if (oldPrices["18+"] !== undefined) {
        newPrices[18] = oldPrices["18+"];
        newPrices[19] = oldPrices["18+"];
    } else {
        // Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ 18+, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ 15-19
        newPrices[18] = oldPrices["15-19"];
        newPrices[19] = oldPrices["15-19"];
    }
  }
  
  // Î•Î½Î®Î»Î¹ÎºÎµÏ‚ (18+)
  if (oldPrices["18+"] !== undefined) {
    newPrices["adult"] = oldPrices["18+"];
  }
  
  // Î“Î™Î‘ JSON Î ÎŸÎ›Î•Î™Î£ (0-6, 7-12, 13-17, 18+)
  if (oldPrices["0-6"] !== undefined) {
    for (let age = 0; age <= 6; age++) {
      if (newPrices[age] === undefined) newPrices[age] = oldPrices["0-6"];
    }
  }
  
  if (oldPrices["7-12"] !== undefined) {
    for (let age = 7; age <= 12; age++) {
      if (newPrices[age] === undefined) newPrices[age] = oldPrices["7-12"];
    }
  }
  
  if (oldPrices["13-17"] !== undefined) {
    for (let age = 13; age <= 17; age++) {
      if (newPrices[age] === undefined) newPrices[age] = oldPrices["13-17"];
    }
  }
  
  // 3. Î Î¡ÎŸÎ£Î¤Î—Î˜Î•Î£Î— ADULT Î•Î‘Î Î›Î•Î™Î Î•Î™
  if (!newPrices["adult"] && oldPrices["18+"]) {
    newPrices["adult"] = oldPrices["18+"];
  }
  
  // 4. Î’Î•Î›Î¤Î™Î©Î£Î—: Î‘Î½ ÎºÎ¬Ï€Î¿Î¹Î± Î·Î»Î¹ÎºÎ¯Î± Î»ÎµÎ¯Ï€ÎµÎ¹
  for (let age = 0; age <= 17; age++) {
    if (newPrices[age] === undefined) {
      for (let lowerAge = age - 1; lowerAge >= 0; lowerAge--) {
        if (newPrices[lowerAge] !== undefined) {
          newPrices[age] = newPrices[lowerAge];
          break;
        }
      }
      if (newPrices[age] === undefined && newPrices["adult"] !== undefined) {
        newPrices[age] = newPrices["adult"];
      }
    }
  }
  
  console.log("âœ… ÎÎ­ÎµÏ‚ Ï„Î¹Î¼Î­Ï‚ (per-age):", JSON.stringify(newPrices));
  return newPrices;
}
// ==================== ÎÎ•Î•Î£ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ Î“Î™Î‘ Î’Î—ÎœÎ‘ 4 ====================

// 2. Î— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î— Î ÎŸÎ¥ Î¦ÎŸÎ¡Î¤Î©ÎÎ•Î™ Î¤Î™Î£ Î ÎŸÎ›Î•Î™Î£
async function loadCityActivities(cityName) {
    console.log("ğŸ” Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½ Î³Î¹Î±:", cityName);
    
    try {
        // Î§Î‘Î¡Î¤Î—Î£ Î ÎŸÎ›Î•Î©Î -> Î‘Î¡Î§Î•Î™Î©Î
        const cityFileMap = {
            'Î’Î¹Î­Î½Î½Î·': 'vienna.json',
            'Î›Î¿Î½Î´Î¯Î½Î¿': 'london.json',
            'ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¹Î½Î¿ÏÏ€Î¿Î»Î·': 'istanbul.json',
            'Î Î±ÏÎ¯ÏƒÎ¹': 'paris.json',
            'Î ÏÎ¬Î³Î±': 'prague.json',
            'Î’ÎµÏÎ¿Î»Î¯Î½Î¿': 'berlin.json',
            'Î›Î¹ÏƒÎ±Î²ÏŒÎ½Î±': 'lisbon.json',
            'Î’Î¿Ï…Î´Î±Ï€Î­ÏƒÏ„Î·': 'budapest.json',
            'ÎœÎ±Î´ÏÎ¯Ï„Î·': 'madrid.json'
        };

        const filename = cityFileMap[cityName];
        
        if (!filename) {
            console.log(`âš ï¸ Î— Ï€ÏŒÎ»Î· ${cityName} Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Î±ÎºÏŒÎ¼Î± JSON`);
            return null;
        }
        
        console.log("ğŸ“ Î¦ÏŒÏÏ„Ï‰ÏƒÎ·:", filename);
        const response = await fetch(filename);
        
        if (!response.ok) {
            throw new Error(`Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ ${filename}`);
        }
        
        const cityData = await response.json();
        console.log(`âœ… Î’ÏÎ­Î¸Î·ÎºÎµ: ${cityData.city} (${cityData.activities.length} Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚)`);
        
        // Î•Î Î™Î£Î¤Î¡ÎŸÎ¦Î— Î¤Î©Î Î”Î•Î”ÎŸÎœÎ•ÎÎ©Î Î§Î©Î¡Î™Î£ ÎœÎ•Î¤Î‘Î¤Î¡ÎŸÎ Î—
        // (Î³Î¹Î±Ï„Î¯ Ï„Î± Î½Î­Î± JSON Î­Ï‡Î¿Ï…Î½ Î®ÏƒÏ‰ per-age prices)
        return {
            name: cityData.city,
            country: cityData.country,
            currency: cityData.currency,
            emoji: cityData.emoji,
            description: cityData.description,
            location: cityData.location,
            activities: cityData.activities
        };
        
    } catch (error) {
        console.error("âŒ Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚:", error.message);
        return null;
    }
}
// 2. Î— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î— Î ÎŸÎ¥ Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î•Î™ ÎšÎ‘Î¡Î¤Î•Î£
function createActivityCardsNew(activityList) {
    console.log("ğŸƒ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ±ÏÏ„ÏÎ½ Î³Î¹Î±", activityList.length, "Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚");
    
    const container = document.getElementById('activities-container');
    if (!container) {
        console.error("âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ container!");
        return;
    }
    
    container.innerHTML = "";
    
    // Î’Î¿Î·Î¸Î·Ï„Î¹ÎºÎ®: Î Î¬ÏÏ„Î¹ Ï„Î·Î½ Ï„Î¹Î¼Î® Î³Î¹Î± Î¼Î¹Î± Î·Î»Î¹ÎºÎ¹Î±ÎºÎ® Î¿Î¼Î¬Î´Î±
    function getPriceForAgeRange(prices, minAge, maxAge) {
        if (!prices) return 0;
        
        // Î¨Î¬Ï‡Î½Î¿Ï…Î¼Îµ Î³Î¹Î± Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Ï„Î¹Î¼Î® ÏƒÏ„Î·Î½ Î¿Î¼Î¬Î´Î±
        for (let age = minAge; age <= maxAge; age++) {
            if (prices[age] !== undefined) {
                return prices[age];
            }
        }
        
        // Î‘Î½ Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ, Î´Î¿ÎºÎ¹Î¼Î¬Î¶Î¿Ï…Î¼Îµ Ï„Î¿ adult
        return (prices && prices.adult) || 0;
    }
    
    activityList.forEach((act, index) => {
        const card = document.createElement('div');
        card.className = "activity-card";
        console.log(`Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ¬ÏÏ„Î±Ï‚ ${index}: "${act.name}", selected: ${act.selected}`);
        // Î•Î¬Î½ Î· Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î·, Ï€ÏÏŒÏƒÎ¸ÎµÏƒÎµ Ï„Î·Î½ ÎºÎ»Î¬ÏƒÎ· .selected
if (act.selected === true) {
    card.classList.add('selected');
}
        card.id = `activity-${index}`;
        
        card.innerHTML = `
            <span class="star">â­</span>
            <div class="activity-info">
                <h3>${act.name}</h3>
                <p>${act.desc || act.description || ''}</p>
                
                <!-- Î Î™ÎÎ‘ÎšÎ‘Î£ Î¤Î™ÎœÎ©Î Î‘ÎÎ‘ Î—Î›Î™ÎšÎ™Î‘ÎšÎ— ÎŸÎœÎ‘Î”Î‘ -->
                <div style="margin-top: 15px;">
                    <table class="activity-table" style="width: 100%; text-align: center; border-collapse: collapse; font-size: 0.85em;">
                        <tr>
                            <th style="padding: 4px; background: #f0f8ff;">0-5</th>
                            <th style="padding: 4px; background: #f0f8ff;">6-14</th>
                            <th style="padding: 4px; background: #f0f8ff;">15-17</th>
                            <th style="padding: 4px; background: #f0f8ff;">18+</th>
                        </tr>
                        <tr>
                            <td style="padding: 4px; border: 1px solid #ddd;">${getPriceForAgeRange(act.prices, 0, 5)}â‚¬</td>
                            <td style="padding: 4px; border: 1px solid #ddd;">${getPriceForAgeRange(act.prices, 6, 14)}â‚¬</td>
                            <td style="padding: 4px; border: 1px solid #ddd;">${getPriceForAgeRange(act.prices, 15, 17)}â‚¬</td>
                            <td style="padding: 4px; border: 1px solid #ddd;">${(act.prices && act.prices.adult) || 0}â‚¬</td>
                        </tr>
                    </table>
                </div>
                
                <div class="total" id="total-${index}">ÎšÏŒÏƒÏ„Î¿Ï‚: 0 â‚¬</div>
            </div>
        `;
        
        card.addEventListener('click', () => {
            console.log(`ğŸ–±ï¸ ÎšÎ»Î¹Îº ÏƒÏ„Î·Î½ ÎºÎ¬ÏÏ„Î± ${index}: ${act.name}`);
            
            // 1. Î‘Î»Î»Î±Î³Î® visual state Ï„Î·Ï‚ ÎºÎ¬ÏÏ„Î±Ï‚
            card.classList.toggle('selected');
            
            // 2. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… activity object
            if (act.selected === undefined) act.selected = false;
            act.selected = !act.selected;
            
            console.log(`   âœ… Î¤ÏÏÎ± ÎµÎ¯Î½Î±Î¹ selected: ${act.selected}`);
            
            // 3. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… ÎºÎµÎ½Ï„ÏÎ¹ÎºÎ¿Ï array
            if (window.currentCityActivities && window.currentCityActivities[index]) {
                window.currentCityActivities[index].selected = act.selected;
            }
            
            // 4. Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÎºÏŒÏƒÏ„Î¿Ï…Ï‚
            calculateAllCostsNew();
            
            // 5. Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
            saveToLocalStorage();
        });
        
        container.appendChild(card);
    });
    
    console.log("âœ… Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½", activityList.length, "ÎºÎ¬ÏÏ„ÎµÏ‚");
}

// 3. Î— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î— Î ÎŸÎ¥ Î¥Î ÎŸÎ›ÎŸÎ“Î™Î–Î•Î™ Î¤ÎŸ ÎšÎŸÎ£Î¤ÎŸÎ£
function calculateAllCostsNew() {
    console.log("ğŸ§® Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÎºÏŒÏƒÏ„Î¿Ï…Ï‚...");
    
    if (!window.currentCityActivities) {
        console.error("âŒ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚!");
        return;
    }
    
    // Î’Î•Î’Î‘Î™Î©Î£ÎŸÎ¥ ÎŸÎ¤Î™ Î— ÎŸÎ™ÎšÎŸÎ“Î•ÎÎ•Î™Î‘ Î•Î™ÎÎ‘Î™ Î•ÎÎ—ÎœÎ•Î¡Î©ÎœÎ•ÎÎ—
    if (familyMembers.length === 0) {
        alert("âš ï¸ Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Î¿ÏÎ¯ÏƒÎµÎ¹ Î¼Î­Î»Î· Î¿Î¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚! Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î¹Ï‚ Î·Î»Î¹ÎºÎ¯ÎµÏ‚ ÎºÎ±Î¹ Ï€Î±Ï„Î®ÏƒÏ„Îµ 'ğŸ”„ Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚'");
        return;
    }
    
    let overallTotal = 0;
    
    window.currentCityActivities.forEach((act, index) => {
        const card = document.getElementById(`activity-${index}`);
        if (!card) return;
        
        const isSelected = card.classList.contains('selected');
        const totalElement = document.getElementById(`total-${index}`);
        
        if (isSelected && totalElement) {
            // Î Î¡Î‘Î“ÎœÎ‘Î¤Î™ÎšÎŸÎ£ Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ ÎœÎ• Î¤ÎŸ ÎÎ•ÎŸ FORMAT
            let activityTotal = 0;
            
            familyMembers.forEach(member => {
                const age = member.age;
                let price = 0;
                
                // 1. Î•Î‘Î Î•Î§Î•Î™ ÎÎ•ÎŸ FORMAT (0, 1, 2, ..., adult)
                if (act.prices && act.prices[age] !== undefined) {
                    price = act.prices[age];
                }
                // 2. Î•Î‘Î Î•Î§Î•Î™ Î Î‘Î›Î™ÎŸ FORMAT (0-2, 3-5, ÎºÎ»Ï€)
                else if (age <= 2 && act.prices["0-2"] !== undefined) {
                    price = act.prices["0-2"];
                }
                else if (age <= 5 && act.prices["3-5"] !== undefined) {
                    price = act.prices["3-5"];
                }
                else if (age <= 14 && act.prices["6-14"] !== undefined) {
                    price = act.prices["6-14"];
                }
                else if (age <= 19 && act.prices["15-19"] !== undefined) {
                    price = act.prices["15-19"];
                }
                else if (act.prices["18+"] !== undefined) {
                    price = act.prices["18+"];
                }
                // 3. Î•Î‘Î Î•Î§Î•Î™ JSON FORMAT (0-6, 7-12, ÎºÎ»Ï€)
                else if (age <= 6 && act.prices["0-6"] !== undefined) {
                    price = act.prices["0-6"];
                }
                else if (age <= 12 && act.prices["7-12"] !== undefined) {
                    price = act.prices["7-12"];
                }
                else if (age <= 17 && act.prices["13-17"] !== undefined) {
                    price = act.prices["13-17"];
                }
                // 4. Î¤Î•Î›Î™ÎšÎŸ: Î•ÎÎ—Î›Î™ÎšÎŸÎ£
                else if (act.prices["adult"] !== undefined) {
                    price = act.prices["adult"];
                }
                else if (act.prices["18+"] !== undefined) {
                    price = act.prices["18+"];
                }
                
                activityTotal += price;
            });
            
            totalElement.textContent = `ÎšÏŒÏƒÏ„Î¿Ï‚: ${activityTotal} â‚¬`;
            overallTotal += activityTotal;
            
        } else if (totalElement) {
            totalElement.textContent = "ÎšÏŒÏƒÏ„Î¿Ï‚: 0 â‚¬";
        }
    });
    
    const overallElement = document.getElementById('overall-total');
    if (overallElement) {
        overallElement.textContent = `Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚: ${overallTotal} â‚¬`;
    }
    
    console.log("ğŸ’° Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚:", overallTotal, "â‚¬");
}
// ==================== ÎšÎ©Î”Î™ÎšÎ‘Î£ Î“Î™Î‘ Î•Î¦Î‘Î¡ÎœÎŸÎ“Î— COMBO ====================

function applyComboToTotal(comboName, savingAmount) {
    console.log(`âœ… Î•Ï†Î±ÏÎ¼Î¿Î³Î® combo: ${comboName} (Î•Î¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ·: ${savingAmount}â‚¬)`);
    
    // 1. ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ modal
    closeComboModal();
    
    // 2. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¿Ï ÎºÏŒÏƒÏ„Î¿Ï…Ï‚
    const totalElement = document.getElementById('overall-total');
    if (!totalElement) {
        alert('âš ï¸ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚');
        return;
    }
    
    // Î Î¬ÏÎµ Ï„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ ÎºÏŒÏƒÏ„Î¿Ï‚
    const text = totalElement.textContent;
    const match = text.match(/(\d+\.?\d*)\s*â‚¬/);
    let currentTotal = match ? parseFloat(match[1]) : 0;
    
    // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î½Î­Î¿Ï… ÎºÏŒÏƒÏ„Î¿Ï…Ï‚
    const newTotal = Math.max(0, currentTotal - savingAmount);
    
    // 3. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·Ï‚
    totalElement.textContent = `Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ Î•Ï€Î¹Î»ÎµÎ³Î¼Î­Î½Ï‰Î½ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½: ${newTotal.toFixed(2)} â‚¬ (Î¼Îµ ${comboName})`;
    
    // 4. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·Ï‚
    const existingNote = document.querySelector('.combo-applied-note');
    if (existingNote) existingNote.remove();
    
    const note = document.createElement('div');
    note.className = 'combo-applied-note';
    note.style.cssText = `
        max-width: 1000px;
        margin: 15px auto;
        padding: 12px;
        background: #e8f5e8;
        border-radius: 10px;
        border: 2px solid #4caf50;
        text-align: center;
        font-size: 16px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    `;
    note.innerHTML = `
        âœ… <strong>${comboName}</strong> ÎµÏ†Î±ÏÎ¼ÏŒÏƒÏ„Î·ÎºÎµ<br>
        ğŸ’° Î•Î¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ·: <strong>${savingAmount.toFixed(2)} â‚¬</strong><br>
        ğŸ“Š ÎÎ­Î¿ ÏƒÏÎ½Î¿Î»Î¿: <strong>${newTotal.toFixed(2)} â‚¬</strong>
    `;
    
    totalElement.parentNode.insertBefore(note, totalElement.nextSibling);
    
    // 5. ÎœÎ®Î½Ï…Î¼Î± ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·Ï‚
    alert(`âœ… Î¤Î¿ combo "${comboName}" ÎµÏ†Î±ÏÎ¼ÏŒÏƒÏ„Î·ÎºÎµ!\nğŸ’° Î•Î¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ·: ${savingAmount.toFixed(2)}â‚¬\nğŸ“Š Î ÏÎ¹Î½: ${currentTotal.toFixed(2)}â‚¬ | ÎœÎµÏ„Î¬: ${newTotal.toFixed(2)}â‚¬`);
    
    // 6. Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
    localStorage.setItem('applied_combo', JSON.stringify({
        name: comboName,
        saving: savingAmount,
        date: new Date().toLocaleString('el-GR')
    }));
}

// ==================== Î¤Î•Î›ÎŸÎ£ ÎšÎ©Î”Î™ÎšÎ‘ COMBO ====================
// ==================== Î¤Î•Î›ÎŸÎ£ ÎÎ•Î©Î Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î©Î ====================
 console.log("âœ… ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Ï†Î¿ÏÏ„ÏÎ¸Î·ÎºÎ±Î½ ÏƒÏ‰ÏƒÏ„Î¬!"); 
 // ==================== Î•ÎÎ¥Î ÎÎŸÎ£ Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ COMBO (ÎÎ•ÎŸ - Î“Î™Î‘ ÎŸÎ›Î•Î£ Î¤Î™Î£ Î ÎŸÎ›Î•Î™Î£) ====================

function calculateSmartCombos() {
    console.log("ğŸ¯ ÎˆÎ½Î±ÏÎ¾Î· Î­Î¾Ï…Ï€Î½Î¿Ï… Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï combos...");
    
    // 1. Î’Î¡Î•Î£ Î¤Î™Î£ Î¤Î¡Î•Î§ÎŸÎ¥Î£Î•Î£ Î”Î¡Î‘Î£Î¤Î—Î¡Î™ÎŸÎ¤Î—Î¤Î•Î£
    let currentActivities = window.currentCityActivities || [];
    
    if (!currentActivities || currentActivities.length === 0) {
        alert("âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚.");
        return;
    }
    
    // 2. Î•Î Î™Î£Î¤Î¡Î•Î¦ÎŸÎ¥Î ÎœÎŸÎÎŸ Î•Î Î™Î›Î•Î“ÎœÎ•ÎÎ•Î£
    const selectedActivities = currentActivities.filter(act => act.selected === true);
    
    if (selectedActivities.length === 0) {
        alert("âš ï¸ Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚! ÎšÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÏƒÏ„Î¹Ï‚ ÎºÎ¬ÏÏ„ÎµÏ‚.");
        return;
    }
    
    console.log(`âœ… Î’ÏÎ­Î¸Î·ÎºÎ±Î½ ${selectedActivities.length} ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚`);
    
    // 3. Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ Î£Î¥ÎÎŸÎ›Î™ÎšÎŸÎ¥ ÎšÎŸÎ£Î¤ÎŸÎ¥Î£ ÎŸÎ›Î©Î Î¤Î©Î Î•Î Î™Î›Î•Î“ÎœÎ•ÎÎ©Î Î”Î¡Î‘Î£Î¤Î—Î¡Î™ÎŸÎ¤Î—Î¤Î©Î
    const ageGroups = categorizeFamilyMembers();
    const totalRegularCost = calculateComboRegularCost(selectedActivities, ageGroups);
    
    // 4. Î‘ÎÎ‘Î–Î—Î¤Î—Î£Î— COMBO Î’Î‘Î£Î•Î™ Î ÎŸÎ›Î—Î£
    let availableCombos = [];
    
    if (selectedDestinationName.includes("Î›Î¿Î½Î´Î¯Î½Î¿")) {
        availableCombos = findLondonCombos(selectedActivities, ageGroups);
    } else if (selectedDestinationName.includes("Î’Î¹Î­Î½Î½Î·")) {
        availableCombos = findViennaCombos(selectedActivities, ageGroups);
    } else if (selectedDestinationName.includes("Î’ÎµÏÎ¿Î»Î¯Î½Î¿")) {
        availableCombos = findBerlinCombos(selectedActivities, ageGroups);
    } else {
        availableCombos = findGenericCombos(selectedActivities, ageGroups);
    }
    
    // 5. Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ ÎšÎ‘Î›Î¥Î¤Î•Î¡ÎŸÎ¥ COMBO
    let bestCombo = null;
    let bestSaving = 0;
    
    availableCombos.forEach(combo => {
        // Î¤Î¿ combo.regularPrice ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ÎºÏŒÏƒÏ„Î¿Ï‚ ÎœÎŸÎÎŸ Ï„Ï‰Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½ Ï€Î¿Ï… ÎºÎ±Î»ÏÏ€Ï„ÎµÎ¹ Ï„Î¿ combo
        // Î¤Î¿ combo.comboPrice ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ÎºÏŒÏƒÏ„Î¿Ï‚ Ï„Î¿Ï… combo Î³Î¹Î± Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚
        const comboRegularCost = combo.regularPrice; // ÎœÏŒÎ½Î¿ Î³Î¹Î± Ï„Î¹Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Ï€Î¿Ï… ÎºÎ±Î»ÏÏ€Ï„ÎµÎ¹ Ï„Î¿ combo
        const comboSaving = comboRegularCost - combo.comboPrice; // Î•Î¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ· ÏƒÏ„Î¹Ï‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚
        
        if (comboSaving > bestSaving) {
            bestSaving = comboSaving;
            bestCombo = combo;
        }
    });
    
    // 6. Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ Î¤Î•Î›Î™ÎšÎŸÎ¥ ÎšÎŸÎ£Î¤ÎŸÎ¥Î£
    let finalTotalCost = totalRegularCost;
    if (bestCombo && bestSaving > 0) {
        finalTotalCost = totalRegularCost - bestSaving; // Î‘Ï†Î±Î¹ÏÎ¿ÏÎ¼Îµ ÎœÎŸÎÎŸ Ï„Î·Î½ ÎµÎ¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ· Î±Ï€ÏŒ Ï„Î¹Ï‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚
    }
    
    // 7. Î•ÎœÎ¦Î‘ÎÎ™Î£Î— Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘Î¤Î©Î
    const results = {
        totalRegularCost: totalRegularCost,
        bestCombo: bestCombo,
        bestSaving: bestSaving,
        finalTotalCost: finalTotalCost,
        allCombos: availableCombos
    };
    
    displayComboResults(results, totalRegularCost);
}
// ==================== Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ•Î£ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ COMBO ====================

function categorizeFamilyMembers() {
    console.log("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¹Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¿Î¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚...");
    
    const categories = {
        "0-2": 0,
        "3-5": 0,
        "6-14": 0,
        "15-19": 0,
        "18+": 0
    };
   
    familyMembers.forEach(member => {
        if (member.age <= 2) {
            categories["0-2"]++;
        } else if (member.age <= 5) {
            categories["3-5"]++;
        } else if (member.age <= 14) {
            categories["6-14"]++;
        } else if (member.age <= 19) {
            categories["15-19"]++;
        } else {
            categories["18+"]++;
        }
    });
   
    return categories;
}

function calculateComboRegularCost(selectedActivities, ageGroups) {
    console.log("ğŸ§® Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï ÎºÏŒÏƒÏ„Î¿Ï…Ï‚ Î³Î¹Î±:", selectedActivities.length, "Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚");
    
    let totalCost = 0;
    
    selectedActivities.forEach((activity) => {
        console.log(`   ğŸ” Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±: ${activity.name}`);
        
        let activityCost = 0;
        
        // Î“Î¹Î± ÎºÎ¬Î¸Îµ Î·Î»Î¹ÎºÎ¹Î±ÎºÎ® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±
        Object.keys(ageGroups).forEach(ageCategory => {
            const numberOfPeople = ageGroups[ageCategory];
            
            if (numberOfPeople > 0) {
                console.log(`       ğŸ‘¥ ${ageCategory}: ${numberOfPeople} Î¬Ï„Î¿Î¼Î±`);
                
                let price = 0;
                
                // Î’ÏÎµÏ‚ Ï„Î·Î½ Ï„Î¹Î¼Î® Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ Î·Î»Î¹ÎºÎ¹Î±ÎºÎ® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±
                if (activity.prices) {
                    if (ageCategory === "0-2" && activity.prices["0-2"] !== undefined) {
                        price = activity.prices["0-2"];
                    } else if (ageCategory === "3-5" && activity.prices["3-5"] !== undefined) {
                        price = activity.prices["3-5"];
                    } else if (ageCategory === "6-14" && activity.prices["6-14"] !== undefined) {
                        price = activity.prices["6-14"];
                    } else if (ageCategory === "15-19" && activity.prices["15-19"] !== undefined) {
                        price = activity.prices["15-19"];
                    } else if (ageCategory === "18+" && activity.prices["18+"] !== undefined) {
                        price = activity.prices["18+"];
                    } else if (activity.prices["adult"] !== undefined) {
                        price = activity.prices["adult"];
                    }
                }
                
                console.log(`       ğŸ’µ Î¤Î¹Î¼Î® Î±Î½Î¬ Î¬Ï„Î¿Î¼Î¿: ${price}â‚¬`);
                activityCost += price * numberOfPeople;
            }
        });
        
        console.log(`   ğŸ’° ÎšÏŒÏƒÏ„Î¿Ï‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±Ï‚: ${activityCost}â‚¬\n`);
        totalCost += activityCost;
    });
    
    console.log(`ğŸ’° Î£Î¥ÎÎŸÎ›Î™ÎšÎŸ ÎšÎ‘ÎÎŸÎÎ™ÎšÎŸ ÎšÎŸÎ£Î¤ÎŸÎ£ (Î“Î™Î‘ ÎŸÎ›Î•Î£): ${totalCost}â‚¬`);
    return totalCost;
}

function findLondonCombos(selectedActivities, ageGroups) {
    console.log("ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· combos Î³Î¹Î± Î›Î¿Î½Î´Î¯Î½Î¿");
    const combos = [];
    
    // ============================================
    // 1. MERLIN PASS COMBO (Sea Life + London Eye + Madame Tussauds + Shrek)
    // ============================================
    const merlinAttractions = selectedActivities.filter(act => {
        const name = act.name.toLowerCase();
        return name.includes("sea life") || 
               name.includes("london eye") || 
               name.includes("madame tussauds") || 
               name.includes("shrek") ||
               name.includes("london dungeon") ||
               name.includes("thorpe park");
    });
    
    if (merlinAttractions.length >= 2) {
        // ÎšÏŒÏƒÏ„Î¿Ï‚ Î§Î©Î¡Î™Î£ combo (Î³Î¹'Î±Ï…Ï„ÎµÏ‚ Ï„Î¹Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ ÎœÎŸÎÎŸ)
        const normalCostForMerlin = calculateComboRegularCost(merlinAttractions, ageGroups);
        
        // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÎºÏŒÏƒÏ„Î¿Ï…Ï‚ Merlin Pass Î‘ÎÎ‘ Î‘Î¤ÎŸÎœÎŸ
        const adultCount = ageGroups["18+"] || 0;
        const childCount = (ageGroups["6-14"] || 0) + (ageGroups["15-19"] || 0);
        
        // Î¤Î¹Î¼Î­Ï‚ Merlin Pass (Ï€ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ· - Î²Î¬Î»Îµ Ï„Î¹Ï‚ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ­Ï‚ Ï„Î¹Î¼Î­Ï‚)
        const merlinPassAdultPrice = 79;  // Â£ Î±Î½Î¬ ÎµÎ½Î®Î»Î¹ÎºÎ±
        const merlinPassChildPrice = 69;  // Â£ Î±Î½Î¬ Ï€Î±Î¹Î´Î¯
        
        // Î£Î¥ÎÎŸÎ›Î™ÎšÎŸ ÎšÎŸÎ£Î¤ÎŸÎ£ COMBO ÎœÎ• PASS
        const comboCostMerlin = (adultCount * merlinPassAdultPrice) + (childCount * merlinPassChildPrice);
        
        if (normalCostForMerlin > comboCostMerlin) {
            combos.push({
                name: "ğŸ¡ Merlin Pass London",
                description: `Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ${merlinAttractions.length} Î±Î¾Î¹Î¿Î¸Î­Î±Ï„Î± Ï„Î·Ï‚ Merlin`,
                activities: merlinAttractions.map(a => a.name),
                regularPrice: normalCostForMerlin,
                comboPrice: comboCostMerlin,
                saving: normalCostForMerlin - comboCostMerlin,
                note: `ğŸ’° Î•Î½Î·Î»Î¯ÎºÏ‰Î½: ${merlinPassAdultPrice}â‚¬ Ã— ${adultCount} = ${adultCount * merlinPassAdultPrice}â‚¬ | Î Î±Î¹Î´Î¹ÏÎ½: ${merlinPassChildPrice}â‚¬ Ã— ${childCount} = ${childCount * merlinPassChildPrice}â‚¬`
            });
        }
    }
    
    // ============================================
    // 2. LONDON PASS COMBO
    // ============================================
    const londonPassActivities = selectedActivities.filter(act => {
        const name = act.name.toLowerCase();
        return name.includes("tower of london") ||
               name.includes("tower bridge") ||
               name.includes("westminster abbey") ||
               name.includes("st. paul") ||
               name.includes("kensington palace") ||
               name.includes("hampton court") ||
               name.includes("shakespeare") ||
               name.includes("thames cruise");
    });
    
    if (londonPassActivities.length >= 3) {
        const normalCostLondonPass = calculateComboRegularCost(londonPassActivities, ageGroups);
        
        // London Pass Ï„Î¹Î¼Î­Ï‚ Î±Î½Î¬ Î·Î¼Î­ÏÎ± Î±Î½Î¬ Î¬Ï„Î¿Î¼Î¿
        const adultCount = ageGroups["18+"] || 0;
        const childCount = (ageGroups["6-14"] || 0) + (ageGroups["15-19"] || 0);
        
        const londonPass1DayAdult = 79;
        const londonPass1DayChild = 55;
        const londonPass2DayAdult = 109;
        const londonPass2DayChild = 79;
        
        // Î•Ï€Î¹Î»Î¿Î³Î® Î·Î¼ÎµÏÏÎ½ Î²Î¬ÏƒÎµÎ¹ Î±ÏÎ¹Î¸Î¼Î¿Ï Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½
        const daysNeeded = Math.min(3, Math.ceil(londonPassActivities.length / 4));
        const is2Days = daysNeeded >= 2;
        
        const comboCostLondon = is2Days ? 
            (adultCount * londonPass2DayAdult) + (childCount * londonPass2DayChild) :
            (adultCount * londonPass1DayAdult) + (childCount * londonPass1DayChild);
        
        if (normalCostLondonPass > comboCostLondon) {
            combos.push({
                name: is2Days ? "ğŸ« London Pass (2 Î·Î¼Î­ÏÎµÏ‚)" : "ğŸ« London Pass (1 Î·Î¼Î­ÏÎ±)",
                description: `ÎšÎ±Î»ÏÏ€Ï„ÎµÎ¹ ${londonPassActivities.length} Î±Î¾Î¹Î¿Î¸Î­Î±Ï„Î±`,
                activities: londonPassActivities.map(a => a.name),
                regularPrice: normalCostLondonPass,
                comboPrice: comboCostLondon,
                saving: normalCostLondonPass - comboCostLondon,
                note: `ğŸ‘¥ ${adultCount} ÎµÎ½Î®Î»Î¹ÎºÎµÏ‚, ${childCount} Ï€Î±Î¹Î´Î¹Î¬ | ${is2Days ? '2' : '1'} Î·Î¼Î­ÏÎµÏ‚`
            });
        }
    }
    
    // ============================================
    // 3. SEA LIFE + LONDON EYE COMBO
    // ============================================
    const seaLife = selectedActivities.find(a => a.name.toLowerCase().includes("sea life"));
    const londonEye = selectedActivities.find(a => a.name.toLowerCase().includes("london eye"));
    
    if (seaLife && londonEye) {
        const normalCostPair = calculateComboRegularCost([seaLife, londonEye], ageGroups);
        
        // Combo Ï„Î¹Î¼Î® Î±Î½Î¬ Î¬Ï„Î¿Î¼Î¿
        const adultCount = ageGroups["18+"] || 0;
        const childCount = (ageGroups["6-14"] || 0) + (ageGroups["15-19"] || 0);
        
        const comboAdultPrice = 45;  // Combo price per adult
        const comboChildPrice = 35;  // Combo price per child
        
        const comboCostPair = (adultCount * comboAdultPrice) + (childCount * comboChildPrice);
        
        if (normalCostPair > comboCostPair) {
            combos.push({
                name: "ğŸŒŠ Sea Life + ğŸ¡ London Eye Combo",
                description: "Î•Î¹Î´Î¹ÎºÎ® Ï„Î¹Î¼Î® Î³Î¹Î± Ï„Î± 2 Î´Î·Î¼Î¿Ï†Î¹Î»Î® Î±Î¾Î¹Î¿Î¸Î­Î±Ï„Î±",
                activities: [seaLife.name, londonEye.name],
                regularPrice: normalCostPair,
                comboPrice: comboCostPair,
                saving: normalCostPair - comboCostPair,
                note: `ğŸ“Š Combo: ${comboAdultPrice}â‚¬ ÎµÎ½Î®Î»Î¹ÎºÎ±Ï‚, ${comboChildPrice}â‚¬ Ï€Î±Î¹Î´Î¯`
            });
        }
    }
    
    return combos;
}

function findViennaCombos(selectedActivities, ageGroups) {
    console.log("ğŸ‡¦ğŸ‡¹ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· combos Î³Î¹Î± Î’Î¹Î­Î½Î½Î·");
    const combos = [];
    
    // SISI PASS
    const imperialActivities = selectedActivities.filter(act => 
        act.name.includes("SchÃ¶nbrunn") || 
        act.name.includes("Sisi") ||
        act.name.includes("Hofburg") ||
        act.name.includes("Palace")
    );
    
    if (imperialActivities.length >= 2) {
        const normalCost = calculateComboRegularCost(imperialActivities, ageGroups);
        const passCost = 57; // Sisi Pass
        
        if (normalCost > passCost) {
            combos.push({
                name: "ğŸ‘‘ Sisi Pass Vienna",
                description: "Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ 3 Î±Ï…Ï„Î¿ÎºÏÎ±Ï„Î¿ÏÎ¹ÎºÎ¬ Î±Î¾Î¹Î¿Î¸Î­Î±Ï„Î±",
                activities: imperialActivities.map(a => a.name),
                regularPrice: normalCost,
                comboPrice: passCost,
                saving: normalCost - passCost,
                note: "SchÃ¶nbrunn + Sisi Museum + Furniture Museum"
            });
        }
    }
    
    return combos;
}

function findBerlinCombos(selectedActivities, ageGroups) {
    console.log("ğŸ‡©ğŸ‡ª Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· combos Î³Î¹Î± Î’ÎµÏÎ¿Î»Î¯Î½Î¿");
    const combos = [];
    
    // BERLIN WELCOME CARD
    const berlinAttractions = selectedActivities.filter(act => 
        act.name.includes("Museum") ||
        act.name.includes("Fernsehturm") ||
        act.name.includes("Checkpoint") ||
        act.name.includes("Reichstag")
    );
    
    if (berlinAttractions.length >= 3) {
        const normalCost = calculateComboRegularCost(berlinAttractions, ageGroups);
        const cardCost = 29; // Berlin WelcomeCard
        
        if (normalCost > cardCost) {
            combos.push({
                name: "ğŸ« Berlin WelcomeCard",
                description: `ÎšÎ±Î»ÏÏ€Ï„ÎµÎ¹ ${berlinAttractions.length} Î±Î¾Î¹Î¿Î¸Î­Î±Ï„Î±`,
                activities: berlinAttractions.map(a => a.name),
                regularPrice: normalCost,
                comboPrice: cardCost,
                saving: normalCost - cardCost,
                note: "Î ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î´Ï‰ÏÎµÎ¬Î½ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ­Ï‚"
            });
        }
    }
    
    return combos;
}

function findGenericCombos(selectedActivities, ageGroups) {
    console.log("ğŸŒ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î³ÎµÎ½Î¹ÎºÏÎ½ combos");
    const combos = [];
    
    // Î–Î©ÎŸÎ›ÎŸÎ“Î™ÎšÎŸÎ£ + Î•ÎÎ¥Î”Î¡Î•Î™ÎŸ COMBO
    const zooActivities = selectedActivities.filter(act => 
        act.name.includes("Zoo") || 
        act.name.includes("Î–Ï‰Î¿Î»Î¿Î³Î¹ÎºÏŒÏ‚")
    );
    
    const aquariumActivities = selectedActivities.filter(act => 
        act.name.includes("Aquarium") || 
        act.name.includes("Î•Î½Ï…Î´ÏÎµÎ¯Î¿")
    );
    
    if (zooActivities.length > 0 && aquariumActivities.length > 0) {
        // Î’ÏÎµÏ‚ 1 zoo ÎºÎ±Î¹ 1 aquarium Î³Î¹Î± combo
        const zooForCombo = zooActivities[0];
        const aquariumForCombo = aquariumActivities[0];
        
        // ÎšÏŒÏƒÏ„Î¿Ï‚ Î§Î©Î¡Î™Î£ combo (Î³Î¹Î± Î‘Î¥Î¤Î•Î£ Ï„Î¹Ï‚ 2 Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚)
        const normalCostForTheseTwo = calculateComboRegularCost([zooForCombo, aquariumForCombo], ageGroups);
        
        // Combo Ï„Î¹Î¼Î® (20% Î­ÎºÏ€Ï„Ï‰ÏƒÎ·)
        const comboCost = Math.round(normalCostForTheseTwo * 0.8);
        const saving = normalCostForTheseTwo - comboCost;
        
        combos.push({
            name: "ğŸ¯ Zoo + Aquarium Combo",
            description: "Î£Ï…Î½Î´Ï…Î±ÏƒÎ¼ÏŒÏ‚ Î¶Ï‰Î¿Î»Î¿Î³Î¹ÎºÎ¿Ï ÎºÎ®Ï€Î¿Ï… ÎºÎ±Î¹ ÎµÎ½Ï…Î´ÏÎµÎ¯Î¿Ï…",
            activities: [zooForCombo.name, aquariumForCombo.name],
            regularPrice: normalCostForTheseTwo, // ÎœÎŸÎÎŸ Î³Î¹Î± Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ 2
            comboPrice: comboCost,              // Î¤Î¹Î¼Î® combo Î³Î¹Î± Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ 2
            saving: saving,
            note: "20% Î­ÎºÏ€Ï„Ï‰ÏƒÎ· ÏƒÏ„Î¿ ÏƒÏ…Î½Î´Ï…Î±ÏƒÎ¼ÏŒ (Î¼ÏŒÎ½Î¿ Î³Î¹Î± Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ 2 Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚)"
        });
    }
    
    // ÎœÎŸÎ¥Î£Î•Î™Î‘ COMBO
    const museumActivities = selectedActivities.filter(act => 
        act.name.includes("Museum") || 
        act.name.includes("ÎœÎ¿Ï…ÏƒÎµÎ¯Î¿")
    );
    
    if (museumActivities.length >= 3) {
        // Î Î¬ÏÎµ Ï„Î± 3 Ï€ÏÏÏ„Î± Î¼Î¿Ï…ÏƒÎµÎ¯Î± Î³Î¹Î± combo
        const museumsForCombo = museumActivities.slice(0, 3);
        
        // ÎšÏŒÏƒÏ„Î¿Ï‚ Î§Î©Î¡Î™Î£ combo (Î³Î¹Î± Î‘Î¥Î¤Î‘ Ï„Î± 3 Î¼Î¿Ï…ÏƒÎµÎ¯Î±)
        const normalCostForTheseThree = calculateComboRegularCost(museumsForCombo, ageGroups);
        
        // Combo Ï„Î¹Î¼Î® (15% Î­ÎºÏ€Ï„Ï‰ÏƒÎ·)
        const comboCost = Math.round(normalCostForTheseThree * 0.85);
        const saving = normalCostForTheseThree - comboCost;
        
        combos.push({
            name: "ğŸ›ï¸ Museum Combo (3 Î¼Î¿Ï…ÏƒÎµÎ¯Î±)",
            description: `Î•ÎºÏ€Ï„Ï‰Ï„Î¹ÎºÏŒ Ï€Î±ÎºÎ­Ï„Î¿ Î³Î¹Î± 3 Î¼Î¿Ï…ÏƒÎµÎ¯Î±`,
            activities: museumsForCombo.map(a => a.name),
            regularPrice: normalCostForTheseThree, // ÎœÎŸÎÎŸ Î³Î¹Î± Î±Ï…Ï„Î¬ Ï„Î± 3
            comboPrice: comboCost,                // Î¤Î¹Î¼Î® combo Î³Î¹Î± Î±Ï…Ï„Î¬ Ï„Î± 3
            saving: saving,
            note: "15% Î­ÎºÏ€Ï„Ï‰ÏƒÎ· Î³Î¹Î± 3 Î¼Î¿Ï…ÏƒÎµÎ¯Î± (Î¼ÏŒÎ½Î¿ Î³Î¹Î± Î±Ï…Ï„Î¬ Ï„Î± 3)"
        });
    }
    
    return combos;
}

function displayComboResults(results, regularCost) {
    // ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï€Î±Î»Î¹Î¿Ï modal Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
    closeComboModal();
    
    const modal = document.createElement('div');
    modal.id = 'combo-modal-main';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 10000;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: 'Comic Neue', Arial, sans-serif;
    `;
   
    const modalContent = document.createElement('div');
    modalContent.style.cssText = `
        background: white;
        padding: 30px;
        border-radius: 20px;
        max-width: 900px;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    `;
    
    // Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ Î¤Î•Î›Î™ÎšÎŸÎ¥ ÎšÎŸÎ£Î¤ÎŸÎ¥Î£ ÎœÎ• COMBO
    let finalTotalCost = regularCost;
    let bestComboApplied = false;
    
    if (results.bestCombo && results.bestSaving > 0) {
        finalTotalCost = regularCost - results.bestSaving;
        bestComboApplied = true;
    }
    
    let contentHTML = `
        <div style="text-align: center;">
            <h2 style="color: #9c27b0; margin-top: 0;">ğŸ’° ÎˆÎ¾Ï…Ï€Î½Î¿Ï‚ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Combos - Î›ÎŸÎÎ”Î™ÎÎŸ</h2>
            
            <div style="background: #f3e5f5; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #7b1fa2;">ğŸ“Š ÎšÏŒÏƒÏ„Î¿Ï‚ Î§Î©Î¡Î™Î£ Combos: <strong>${regularCost.toFixed(2)} â‚¬</strong></h3>
                <p style="color: #666;">ğŸ™ï¸ Î ÏŒÎ»Î·: ${selectedDestinationName} | ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÎœÎ­Î»Î·: ${familyMembers.length}</p>
            </div>
    `;
    
    if (results.allCombos.length > 0) {
        if (results.bestSaving > 0 && results.bestCombo) {
            contentHTML += `
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; border: 3px solid #4caf50; margin-bottom: 20px;">
                    <h3 style="color: #2e7d32;">ğŸ† ÎšÎ‘Î›Î¥Î¤Î•Î¡Î— Î•Î Î™Î›ÎŸÎ“Î—</h3>
                    <h4>${results.bestCombo.name}</h4>
                    <p>${results.bestCombo.description}</p>
                    
                    <div style="background: #fff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="color: #1565c0; margin-top: 0;">ğŸ§® Î‘ÎÎ‘Î›Î¥Î¤Î™ÎšÎ‘:</h4>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #eee;">Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½</td>
                                <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">${regularCost.toFixed(2)} â‚¬</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #eee;">ÎšÏŒÏƒÏ„Î¿Ï‚ Ï„Ï‰Î½ ${results.bestCombo.activities.length} Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½ Ï‡Ï‰ÏÎ¹ÏƒÏ„Î¬</td>
                                <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">${results.bestCombo.regularPrice.toFixed(2)} â‚¬</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #eee;">Combo Ï„Î¹Î¼Î® Î³Î¹Î± Ï„Î¹Ï‚ Î¯Î´Î¹ÎµÏ‚ ${results.bestCombo.activities.length}</td>
                                <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right; color: #4caf50; font-weight: bold;">${results.bestCombo.comboPrice.toFixed(2)} â‚¬</td>
                            </tr>
                            <tr style="background: #f9f9f9;">
                                <td style="padding: 8px;"><strong>Î•Î¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ·</strong></td>
                                <td style="padding: 8px; text-align: right; color: #4caf50; font-weight: bold;">-${results.bestSaving.toFixed(2)} â‚¬</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="display: flex; justify-content: space-around; margin: 20px 0; align-items: center;">
                        <div style="text-align: center;">
                            <div style="font-size: 24px; color: #f44336; text-decoration: line-through;">${regularCost.toFixed(2)}â‚¬</div>
                            <small>Î§Ï‰ÏÎ¯Ï‚ combo</small>
                        </div>
                        <div style="font-size: 30px; color: #666;">â†’</div>
                        <div style="text-align: center;">
                            <div style="font-size: 28px; color: #4caf50; font-weight: bold;">${finalTotalCost.toFixed(2)}â‚¬</div>
                            <small>ÎœÎµ combo</small>
                        </div>
                    </div>
                    
                    <div style="background: #4caf50; color: white; padding: 12px; border-radius: 8px; font-size: 22px; font-weight: bold; margin-top: 10px;">
                        ğŸ’° Î•Î¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ·: ${results.bestSaving.toFixed(2)} â‚¬
                    </div>
                    
                    ${results.bestCombo.note ? `
                    <div style="background: #e3f2fd; padding: 10px; border-radius: 6px; margin-top: 15px; font-size: 0.9em;">
                        ğŸ“ <strong>Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚:</strong> ${results.bestCombo.note}
                    </div>` : ''}
                    
                    <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
                        <strong>ğŸ“‹ Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Ï€Î¿Ï… ÎºÎ±Î»ÏÏ€Ï„Î¿Î½Ï„Î±Î¹:</strong><br>
                        ${results.bestCombo.activities.map(act => `â€¢ ${act}`).join('<br>')}
                    </div>
                </div>
            `;
        }
        
        contentHTML += `<h3 style="color: #3f51b5;">ğŸ¯ ÎŒÎ»Î± Ï„Î± Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Combos:</h3>`;
        
        results.allCombos.forEach((combo, index) => {
            const borderColor = combo.saving > 0 ? '#4caf50' : '#ff9800';
            const bgColor = combo.saving > 0 ? '#f1f8e9' : '#fff3e0';
            
            // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¿Ï ÎºÏŒÏƒÏ„Î¿Ï…Ï‚ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ combo
            const totalWithThisCombo = regularCost - combo.saving;
            
            contentHTML += `
                <div style="background: ${bgColor}; padding: 15px; border-radius: 10px; border-left: 5px solid ${borderColor}; margin-bottom: 15px;">
                    <h4 style="margin-top: 0; color: #3f51b5;">${combo.name}</h4>
                    <p style="margin: 5px 0;">${combo.description}</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0;">
                        <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                            <div style="font-size: 0.9em; color: #666;">ÎšÎ±Î½Î¿Î½Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚:</div>
                            <div style="font-size: 18px; color: #f44336; text-decoration: line-through;">${combo.regularPrice.toFixed(2)}â‚¬</div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                            <div style="font-size: 0.9em; color: #666;">Combo Ï„Î¹Î¼Î®:</div>
                            <div style="font-size: 18px; color: #4caf50; font-weight: bold;">${combo.comboPrice.toFixed(2)}â‚¬</div>
                        </div>
                    </div>
                    
                    <div style="background: ${combo.saving > 0 ? '#e8f5e9' : '#ffebee'}; padding: 8px; border-radius: 6px; margin: 8px 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <span><strong>Î•Î¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ·:</strong></span>
                            <span style="color: ${combo.saving > 0 ? '#4caf50' : '#f44336'}; font-weight: bold;">
                                ${combo.saving > 0 ? 'ğŸ’° ' : 'âš ï¸ '}${combo.saving.toFixed(2)}â‚¬
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9em;">
                            <span>ÎÎ­Î¿ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚:</span>
                            <span><strong>${totalWithThisCombo.toFixed(2)}â‚¬</strong></span>
                        </div>
                    </div>
                    
                    ${combo.note ? `<div style="font-size: 0.85em; color: #666; background: rgba(0,0,0,0.05); padding: 5px; border-radius: 4px; margin-top: 5px;">ğŸ“ ${combo.note}</div>` : ''}
                </div>
            `;
        });
    } else {
    // Î’Î±ÏƒÎ¹ÎºÏŒ Î¼Î®Î½Ï…Î¼Î± Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚
    contentHTML += `
        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; border: 2px solid #ffc107;">
            <h3 style="color: #856404;">â„¹ï¸ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± combos</h3>
            <p>ÎŸÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏƒÎ±Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î´ÎµÎ½ Î­Ï‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ¬ combos.</p>
    `;
    
    // Î•Î™Î”Î™ÎšÎ— Î£Î¥ÎœÎ’ÎŸÎ¥Î›Î— ÎœÎŸÎÎŸ Î“Î™Î‘ Î¤ÎŸ Î›ÎŸÎÎ”Î™ÎÎŸ
    if (selectedDestinationName.includes('Î›Î¿Î½Î´Î¯Î½Î¿')) {
        contentHTML += `
            <p>ğŸ’¡ Î£Ï…Î¼Î²Î¿Ï…Î»Î®: Î“Î¹Î± Î›Î¿Î½Î´Î¯Î½Î¿, Ï„Î± ÎºÎ±Î»ÏÏ„ÎµÏÎ± combos Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î³Î¹Î± 2+ Î±Ï€ÏŒ:</p>
            <ul style="text-align: left; display: inline-block; margin: 10px 0;">
                <li>Sea Life London Aquarium</li>
                <li>London Eye</li>
                <li>Madame Tussauds</li>
                <li>Shrek's Adventure</li>
                <li>Tower of London</li>
                <li>London Dungeon</li>
            </ul>
            <p><small>Î‘Ï…Ï„Î­Ï‚ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Ï€Î¿Ï… ÎºÎ±Î»ÏÏ€Ï„Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î± Merlin Pass ÎºÎ±Î¹ Î¬Î»Î»Î± ÎµÎºÏ€Ï„Ï‰Ï„Î¹ÎºÎ¬ Ï€Î±ÎºÎ­Ï„Î±.</small></p>
        `;
    } else {
        // Î“ÎµÎ½Î¹ÎºÎ® ÏƒÏ…Î¼Î²Î¿Ï…Î»Î® Î³Î¹Î± Î¬Î»Î»ÎµÏ‚ Ï€ÏŒÎ»ÎµÎ¹Ï‚
        contentHTML += `
            <p>ğŸ’¡ Î“ÎµÎ½Î¹ÎºÎ® ÏƒÏ…Î¼Î²Î¿Ï…Î»Î®: Î¤Î± ÎµÎºÏ€Ï„Ï‰Ï„Î¹ÎºÎ¬ Ï€Î±ÎºÎ­Ï„Î± (combos) ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î³Î¹Î±:</p>
            <ul style="text-align: left; display: inline-block; margin: 10px 0;">
                <li>Î Î¿Î»Î»Î¬ Î¼Î¿Ï…ÏƒÎµÎ¯Î±/Î±Î¾Î¹Î¿Î¸Î­Î±Ï„Î± Ï„Î·Ï‚ Î¯Î´Î¹Î±Ï‚ ÎµÏ„Î±Î¹ÏÎµÎ¯Î±Ï‚</li>
                <li>Î–Ï‰Î¿Î»Î¿Î³Î¹ÎºÏŒÏ‚ ÎºÎ®Ï€Î¿Ï‚ + Î•Î½Ï…Î´ÏÎµÎ¯Î¿</li>
                <li>Î˜ÎµÎ¼Î±Ï„Î¹ÎºÎ¬ Ï€Î¬ÏÎºÎ± Ï„Î·Ï‚ Î¯Î´Î¹Î±Ï‚ Î¿Î¼Î¬Î´Î±Ï‚</li>
                <li>Î Î±ÎºÎ­Ï„Î± Ï€ÏŒÎ»Î·Ï‚ (Ï€.Ï‡. Vienna Pass, Berlin WelcomeCard)</li>
            </ul>
        `;
    }
    
    contentHTML += `</div>`;
}
    
    contentHTML += `
        <div style="margin-top: 20px; padding-top: 20px; border-top: 2px dashed #ccc;">
            <h4 style="color: #9c27b0;">ğŸ“Š Î¤Î•Î›Î™ÎšÎ— Î£Î¥ÎÎŸÎ¨Î—:</h4>
            <div style="background: #e3f2fd; padding: 15px; border-radius: 10px;">
                <ul style="margin: 0; padding-left: 20px;">
                    <li>ğŸ’° <strong>ÎšÎ±Î½Î¿Î½Î¹ÎºÏŒ ÎºÏŒÏƒÏ„Î¿Ï‚ (Ï‡Ï‰ÏÎ¯Ï‚ combos):</strong> ${regularCost.toFixed(2)} â‚¬</li>
                    ${bestComboApplied ?
                        `<li>ğŸ† <strong>ÎœÎµ ÎºÎ±Î»ÏÏ„ÎµÏÎ¿ combo (${results.bestCombo?.name}):</strong> ${finalTotalCost.toFixed(2)} â‚¬</li>
                         <li>âœ… <strong>Î£Ï…Î½Î¿Î»Î¹ÎºÎ® ÎµÎ¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ·:</strong> ${results.bestSaving.toFixed(2)} â‚¬</li>` :
                        `<li>â„¹ï¸ <strong>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ ÎµÎ¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ·</strong></li>`
                    }
                    <li>ğŸ¯ <strong>Î’ÏÎ­Î¸Î·ÎºÎ±Î½:</strong> ${results.allCombos.length} combos</li>
                    <li>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ <strong>ÎœÎ­Î»Î· Î¿Î¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±Ï‚:</strong> ${familyMembers.length} Î¬Ï„Î¿Î¼Î±</li>
                </ul>
            </div>
        </div>
       
        <div style="margin-top: 25px; display: flex; justify-content: center; gap: 15px;">
            <button onclick="closeComboModal()"
                style="padding: 12px 25px; background: #3eb489; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿
            </button>
            ${bestComboApplied ? `
            <button onclick="applyComboToTotal('${results.bestCombo?.name}', ${results.bestSaving})"
                    style="padding: 12px 25px; background: #9c27b0; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;">
                âœ… Î•Ï†Î±ÏÎ¼Î¿Î³Î® ÏƒÏ„Î¿ Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚
            </button>` : ''}
        </div>
    `;
    
    modalContent.innerHTML = contentHTML;
    modal.appendChild(modalContent);
    
    const closeBtn = document.createElement('button');
    closeBtn.innerHTML = 'Ã—';
    closeBtn.style.cssText = `
        position: absolute;
        top: 20px;
        right: 20px;
        background: #f44336;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 24px;
        cursor: pointer;
        z-index: 10001;
    `;
    closeBtn.onclick = () => {
        modal.remove();
        closeBtn.remove();
    };
    
    document.body.appendChild(modal);
    document.body.appendChild(closeBtn);
}

function closeComboModal() {
    const modal = document.getElementById('combo-modal-main');
    if (modal) modal.remove();
    
    const closeBtn = document.querySelector('button[style*="position: absolute"][style*="top: 20px"]');
    if (closeBtn) closeBtn.remove();
}

function applyBestCombo() {
    alert("â„¹ï¸ Î— Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ Ï„Î¿Ï… combo Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ Ï…Ï€ÏŒ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·.\n\nğŸ’¡ Î£Î±Ï‚ ÏƒÏ…Î½Î¹ÏƒÏ„Î¿ÏÎ¼Îµ Î½Î± Î±Î³Î¿ÏÎ¬ÏƒÎµÏ„Îµ Ï„Î¿ combo online Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Î»ÏÏ„ÎµÏÎ· Ï„Î¹Î¼Î®!");
    closeComboModal();
}   
</script>
</body>
</html>
